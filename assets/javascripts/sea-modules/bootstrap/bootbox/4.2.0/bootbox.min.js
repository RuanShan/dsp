define(function(n,t){"use strict";function a(n){var t=o[f.locale];return t?t[n]:o.en[n]}function e(n,t,r){n.stopPropagation();n.preventDefault();var u=i.isFunction(r)&&r(n)===!1;u||t.modal("hide")}function v(n){var i,t=0;for(i in n)t++;return t}function r(n,t){var r=0;i.each(n,function(n,i){t(n,i,r++)})}function y(n){var t,u;if(typeof n!="object")throw new Error("Please supply an object of options");if(!n.message)throw new Error("Please specify a message");return n=i.extend({},f,n),n.buttons||(n.buttons={}),n.backdrop=n.backdrop?"static":!1,t=n.buttons,u=v(t),r(t,function(n,r,f){if(i.isFunction(r)&&(r=t[n]={callback:r}),i.type(r)!=="object")throw new Error("button with key "+n+" must be an object");r.label||(r.label=n);r.className||(r.className=u<=2&&f===u-1?"btn-primary":"btn-default")}),n}function p(n,t){var r=n.length,i={};if(r<1||r>2)throw new Error("Invalid argument length");return r===2||typeof n[0]=="string"?(i[t[0]]=n[0],i[t[1]]=n[1]):i=n[0],i}function s(n,t,r){return i.extend(!0,{},n,p(t,r))}function h(n,t,i,r){var u={className:"bootbox-"+n,buttons:c.apply(null,t)};return l(s(u,r,i),t)}function c(){for(var t={},n=0,r=arguments.length;n<r;n++){var i=arguments[n],u=i.toLowerCase(),f=i.toUpperCase();t[u]={label:a(f)}}return t}function l(n,t){var i={};return r(t,function(n,t){i[t]=!0}),r(n.buttons,function(n){if(i[n]===undefined)throw new Error("button key "+n+" is not allowed (options are "+t.join("\n")+")");}),n}var i=n("$"),u={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'><\/div><\/div><\/div><\/div><\/div>",header:"<div class='modal-header'><h4 class='modal-title'><\/h4><\/div>",footer:"<div class='modal-footer'><\/div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;<\/button>",form:"<form class='bootbox-form'><\/form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'><\/textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'><\/select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /><\/label><\/div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},f={locale:"zh_CN",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0,container:"body"},t={},o;return t.alert=function(){var n;if(n=h("alert",["ok"],["message","callback"],arguments),n.callback&&!i.isFunction(n.callback))throw new Error("alert requires callback property to be a function when provided");return n.buttons.ok.callback=n.onEscape=function(){return i.isFunction(n.callback)?n.callback():!0},t.dialog(n)},t.confirm=function(){var n;if(n=h("confirm",["cancel","confirm"],["message","callback"],arguments),n.buttons.cancel.callback=n.onEscape=function(){return n.callback(!1)},n.buttons.confirm.callback=function(){return n.callback(!0)},!i.isFunction(n.callback))throw new Error("confirm requires a callback");return t.dialog(n)},t.prompt=function(){var n,v,o,a,f,y,e,h,p;if(a=i(u.form),v={className:"bootbox-prompt",buttons:c("cancel","confirm"),value:"",inputType:"text"},n=l(s(v,arguments,["title","callback"]),["cancel","confirm"]),y=n.show===undefined?!0:n.show,n.message=a,n.buttons.cancel.callback=n.onEscape=function(){return n.callback(null)},n.buttons.confirm.callback=function(){var t,u;switch(n.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":t=f.val();break;case"checkbox":u=f.find("input:checked");t=[];r(u,function(n,r){t.push(i(r).val())})}return n.callback(t)},n.show=!1,!n.title)throw new Error("prompt requires a title");if(!i.isFunction(n.callback))throw new Error("prompt requires a callback");if(!u.inputs[n.inputType])throw new Error("invalid prompt type");f=i(u.inputs[n.inputType]);switch(n.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":f.val(n.value);break;case"select":if(h={},e=n.inputOptions||[],!e.length)throw new Error("prompt with select requires options");r(e,function(n,t){var r=f;if(t.value===undefined||t.text===undefined)throw new Error("given options in wrong format");t.group&&(h[t.group]||(h[t.group]=i("<optgroup/>").attr("label",t.group)),r=h[t.group]);r.append("<option value='"+t.value+"'>"+t.text+"<\/option>")});r(h,function(n,t){f.append(t)});f.val(n.value);break;case"checkbox":if(p=i.isArray(n.value)?n.value:[n.value],e=n.inputOptions||[],!e.length)throw new Error("prompt with checkbox requires options");if(!e[0].value||!e[0].text)throw new Error("given options in wrong format");f=i("<div/>");r(e,function(t,e){var o=i(u.inputs[n.inputType]);o.find("input").attr("value",e.value);o.find("label").append(e.text);r(p,function(n,t){t===e.value&&o.find("input").prop("checked",!0)});f.append(o)})}n.placeholder&&f.attr("placeholder",n.placeholder);n.pattern&&f.attr("pattern",n.pattern);a.append(f);a.on("submit",function(n){n.preventDefault();n.stopPropagation();o.find(".btn-primary").click()});o=t.dialog(n);o.off("shown.bs.modal");o.on("shown.bs.modal",function(){f.focus()});return y===!0&&o.modal("show"),o},t.dialog=function(n){var h;n=y(n);var t=i(u.dialog),c=t.find(".modal-dialog"),o=t.find(".modal-body"),l=n.buttons,s="",f={onEscape:n.onEscape};r(l,function(n,t){s+="<button data-bb-handler='"+n+"' type='button' class='btn "+t.className+"'>"+t.label+"<\/button>";f[n]=t.callback});o.find(".bootbox-body").html(n.message);n.animate===!0&&t.addClass("fade");n.className&&t.addClass(n.className);n.size==="large"&&c.addClass("modal-lg");n.size==="small"&&c.addClass("modal-sm");n.title&&o.before(u.header);n.closeButton&&(h=i(u.closeButton),n.title?t.find(".modal-header").prepend(h):h.css("margin-top","-10px").prependTo(o));n.title&&t.find(".modal-title").html(n.title);s.length&&(o.after(u.footer),t.find(".modal-footer").html(s));t.on("hidden.bs.modal",function(n){n.target===this&&t.remove()});t.on("shown.bs.modal",function(){t.find(".btn-primary:first").focus()});t.on("escape.close.bb",function(n){f.onEscape&&e(n,t,f.onEscape)});t.on("click",".modal-footer button",function(n){var r=i(this).data("bb-handler");e(n,t,f[r])});t.on("click",".bootbox-close-button",function(n){e(n,t,f.onEscape)});t.on("keyup",function(n){n.which===27&&t.trigger("escape.close.bb")});return i(n.container).append(t),t.modal({backdrop:n.backdrop,keyboard:!1,show:!1}),n.show&&t.modal("show"),t},t.setDefaults=function(){var n={};arguments.length===2?n[arguments[0]]=arguments[1]:n=arguments[0];i.extend(f,n)},t.hideAll=function(){return i(".bootbox").modal("hide"),t},o={en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}},t.init=function(n){return init(n||i)},t});