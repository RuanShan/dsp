define(function(c,b,a){var e=c("jquery"),d=c("moment");(function(g,h){var f=function(j,i){this.$element=g(j);if(!this.$element.is("input")){g.error("Combodate should be applied to INPUT element");return}this.options=g.extend({},g.fn.combodate.defaults,i,this.$element.data());this.init()};f.prototype={constructor:f,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]};this.$widget=g('<span class="combodate"></span>').html(this.getTemplate());this.initCombos();this.$widget.on("change","select",g.proxy(function(i){this.$element.val(this.getValue()).change();if(this.options.smartDays){if(g(i.target).is(".month")||g(i.target).is(".year")){this.fillCombo("day")}}},this));this.$widget.find("select").css("width","auto");this.$element.hide().after(this.$widget);this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var i=this.options.template;var j=this.options.customClass;g.each(this.map,function(m,l){l=l[0];var o=new RegExp(l+"+"),n=l.length>1?l.substring(1,2):l;i=i.replace(o,"{"+n+"}")});i=i.replace(/ /g,"&nbsp;");g.each(this.map,function(m,l){l=l[0];var n=l.length>1?l.substring(1,2):l;i=i.replace("{"+n+"}",'<select class="'+m+" "+j+'"></select>')});return i},initCombos:function(){for(var i in this.map){var j=this.$widget.find("."+i);this["$"+i]=j.length?j:null;this.fillCombo(i)}},fillCombo:function(l){var n=this["$"+l];if(!n){return}var p="fill"+l.charAt(0).toUpperCase()+l.slice(1);var j=this[p]();var o=n.val();n.empty();for(var m=0;m<j.length;m++){n.append('<option value="'+j[m][0]+'">'+j[m][1]+"</option>")}n.val(o)},fillCommon:function(j){var i=[],k;if(this.options.firstItem==="name"){k=h.relativeTime||h.langData()._relativeTime;var l=typeof k[j]==="function"?k[j](1,true,j,false):k[j];l=l.split(" ").reverse()[0];i.push(["",l])}else{if(this.options.firstItem==="empty"){i.push(["",""])}}return i},fillDay:function(){var k=this.fillCommon("d"),l,m,j=this.options.template.indexOf("DD")!==-1,o=31;if(this.options.smartDays&&this.$month&&this.$year){var p=parseInt(this.$month.val(),10);var n=parseInt(this.$year.val(),10);if(!isNaN(p)&&!isNaN(n)){o=h([n,p]).daysInMonth()}}for(m=1;m<=o;m++){l=j?this.leadZero(m):m;k.push([m,l])}return k},fillMonth:function(){var k=this.fillCommon("M"),l,m,o=this.options.template.indexOf("MMMM")!==-1,n=this.options.template.indexOf("MMM")!==-1,j=this.options.template.indexOf("MM")!==-1;for(m=0;m<=11;m++){if(o){l=h().date(1).month(m).format("MMMM")}else{if(n){l=h().date(1).month(m).format("MMM")}else{if(j){l=this.leadZero(m+1)}else{l=m+1}}}k.push([m,l])}return k},fillYear:function(){var j=[],k,l,m=this.options.template.indexOf("YYYY")!==-1;for(l=this.options.maxYear;l>=this.options.minYear;l--){k=m?l:(l+"").substring(2);j[this.options.yearDescending?"push":"unshift"]([l,k])}j=this.fillCommon("y").concat(j);return j},fillHour:function(){var l=this.fillCommon("h"),m,o,q=this.options.template.indexOf("h")!==-1,p=this.options.template.indexOf("H")!==-1,k=this.options.template.toLowerCase().indexOf("hh")!==-1,n=q?1:0,j=q?12:23;for(o=n;o<=j;o++){m=k?this.leadZero(o):o;l.push([o,m])}return l},fillMinute:function(){var k=this.fillCommon("m"),l,m,j=this.options.template.indexOf("mm")!==-1;for(m=0;m<=59;m+=this.options.minuteStep){l=j?this.leadZero(m):m;k.push([m,l])}return k},fillSecond:function(){var k=this.fillCommon("s"),l,m,j=this.options.template.indexOf("ss")!==-1;for(m=0;m<=59;m+=this.options.secondStep){l=j?this.leadZero(m):m;k.push([m,l])}return k},fillAmpm:function(){var j=this.options.template.indexOf("a")!==-1,k=this.options.template.indexOf("A")!==-1,i=[["am",j?"am":"AM"],["pm",j?"pm":"PM"]];return i},getValue:function(l){var k,i={},j=this,m=false;g.each(this.map,function(o,n){if(o==="ampm"){return}var p=o==="day"?1:0;i[o]=j["$"+o]?parseInt(j["$"+o].val(),10):p;if(isNaN(i[o])){m=true;return false}});if(m){return""}if(this.$ampm){if(i.hour===12){i.hour=this.$ampm.val()==="am"?0:12}else{i.hour=this.$ampm.val()==="am"?i.hour:i.hour+12}}k=h([i.year,i.month,i.day,i.hour,i.minute,i.second]);this.highlight(k);l=l===undefined?this.options.format:l;if(l===null){return k.isValid()?k:null}else{return k.isValid()?k.format(l):""}},setValue:function(l){if(!l){return}var k=typeof l==="string"?h(l,this.options.format,true):h(l),j=this,i={};function m(n,o){var p={};n.children("option").each(function(r,q){var s=g(q).attr("value"),t;if(s===""){return}t=Math.abs(s-o);if(typeof p.distance==="undefined"||t<p.distance){p={value:s,distance:t}}});return p.value}if(k.isValid()){g.each(this.map,function(o,n){if(o==="ampm"){return}i[o]=k[n[1]]()});if(this.$ampm){if(i.hour>=12){i.ampm="pm";if(i.hour>12){i.hour-=12}}else{i.ampm="am";if(i.hour===0){i.hour=12}}}g.each(i,function(o,n){if(j["$"+o]){if(o==="minute"&&j.options.minuteStep>1&&j.options.roundTime){n=m(j["$"+o],n)}if(o==="second"&&j.options.secondStep>1&&j.options.roundTime){n=m(j["$"+o],n)}j["$"+o].val(n)}});if(this.options.smartDays){this.fillCombo("day")}this.$element.val(k.format(this.options.format)).change()}},highlight:function(i){if(!i.isValid()){if(this.options.errorClass){this.$widget.addClass(this.options.errorClass)}else{if(!this.borderColor){this.borderColor=this.$widget.find("select").css("border-color")}this.$widget.find("select").css("border-color","red")}}else{if(this.options.errorClass){this.$widget.removeClass(this.options.errorClass)}else{this.$widget.find("select").css("border-color",this.borderColor)}}},leadZero:function(i){return i<=9?"0"+i:i},destroy:function(){this.$widget.remove();this.$element.removeData("combodate").show()}};g.fn.combodate=function(j){var k,i=Array.apply(null,arguments);i.shift();if(j==="getValue"&&this.length&&(k=this.eq(0).data("combodate"))){return k.getValue.apply(k,i)}return this.each(function(){var n=g(this),m=n.data("combodate"),l=typeof j=="object"&&j;if(!m){n.data("combodate",(m=new f(this,l)))}if(typeof j=="string"&&typeof m[j]=="function"){m[j].apply(m,i)}})};g.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:2015,yearDescending:true,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,customClass:"form-control",roundTime:true,smartDays:false}}(window.jQuery,window.moment))});
;

;
