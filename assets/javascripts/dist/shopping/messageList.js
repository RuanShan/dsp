/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/shopping/messageList",["$","dist/application/app"],function(a){"use strict";function b(a){var b=e(".js_add_keyworks_input",a),d=e(".js_keyworks_list_div",a),f=b.val(),h=e("span",d).length;f.length?b.hasClass("error")||(c(f,d)?g.msg.error("已经存在相同的关键词！"):(d.append(template("js_keywords_template",{value:f,index:h})),b.val(""))):g.msg.error("请输入关键词再按回车添加！")}function c(a,b){var c,d,f=[];return e("span",b).each(function(){f.push(e(this).data("name")+"")}),d=e.inArray(a,f),c=0>d?!1:!0}{var e=a("$"),f=a("dist/application/app"),g=f.config;f.method}e(document).on("click",'ul li [data-toggle="ajaxRemoveMaterial"]',function(a){a.preventDefault();var b=e(this),c=b.data("remote")||b.attr("href"),f=b.data("confirm");f="undefined"==typeof f?!0:f;var h=function(){var a=b.html();b.html('<i class="fa fa-spinner fa-spin"></i>'),e.post(c).done(function(c){if(g.issucceed(c)){g.msg.suc(c.message||g.lang.removeSuccess,c.url);var d=b.closest("div.js_appmsgitem");d.slideUp(function(){d.remove()})}else b.html(a),g.msg.error(c.message||g.lang.removeError,c.url)}).fail(function(){b.html(a),g.msg.info(g.lang.exception,d.url)})};f&&g.msg.msgbox.confirm(b.data("msg")||g.lang.confirmRemove,function(a){a&&h()}),!f&&h()}),e(document).on("click",'[data-toggle="faceemotion"]',function(){var b=e(this);a.async(["dist/emotion/init"],function(a){a.init(b)})}),e('[data-toggle="faceemotion"]').length&&a.async(["dist/emotion/init"],function(){}),e(document).on("keypress",function(a){var a=a||event,c=a.keyCode||a.which||a.charCode,d=e(".js_reply_rule_list.open");return 13==c?(e("#ajaxModalLink").length&&!e("#ajaxModalLink").is(":hidden")?e("button[data-type='ajaxSearch']",e("#ajaxModalLink")).trigger("click"):b(d),!1):void 0}),e(document).on("click",".js_reply_select input[type='radio']",function(){var a=e(this),b=a.closest(".form-group"),c=a.data("type");a.closest(".js_reply_select").find("label").addClass("text-muted"),a.closest("label").removeClass("text-muted"),e(".js_replay_type_div",b).addClass("hide"),e(".js_replay_type_"+c,b).removeClass("hide")}),e(document).on("click","[data-toggle='graphic']",function(){var b=e(this);a.async("dist/graphic/init",function(a){a.init(document,b)})}),e(document).on("click",".js_graphic_del",function(){var a=e(this),b=a.closest(".appmsg_col"),c=a.closest(".js_replay_type_div"),d=e(".js_appmsg_list",c);d.addClass("hide"),e(".js_graphic_select",c).removeClass("hide"),b.remove()}),e(document).on("click",".js_del_keys_val_list",function(){var a=e(this),b=a.closest(".js_keyworks_list_div");e(this).closest("span").remove();{var c=e("span",b);c.length}c.each(function(a){var b=e(this),c=b.find("input[type='hidden']");b.attr("data-number",a);var d=c.attr("name"),f=d.substring(0,d.indexOf("[")),g=d.substring(d.indexOf("]")+1,d.length);c.attr("name",f+"["+a+"]"+g)})}),e(document).on("click",".js_rule_list_save",function(){var a=e(this),b=a.closest("form"),c=e(".js_keyworks_list_div span",b),d=!0,f=e(".js_appmsg_list",b),h=e(".js_replay_textarea",b),i=e(".js_reply_select input[type='radio']:checked",b).data("type");e("<div class='js_ke_validate hide'>"+h.val()+"</div>").insertAfter(h);var j=h.next("div.js_ke_validate").text().replace(/\r\n|\n|\r/g,"").length;return h.next("div.js_ke_validate").remove(),"text"==i?h.val().length<1?(d=!1,g.msg.error("请输入回复内容！")):j>600&&(d=!1,g.msg.error("回复内容不能超过600个字！")):f.hasClass("hide")&&(d=!1,g.msg.error("请输入回复内容！")),e(".js_keyworks_list_div",b).length&&c.length<1&&(d=!1,g.msg.error("请至少输入1个关键词！")),d}),e(document).on("click",'button[data-toggle="ajaxRemoveRule"]',function(a){a.preventDefault();var b=e(this),c=b.data("remote")||b.attr("href"),f=b.data("confirm");f="undefined"==typeof f?!0:f;var h=function(){var a=b.html();b.html('<i class="fa fa-spinner fa-spin"></i>'),e.post(c).done(function(c){if(g.issucceed(c)){g.msg.suc(c.message||g.lang.removeSuccess,c.url);var d=b.closest(".js_reply_rule_list");d.slideUp(function(){d.remove()})}else b.html(a),g.msg.error(c.message||g.lang.removeError,c.url)}).fail(function(){b.html(a),g.msg.info(g.lang.exception,d.url)})};f&&g.msg.msgbox.confirm(b.data("msg")||g.lang.confirmRemove,function(a){if(a)if(c)h();else{var d=b.closest(".js_reply_rule_list");d.slideUp(function(){d.remove()})}}),!f&&h()}),e(document).on("click",".js_add_rule",function(){var b=e(".js_rule_list_container"),c=e(".js_reply_rule_list.new_list");if(c.length)c.remove();else{e(".js_reply_rule_list",e("body")).removeClass("open"),b.prepend(e(template("js_rule_list_template",{})));var d=e('.js_reply_rule_list.new_list [data-toggle="kindeditor"]');KindEditor.create(d,g.kindeditor[d.data("config")||"reply"]),e("form.form-validate",e(".js_reply_rule_list.new_list")).length>0&&a.async("dist/form/init",function(a){var b=e("form.form-validate",e(".js_reply_rule_list.new_list"));b.length&&a.init(b)})}}),e(document).on("click",".js_rule_detail_edit",function(){var a=e(this),b=a.closest(".js_reply_rule_list").hasClass("open");e(".js_reply_rule_list",e("body")).removeClass("open"),b?a.closest(".js_reply_rule_list").removeClass("open"):a.closest(".js_reply_rule_list").addClass("open")}),e(document).on("click","#date_btn",function(){{var a=e(this),b=a.closest("form"),c=e(".js_keyworks_list_div span",b),d=!0,f=(a.data("remote")||a.attr("href"),e(".js_appmsg_list",b)),h=e(".js_replay_textarea",b),i=e(".js_reply_select input[type='radio']:checked",b).data("type");e("#timing")}e("<div class='js_ke_validate hide'>"+h.val()+"</div>").insertAfter(h);var j=h.next("div.js_ke_validate").text().replace(/\r\n|\n|\r/g,"").length;return h.next("div.js_ke_validate").remove(),"text"==i?h.val().length<1?(d=!1,g.msg.error("请输入群发文字内容！")):j>600&&(d=!1,g.msg.error("群发文字内容不能超过600个字！")):(f.hasClass("hide")&&(d=!1,g.msg.error("请选择群发图文内容！")),3==e(".js_send_type").val()&&0==window.selectGroupIds.length&&(d=!1,g.msg.error("请选择发送的分组！"))),e(".js_keyworks_list_div",b).length&&c.length<1&&(d=!1,g.msg.error("请至少输入1个关键词！")),d}),e(document).on("click",".js_quick_send",function(){{var a=e(this),b=a.closest("form"),c=e(".js_keyworks_list_div span",b),d=!0,f=(a.data("remote")||a.attr("href"),e(".js_appmsg_list",b)),h=e(".js_replay_textarea",b),i=e(".js_reply_select input[type='radio']:checked",b).data("type");e("#timing")}e("<div class='js_ke_validate hide'>"+h.val()+"</div>").insertAfter(h);var j=h.next("div.js_ke_validate").text().replace(/\r\n|\n|\r/g,"").length;return h.next("div.js_ke_validate").remove(),"text"==i?h.val().length<1?(d=!1,g.msg.error("请输入群发文字内容！")):j>600&&(d=!1,g.msg.error("群发文字内容不能超过600个字！")):(f.hasClass("hide")&&(d=!1,g.msg.error("请选择群发图文内容！")),3==e(".js_send_type").val()&&0==window.selectGroupIds.length&&(d=!1,g.msg.error("请选择发送的分组！"))),e(".js_keyworks_list_div",b).length&&c.length<1&&(d=!1,g.msg.error("请至少输入1个关键词！")),d}),e(document).on("changeDate",".js_select_send_time",function(){var a=e(this);a.valid()}),e(document).on("change",".js_send_type",function(){var a=e(this),b=a.val(),c=e(".js_type3");3==b?c.removeClass("hide"):c.addClass("hide")}),e(document).on("click",".js_show_more",function(){var a=e(this),b=a.closest("td").find("p:gt(3)");a.toggleClass("fa-caret-up"),b.toggleClass("hide")}),e(document).on("click",".js_fix_time",function(){var a=e(this),b=a.prop("checked"),c=e(".js_fix_time_send"),d=e(".js_quick_send");b?(c.removeClass("hide"),d.addClass("hide")):(c.addClass("hide"),d.removeClass("hide"))}),e(document).on("mouseover",".js_graphic_select div.text-center",function(){var a=e(this);a.css("border","2px dashed #717171")}),e(document).on("mouseout",".js_graphic_select div.text-center",function(){var a=e(this);a.css("border","2px dashed #cfcfcf")}),e(".js_show_group_dialog").popover({html:!0,placement:"auto",trigger:"click",content:e(template("add_groups_tmp",{list:window.userGroups})).html()}).on("click",function(a){a.preventDefault();var b=e(".js_select_all_group"),c=e(".js_group_lists .js_select_group"),d=c.length;e.each(c,function(a,b){var c=e(b),d=c.data("groupid");-1!=window.selectGroupIds.indexOf(d)&&c.prop("checked",!0)}),d==window.selectGroupIds.length&&b.prop("checked",!0),e(".js_show_group_dialog").not(this).popover("hide")}),e(document).on("click",".js_select_all_group",function(){var a=e(this),b=a.prop("checked"),c=e(".js_group_lists .js_select_group"),d=e(".js_no_select_group"),f=e(".js_some_select_group"),g=e(".js_all_select_group"),h=e(".js_groupIds");b?(window.selectGroupIds=[],window.selectGroupLabels=[],e.each(c,function(a,b){var c=e(b),d=c.data("groupid"),f=c.data("label");c.prop("checked",!0),window.selectGroupIds.push(d),window.selectGroupLabels.push(f)}),d.addClass("hide"),g.removeClass("hide"),f.addClass("hide"),h.val(window.selectGroupIds)):(window.selectGroupIds=[],window.selectGroupLabels=[],e.each(c,function(a,b){var c=e(b);c.prop("checked",!1)}),d.removeClass("hide"),g.addClass("hide"),f.addClass("hide"),h.val(""))}),e(document).on("click",".js_select_group",function(){var a=e(this),b=a.data("groupid"),c=a.data("label"),d=a.prop("checked"),f=e(".js_no_select_group"),g=e(".js_some_select_group"),h=e(".js_all_select_group"),i=e(".js_select_all_group"),j=e(".js_some_select_group_label"),k=e(".js_groupIds"),l=e(".js_group_lists .js_select_group:checked").length,m=e(".js_group_lists .js_select_group").length;d?(window.selectGroupIds.push(b),window.selectGroupLabels.push(c),k.val(window.selectGroupIds)):(window.selectGroupIds.splice(window.selectGroupIds.indexOf(b),1),window.selectGroupLabels.splice(window.selectGroupLabels.indexOf(c),1),k.val(window.selectGroupIds)),0==l?(f.removeClass("hide"),h.addClass("hide"),g.addClass("hide"),i.prop("checked",!1),j.text("")):m==window.selectGroupIds.length?(f.addClass("hide"),h.removeClass("hide"),g.addClass("hide"),i.prop("checked",!0),j.text("")):(f.addClass("hide"),h.addClass("hide"),g.removeClass("hide"),i.prop("checked",!1),j.text(window.selectGroupLabels.join("；")))}),e(document).on("click",".js_close_group_dialog",function(){e(".js_show_group_dialog").not(this).popover("hide")})});