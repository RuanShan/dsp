/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/map/init",["$","dist/application/app","./baidu","./google","./tencent"],function(a){var b=a("$"),c=a("dist/application/app"),d=(c.config,c.method,a("./baidu")),e=a("./google"),f=a("./tencent"),g=function(){this.op={lat:31.336452,lng:121.494335,adr:"上海市宝山区逸仙路2816号",type:"baidu"},this.maps={},this.is_change=!1,this.is_default=!0};return g.prototype.init=function(a){var c=this;this.$warp=a,c.el=c.get_els();var d=c.el.suggestId.val();b.trim(d).length>0&&(c.op={lat:c.el.lat.val(),lng:c.el.lng.val(),adr:d},c.is_default=!1),c.load_map(),b(".js_map_search",a).click(function(){c.maps.search()}),b(".js_map_type",a).on("click",function(){c.is_change=!0,b("#l-map",a).css("background-color","white").html("<div class='load pull-left'>地图加载中...</div>"),c.load_map()})},g.prototype.load_map=function(){var a=this;switch(a.get_type()){case"baidu":a.maps=new d;break;case"google":a.maps=new e;break;case"tencent":a.maps=new f;break;default:a.maps=new d}a.maps.load()},g.prototype.get_els=function(){return{lat:b(".js_map_lng",this.$warp),lng:b(".js_map_lat",this.$warp),suggestId:b(".js_map_key",this.$warp)}},g.prototype.get_type=function(){return b(".js_map_type:checked",this.$warp).data("mapty")},g}),define("dist/map/baidu",[],function(){var a=function(){this.point=null,this.marker=null,this.infowindow=null,this.map=null};return a.prototype.load=function(){if("undefined"==typeof BMap){var a=document.createElement("script");a.src="http://api.map.baidu.com/api?v=2.0&ak=359042E5AC9ced07c553ebe2042aad73&callback=wm.map.maps.init",document.body.appendChild(a)}else this.init()},a.prototype.init=function(){var a=this;this.map=new BMap.Map("l-map"),this.point=new BMap.Point(wm.map.op.lng,wm.map.op.lat),this.map.centerAndZoom(this.point,15),this.map.enableScrollWheelZoom(),this.map.enableScrollWheelZoom(),this.marker=new BMap.Marker(this.point),this.map.addOverlay(this.marker),this.map.addEventListener("dragend",function(){a.marker.closeInfoWindow(),a.showAddress(a.marker)}),this.map.addEventListener("dragging",function(){var b=a.map.getCenter();a.marker.setPosition(new BMap.Point(b.lng,b.lat))}),this.marker.enableDragging(),this.marker.addEventListener("click",function(){this.openInfoWindow(this.infoWindow)}),this.marker.addEventListener("dragend",function(){a.marker.closeInfoWindow(),a.showAddress(this.marker)});var b={width:220,height:80,title:"原本位置"};this.infoWindow=new BMap.InfoWindow(" "+wm.map.op.adr+" ,拖拽地图或红点修改位置!你也可以直接修改上方位置系统自动定位!",b),wm.map.is_change?this.search():this.marker.openInfoWindow(this.infoWindow),wm.map.is_default&&window.setTimeout(function(){a.locate()},1e3)},a.prototype.locate=function(){var a=this,b=new BMap.Geolocation;b.getCurrentPosition(function(b){if(this.getStatus()==BMAP_STATUS_SUCCESS){point=new BMap.Point(b.point.lng,b.point.lat),a.marker.setPosition(point),a.map.panTo(point);var c={width:220,height:60,title:"定位成功"};a.infoWindow=new BMap.InfoWindow("这是你当前的位置!,移动红点标注目标位置，你也可以直接修改上方位置,系统自动定位!",c),a.marker.openInfoWindow(a.infoWindow),a.showAddress(a.marker,!0)}else console.log("无法获取定位")})},a.prototype.search=function(){var a=this,b=new BMap.Geocoder,c=wm.map.el.suggestId.val();c=c.length>0?c:wm.map.op.adr,b.getPoint(c,function(b){if(b){a.marker.setPosition(b),a.map.panTo(b);var d={width:220,height:60,title:"搜索位置"};a.infoWindow=new BMap.InfoWindow(""+c+",移动红点标注目标位置，你也可以直接修改上方位置,系统自动定位!",d),a.marker.openInfoWindow(a.infoWindow),a.showAddress(a.marker,!0)}else console.log("Search no point")},"全国")},a.prototype.showAddress=function(a,b){var c=a.getPosition(),d=this,e=new BMap.Geocoder;e.getLocation(c,function(a){if(a){var e=wm.map.el;if(e.lat.val(c.lat),e.lng.val(c.lng),e.suggestId.val(a.address),!b){var f={width:220,height:80,title:"标注位置"};d.infoWindow=new BMap.InfoWindow(" "+a.address+" ,拖拽地图或红点修改位置!你也可以直接修改上方位置系统自动定位!",f)}}else console.log("无法获取定位")})},a}),define("dist/map/google",[],function(){var a=function(){this.point=null,this.marker=null,this.infowindow=null,this.map=null};return a.prototype.load=function(){if("undefined"==typeof a){var b=document.createElement("script"),c=["AIzaSyAOne2X4zK1sQPbsiSK6oSaF8U7BJkPmt0","AIzaSyBSvfDvgbHw88c3HOG2lWP5A4bDnu6oPVI","AIzaSyDpx3CSeFhC9V0FZ8A5BLIIsfOpiRpuDhM"];b.src="http://maps.googleapis.com/maps/api/js?key={0}&sensor=false&callback=wm.map.maps.init".format(c[Math.floor(Math.random()*c.length+1)-1]),document.body.appendChild(b)}else this.init()},a.prototype.init=function(){var b=this;b.point=new a.maps.LatLng(wm.map.op.lat,wm.map.op.lng);var c={zoom:15,center:b.point,mapTypeId:a.maps.MapTypeId.ROADMAP,mapTypeControl:!1,overviewMapControl:!0,scaleControl:!1,streetViewControl:!1,panControl:!0};b.map=new a.maps.Map(document.getElementById("l-map"),c),b.marker=new a.maps.Marker({position:b.point,map:b.map}),b.marker.setDraggable(!0),b.map.addListener("drag",function(){var a=b.map.center;b.marker.setPosition(a)}),b.map.addListener("dragend",function(){b.infowindow.close(),b.showAddress(b.marker)}),b.infowindow=new a.maps.InfoWindow,a.maps.event.addListener(b.marker,"dragend",function(){b.infowindow.close(),b.showAddress(b.marker)}),a.maps.event.addListener(b.marker,"click",function(){b.infowindow.open(b.map,b.marker)}),b.infowindow=new a.maps.InfoWindow({content:"<div style='width:180px'>原本位置 {0} ,移动红点修改位置!你也可以直接修改上方位置系统自动定位!</div>".format(wm.map.op.adr)}),wm.map.is_change?b.search():b.infowindow.open(b.map,b.marker),wm.map.is_default&&b.locate()},a.prototype.locate=function(){var b=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(c){var d=new a.maps.LatLng(c.coords.latitude,c.coords.longitude);b.marker.setPosition(d),b.map.panTo(d),b.infowindow.setContent("<div style='width:200px'>定位成功这是你当前的位置!,移动红点标注目标位置，你也可以直接修改上方位置,系统自动定位!</div>"),b.infowindow.open(b.map,b.marker),b.showAddress(b.marker,!0)})},a.prototype.search=function(){var b=this,c=new a.maps.Geocoder,d=wm.map.el.suggestId.val();d=d.length>0?d:wm.map.op.adr,c.geocode({address:d},function(c,d){if(d==a.maps.GeocoderStatus.OK){var e=c[0].geometry.location;b.infowindow.setContent("<div style='width:200px'>搜索位置 "+c[0].formatted_address+" ,移动红点修改位置!你也可以直接修改上方位置系统自动定位!</div>"),b.infowindow.open(b.map,b.marker),b.marker.setPosition(e),b.map.panTo(e),b.showAddress(b.marker,!0)}})},a.prototype.showAddress=function(b,c){var d=b.getPosition(),e=new a.maps.Geocoder,f=this;e.geocode({latLng:d},function(b,e){if(e==a.maps.GeocoderStatus.OK){if(b[1]){var g=b[0].formatted_address,h=g.indexOf("邮政编码");h>0&&(g=g.substring(0,h)),c||f.infowindow.setContent("<div style='width:190px'>标注位置 "+g+" ,移动红点修改位置!你也可以直接修改上方位置系统自动定位!</div>");var i=wm.map.el;i.lat.val(d.lat()),i.lng.val(d.lng()),i.suggestId.val(g)}}else console.log("Geocoder failed due to: "+e)})},a}),define("dist/map/tencent",[],function(){var a=function(){this.point=null,this.marker=null,this.infowindow=null,this.map=null};return a.prototype.load=function(){if("undefined"==typeof qq){var a=document.createElement("script");a.src="http://map.qq.com/api/js?v=2.exp&key=JZSBZ-ZI4RF-HRCJY-JN3OW-V37KS-SOB4K&callback=wm.map.maps.init",document.body.appendChild(a)}else this.init()},a.prototype.init=function(){var a=this;a.point=new qq.maps.LatLng(wm.map.op.lat,wm.map.op.lng),a.map=new qq.maps.Map(document.getElementById("l-map"),{center:a.point,zoom:15}),a.infowindow=new qq.maps.InfoWindow({map:a.map,position:a.point,content:" <div style='width:200px'>原本位置 {0} ,拖拽地图或红点修改位置!你也可以直接修改上方位置系统自动定位!</div>".format(wm.map.op.adr)}),a.marker=new qq.maps.Marker({position:a.point,draggable:!0,map:a.map}),qq.maps.event.addListener(a.map,"drag",function(){var b=a.map.getCenter();a.marker.setPosition(b)}),qq.maps.event.addListener(a.map,"dragend",function(){var b=a.map.getCenter();a.infowindow.close(),a.showAddress(b)}),qq.maps.event.addListener(a.marker,"dragend",function(){var b=a.marker.getPosition();a.showAddress(b),a.infowindow.close()}),qq.maps.event.addListener(a.marker,"click",function(){a.infowindow.open()}),null==a.geocoder&&(a.geocoder=new qq.maps.Geocoder),qq.maps.event.addListener(a.marker,"position_changed",function(){var b=a.marker.getPosition();a.infowindow.setPosition(b)}),wm.map.is_change?a.search():a.infowindow.open(),wm.map.is_default&&window.setTimeout(function(){a.locate()},1e3)},a.prototype.setval=function(a){var b=this,c=a.detail.location,d=a.detail.address;b.marker.setPosition(c),b.map.panTo(c);var e=wm.map.el;e.lat.val(c.lat),e.lng.val(c.lng),e.suggestId.val(d)},a.prototype.locate=function(){var a=this;navigator.geolocation.getCurrentPosition(function(b){var c=new qq.maps.LatLng(b.coords.latitude,b.coords.longitude);a.map.panTo(c),a.marker.setPosition(c),a.infowindow.setContent("<div style='width:200px'>定位成功这是你当前的位置!,移动红点标注目标位置，你也可以直接修改上方位置,系统自动定位!</div>"),a.infowindow.open(),a.rgeocoder().getAddress(c)})},a.prototype.search=function(){var a=this,b=wm.map.el.suggestId.val();b=b.length>0?b:wm.map.op.adr,a.geocoder.getLocation(b),a.geocoder.setComplete(function(b){a.setval(b),a.infowindow.open(),a.infowindow.setContent("<div style='width:200px'>搜索位置 {0} ,移动红点修改位置!你也可以直接修改上方位置系统自动定位!</div>".format(b.detail.address))})},a.prototype.showAddress=function(a){var b=this;b.geocoder.getAddress(a),b.geocoder.setComplete(function(a){b.setval(a),b.infowindow.setContent("<div style='width:200px'>标注位置 {0} ,移动红点修改位置!你也可以直接修改上方位置系统自动定位!</div>".format(a.detail.address))})},a});