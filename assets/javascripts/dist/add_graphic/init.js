/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/add_graphic/init",["$","dist/application/app","./select"],function(a){"use strict";function b(){h("#parent_box .prize-list").each(function(a){var b="list"+a;h(this).attr("id",b),h("[data-find-name]",h(this)).each(function(){var b=h(this).data("findName");h(this).attr({name:"articles["+a+"]["+b+"]",id:"articles["+a+"]."+b})})}),h("div.cover_appmsg_item").each(function(a){h(this).find("a.js_edit").data("size",a),h(this).find("a.js_del").data("size",a),h(this).find("a.js_move_up").data("size",a),h(this).find("a.js_move_down").data("size",a)})}function c(){var a=!0;return h("div.prize-list").each(function(){if(""==h(this).find('[data-find-name="title"]').val())return m(h(this).find('[data-find-name="title"]')),a=!1,!1;if(""==h(this).find(".js_message_messagetype").val())return m(h(this).find(".js_message_messagetype")),!1;if("link"==h(this).find(".js_style_select_articles:checked").data("type"))h("input[type='text'],select",h(".js_style_articles_link",h(this))).each(function(){return h(this).length&&!h(this).prop("disabled")&&""==h(this).val()?(m(h(this)),a=!1,!1):void 0});else{if(""==h(this).find('[data-find-name="content"]').val()&&!h(this).find('[data-find-name="content"]').closest("div.graphic-box").hasClass("hide"))return m(h(this).find('[data-find-name="content"]')),a=!1,!1;h("input[type='text'],select",h(".js_style_articles_imgtext",h(this))).each(function(){return h(this).length&&!h(this).prop("disabled")&&""==h(this).val()?(m(h(this)),a=!1,!1):void 0})}}),a}function d(){var a=h(".cover_appmsg_item");h.each(a,function(b,c){var d=h(c).find(".js_del"),e=h(c).find(".js_edit"),f=h(c).find(".js_move_up"),g=h(c).find(".js_move_down");0==b?(f.addClass("hide"),g.addClass("hide"),d.addClass("hide"),1==a.length?(g.addClass("hide"),e.addClass("hide")):e.removeClass("hide")):1==b?(d.removeClass("hide"),e.removeClass("hide"),f.addClass("hide"),a.length>2?g.removeClass("hide"):g.addClass("hide")):b==a.length-1?(d.removeClass("hide"),e.removeClass("hide"),f.removeClass("hide"),g.addClass("hide")):(d.removeClass("hide"),e.removeClass("hide"),f.removeClass("hide"),g.removeClass("hide")),d.data("size",b),e.data("size",b),f.data("size",b),g.data("size",b)})}function e(a){var b=a,c=b.closest(".js_articles_list"),d=b.data("type"),e=h(".js_style_articles_show",c),f=h(".js_style_articles_"+d,c);if(e.addClass("hide"),h("input,textarea,select",e).prop("disabled",!0),f.removeClass("hide"),h("input,textarea,select",f).prop("disabled",!1),"link"==d){var g=h("input.condition:checked",f);h('textarea[data-toggle="kindeditor"]',c).data("novlida",!0),h("input.condition",c).closest(".form-group").find('input[type="text"], select').attr("disabled",!0),g.closest(".form-group").find('input[type="text"], select').removeAttr("disabled")}else{var g=h("input.js_original_select",f);h('textarea[data-toggle="kindeditor"]',c).data("novlida",!1),h(".js_original_select_url",g.closest(".form-group")).prop("disabled",!g.prop("checked"))}}function f(a,b){var c=a,d=c.closest(".js_articles_list"),e=c.find("option:selected").data("ischild"),f=String(c.val()),g=h(".js_subjects select",d),i=window.subjectUrl;return 0==f.length?void g.empty().addClass("hide"):(g.empty().removeClass("hide"),e?void h.ajax({url:i+"?type="+f,type:"get",dataType:"json"}).done(function(a){if(0==a.status){{a.data}a.child=b,g.empty().removeClass("hide"),a.data.unshift({id:"",name:g.data("empty")}),g.append(template("delivery_city_tem",a))}else j.msg.info(a.message)}).fail(function(){j.msg.info("网络异常")}):void g.empty().addClass("hide"))}function g(){var b=h('[data-toggle="kindeditor"]');b.length>0&&a.async("kindeditor",function(){b.each(function(){var a=h(this),b=a.data("config"),c=a.data("tongji"),d=b?j.kindeditor[b]:j.kindeditor["default"];if(window.extraUploadPath&&(d=h.extend({},d,{uploadJson:window.extraUploadPath})),c){var e=a.data("tongjiTarget"),f=a.data("ruleRangelength")[1];if(e){var g=h(e),i=g.html();d=h.extend({},d,{afterChange:function(){var a="remain"==c?f-this.count():this.count();0>a||a>f?g.addClass("error"):g.removeClass("error"),g.html(i.format(a))}})}}KindEditor.create(a,d)})})}{var h=a("$"),i=a("dist/application/app"),j=i.config;i.method}if(a("./select"),window.graphic_set){var k={};k.data=[],h(template("js_rules_temp",window.graphic_set)).insertBefore("a.add_prize"),window.graphic_set=h.extend(!0,window.graphic_set,window.selectlist),h("#parent_box").append(template("js_list_temp",window.graphic_set)),h('[data-toggle="popover"]').popoverClosable(),h(".js_articles_list").each(function(){e(h(".js_style_select_articles:checked",h(this))),f(h(".js_subject_type",h(this)),h(".js_subject_type",h(this)).data("child"))}),d(),b()}window.pushPage&&(h(".js_articles_list").each(function(){e(h(".js_style_select_articles:checked",h(this))),f(h(".js_subject_type",h(this)),h(".js_subject_type",h(this)).data("child"))}),b());var l=function(a,b){this.obj=a,this.opts=h.extend(!0,{index:2,business:!0,callback:h.noop},b||{}),this.init()};l.prototype={init:function(){this.action()},action:function(){var a=this;h(document).on("click",a.obj,function(){var b=h(this).data("temp"),c=h(this).data("parentid"),e=h(c).find(".prize-list").length,f=h(this).data("max");if(e>=f)return void j.msg.info("最多添加{0}个".format(f)||"超过添加限制");var g={};g.num=e,g.size=a.opts.index++,window.graphic_add.data[0].cid=e,window.graphic_add=h.extend(!0,window.graphic_add,window.selectlist),h(template("js_rules_temp",window.graphic_add)).insertAfter(h(this).prev("div.cover_appmsg_item")),h(c).append(template(b,window.graphic_add)),a.opts.business&&a.opts.callback(g.num),d()}),h(document).on("click","a.js_del",function(){var b=h(this).closest(".js_articles_list"),c=h(this).data("size");h(this).closest("div.js_appmsg_item").remove(),h("#list"+c).find('[data-find-name="content"]').removeAttr("data-rule-required"),h("#list"+c).remove(),h("div.cover_appmsg_item").removeClass("on"),h("div.cover_appmsg_item:last").addClass("on"),h("div.prize-list:last").removeClass("hide");var e=h(".add_prize").position().top-130;h("#parent_box").css("margin-top",e);{var f=h(this).data("parentid");h(f).find(".prize-list").length,h(f).find(a.obj).data("max")}a.prizeSet(f,b),a.scrollT(e),KindEditor.instances.splice(c,1),d()}),h(document).on("click","a.js_edit",function(){var b=h(this).closest("div.cover_appmsg_item").position().top;if(!h(this).closest("div.cover_appmsg_item").hasClass("on")){var c,d=h(this).data("size"),e="#list"+d;c=b-34>0?b-34:0,0==d&&(c=0),h("div.cover_appmsg_item").removeClass("on"),h(this).closest("div.cover_appmsg_item").addClass("on"),a.showBoxFn(e,c),a.scrollT(c)}}),h(document).on("click","a.js_move_down",function(){var b=h(this),c=b.data("parentid"),e=(b.data("array"),b.closest(".cover_appmsg_item")),f=b.closest("div.cover_appmsg_item").next().position().top,i=e.next(),j=e.index(),k=h("#list"+j),l=k.next();KindEditor.remove('[data-toggle="kindeditor"]'),h("[data-find-name]",k).each(function(){h(this).attr("name","articles[999999]["+h(this).data("findName")+"]")}),i.after(e),l.after(k),d(),h(".cover_appmsg_item").addClass("js_appmsg_item").removeAttr("style"),h(".cover_appmsg_item:first").removeClass("js_appmsg_item").attr("style","border:0;");var m,n=h(this).data("size"),o="#list"+n;m=f-34>0?f-34:0,0==n&&(m=0),h("div.cover_appmsg_item").removeClass("on"),h(this).closest("div.cover_appmsg_item").addClass("on"),a.prizeSet(c,{}),a.showBoxFn(o,m),a.scrollT(m),g()}),h(document).on("click","a.js_move_up",function(){var b=h(this),c=b.data("parentid"),e=b.closest(".cover_appmsg_item"),f=b.closest("div.cover_appmsg_item").prev().position().top,i=e.prev(),j=e.index(),k=h("#list"+j),l=k.prev();KindEditor.remove('[data-toggle="kindeditor"]'),h("[data-find-name]",l).each(function(){h(this).attr("name","articles[999999]["+h(this).data("findName")+"]")}),i.before(e),l.before(k),d(),h(".cover_appmsg_item").addClass("js_appmsg_item").removeAttr("style"),h(".cover_appmsg_item:first").removeClass("js_appmsg_item").attr("style","border:0;");var m,n=h(this).data("size"),o="#list"+n;m=f-34>0?f-34:0,0==n&&(m=0),h("div.cover_appmsg_item").removeClass("on"),h(this).closest("div.cover_appmsg_item").addClass("on"),a.prizeSet(c,{}),a.showBoxFn(o,m),a.scrollT(m),g()}),h(document).on("keyup","input.title-change",function(){var a=h(this).val();h("div.cover_appmsg_item").each(function(){h(this).hasClass("on")&&h(this).find("h4.appmsg_title a").html(a)})}),h(document).on("keyup","input.title-subhead",function(){var a=h(this).val();h("div.cover_appmsg_item").each(function(){h(this).hasClass("on")&&h(this).find("h4.appmsg_title a").html(a)})}),h(document).on("callback",".js_selectimg",function(a,b){var c=b;h("div.cover_appmsg_item").each(function(){h(this).hasClass("on")&&h(this).find("img.js_appmsg_thumb").attr("src",c)})}),h(document).on("click","span.js_common_link",function(){var a=h(this).closest("div.prize-list").find('[data-toggle="city_custom"]');a.hasClass("hide")&&a.removeClass("hide"),h(this).closest("div.form-group").addClass("hide")}),h(document).on("change","select.js_cxselect",function(){var a=h(this).find("option:selected").val();1==a&&(h(this).closest("div.form-group").addClass("hide"),h(this).closest("div.prize-list").find("div.common_link").removeClass("hide"))}),h('[data-toggle="city_custom"]').each(function(){h(this).cxSelect({selects:["first","second"],nodata:"none",url:window.cxSelectAdd})})},prizeSet:function(){h("#parent_box .prize-list").each(function(a){var b="list"+a;h(this).attr("id",b),h("[data-find-name]",h(this)).each(function(){var b=h(this).data("findName");h(this).attr({name:"articles["+a+"]["+b+"]",id:"articles["+a+"]."+b})})}),h("div.cover_appmsg_item").each(function(a){h(this).find("a.js_edit").data("size",a),h(this).find("a.js_del").data("size",a),h(this).find("a.js_move_up").data("size",a),h(this).find("a.js_move_down").data("size",a)})},showBoxFn:function(a,b){h("#parent_box div.prize-list").addClass("hide"),h(a).removeClass("hide"),h("#parent_box").css("margin-top",b)},scrollT:function(a){h(".scrollable").animate({scrollTop:a},300)}},new l(".add_prize",{callback:function(c){var d=h(".add_prize").position().top-128;h("#parent_box div.prize-list").addClass("hide"),h("#list"+c).removeClass("hide"),h("#parent_box").css("margin-top",d),h("div.cover_appmsg_item").removeClass("on"),h("div.cover_appmsg_item:last").addClass("on"),h(".scrollable").animate({scrollTop:d},300);var e=h('[data-toggle="kindeditor"]',h("#list"+c)),f=h('[data-toggle="city_custom"]',h("#list"+c));e.length>0&&a.async("kindeditor",function(){e.each(function(){var a=h(this),b=a.data("config"),c=a.data("tongji"),d=b?j.kindeditor[b]:j.kindeditor["default"];if(window.extraUploadPath&&(d=h.extend({},d,{uploadJson:window.extraUploadPath})),c){var e=a.data("tongjiTarget"),f=a.data("ruleRangelength")[1];if(e){var g=h(e),i=g.html();d=h.extend({},d,{afterChange:function(){var a="remain"==c?f-this.count():this.count();0>a||a>f?g.addClass("error"):g.removeClass("error"),g.html(i.format(a))}})}}KindEditor.create(a,d)})}),h('[data-toggle="popover"]').popoverClosable(),f.length>0&&f.cxSelect({selects:["first","second"],nodata:"none",url:window.cxSelectAdd}),b()}}),h(".js_bsubmit").on("click",function(){h(window).unbind("beforeunload"),h("#method").val(h(this).data("filed")),c()}),h(document).on("click",".js_pre_phone_add",function(){var a=h(".js_mobile_number",h(this).closest("form")).val(),b=h(this).closest("form"),d=h("#method"),e=d.closest("form"),f=h(".js_bsubmit_pre",e),g=f.data("filed");b.valid()&&(h("#js_pre_phone").val(a),d.val(g),h("#ajaxModal").modal("hide"),c(),e.valid()&&e.submit())});var m=function(a){var b=h(a).closest("div.prize-list").attr("id"),c=b.charAt(b.length-1);h("div#parent_box div.prize-list").addClass("hide"),h("#"+b).removeClass("hide"),h("div.cover_appmsg_item").each(function(a){if(h(this).find("a.js_edit").data("size")==c){h(this).addClass("on");var b,d=h(this).position().top;b=d-34>0?d-34:0,0==a&&(b=0),0==c&&(b=0),h("#parent_box").css("margin-top",b),h(".scrollable").animate({scrollTop:b},300)}else h(this).removeClass("on")})};h(document).on("click","input.condition",function(){{var a=h(this),b=a.closest(".js_articles_list"),c=h("input.condition",b).closest(".form-group");a.prop("checked")}c.find('input[type="text"], select').attr("disabled","disabled").removeClass("error"),c.find("span.error").remove(),a.closest(".form-group").find('input[type="text"], select').removeAttr("disabled")}),h(document).on("click","input.js_original_select",function(){var a=h(this),b=(a.closest(".js_articles_list"),a.closest(".form-group")),c=h(".js_original_select_url",b),d=a.prop("checked");c.prop("disabled",!d),d||(c.removeClass("error"),h("span.error",b).remove())}),h(document).on("click",".js_style_select_articles",function(){e(h(this))}),h(document).on("change",".js_subject_type",function(){f(h(this),"")})}),define("dist/add_graphic/select",[],function(){!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){a.cxSelect=function(b){for(var c,b,d={dom:{},api:{}},e=function(a){return a&&("function"==typeof HTMLElement||"object"==typeof HTMLElement)&&a instanceof HTMLElement?!0:a&&a.nodeType&&1===a.nodeType?!0:!1},f=function(a){return a&&a.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&a instanceof jQuery?!0:!1},g=function(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},h=0,i=arguments.length;i>h;h++)f(arguments[h])?c=arguments[h]:e(arguments[h])?c=a(arguments[h]):"object"==typeof arguments[h]&&(b=arguments[h]);return c.length<1?void 0:(d.init=function(){var d=this;if(d.dom.box=c,d.settings=a.extend({},a.cxSelect.defaults,b,{url:d.dom.box.data("url"),nodata:d.dom.box.data("nodata"),required:d.dom.box.data("required"),firstTitle:d.dom.box.data("firstTitle"),firstValue:d.dom.box.data("firstValue")}),d.settings.selects.length){d.selectArray=[],d.selectSum=d.settings.selects.length;for(var e=0;e<d.selectSum&&d.dom.box.find("select."+d.settings.selects[e]);e++)d.selectArray.push(d.dom.box.find("select."+d.settings.selects[e]));d.selectSum=d.selectArray.length,d.selectSum&&("string"==typeof d.settings.url?a.getJSON(d.settings.url,function(a){d.dataJson=a,d.buildContent()}):"object"==typeof d.settings.url&&(d.dataJson=d.settings.url,d.buildContent()))}},d.getIndex=function(a){return this.settings.required?a:a-1},d.getNewOptions=function(b,c){if(b){var d=this.settings.firstTitle,e=this.settings.firstValue,f=b.data("firstTitle"),g=b.data("firstValue"),h="";return("string"==typeof f||"number"==typeof f||"boolean"==typeof f)&&(d=f.toString()),("string"==typeof g||"number"==typeof g||"boolean"==typeof g)&&(e=g.toString()),this.settings.required||(h='<option value="'+e+'">'+d+"</option>"),a.each(c,function(a,b){h+="string"==typeof b.v||"number"==typeof b.v||"boolean"==typeof b.v?'<option value="'+b.v+'">'+b.n+"</option>":'<option value="'+b.n+'">'+b.n+"</option>"}),h}},d.buildContent=function(){var a=this;a.dom.box.on("change","select",function(){a.selectChange(this.className)});var b=a.getNewOptions(a.selectArray[0],a.dataJson);a.selectArray[0].html(b).prop("disabled",!1).trigger("change"),a.setDefaultValue()},d.setDefaultValue=function(a){a=a||0;var b,c=this;a>=c.selectSum||!c.selectArray[a]||(b=c.selectArray[a].data("value"),("string"==typeof b||"number"==typeof b||"boolean"==typeof b)&&(b=b.toString(),setTimeout(function(){c.selectArray[a].val(b).trigger("change"),a++,c.setDefaultValue(a)},1)))},d.selectChange=function(a){a=a.replace(/ /g,","),a=","+a+",";for(var b,c,d,e,f=[],h=0;h<this.selectSum;h++)f.push(this.getIndex(this.selectArray[h].get(0).selectedIndex)),"number"==typeof b&&h>b&&(this.selectArray[h].empty().prop("disabled",!0),"none"===this.settings.nodata?this.selectArray[h].css("display","none"):"hidden"===this.settings.nodata&&this.selectArray[h].css("visibility","hidden")),a.indexOf(","+this.settings.selects[h]+",")>-1&&(b=h);c=b+1,d=this.dataJson;for(var h=0;c>h;h++){if("undefined"==typeof d[f[h]]||g(d[f[h]].s)===!1||!d[f[h]].s.length)return;d=d[f[h]].s}this.selectArray[c]&&(e=this.getNewOptions(this.selectArray[c],d),this.selectArray[c].html(e).prop("disabled",!1).css({display:"",visibility:""}).trigger("change"))},d.init(),this)},a.cxSelect.defaults={selects:[],url:null,nodata:null,required:!1,firstTitle:"请选择",firstValue:""},a.fn.cxSelect=function(b,c){return this.each(function(){a.cxSelect(this,b,c)}),this}})});