/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/graphic/init",["$","dist/application/app","masonry","./template/modal.html","./template/goods.html"],function(a,b){"use strict";var c=a("$"),d=a("dist/application/app"),e=d.config,f=d.method;a("masonry");var g=a("./template/modal.html"),h=a("./template/goods.html");b.init=function(b,d){function i(b,d,g,i,m){f.post(b,function(b){if(e.issucceed(b)){switch(b.types=m,i){case"fn":g.html(template.compile(fn)(b));break;case"classes":g.html(template.compile(classes)(b));break;case"actpage":g.html(template.compile(actpage)(b));break;case"goods":b.data.pagelist=j(b.data),g.html(template.compile(h)(b))}l=b.data.list;var d=c(".js_link_copy_text",document);d.length>0&&a.async("zeroclipboard",function(){ZeroClipboard.setDefaults({moviePath:"/assets/swf/zeroclipboard.swf"}),c.each(d,function(a){var b='<button class="btn btn-default js_link_copy btn-sm" id="{0}" type="button" data-clipboard-target="{2}" data-clipboard-text="{1}">复制链接</button>  <span class="alert copy-success  alert-success hd " style="position: absolute;left: -173px;top:-3px;">复制成功,请粘帖到您需要的地方</span>';c(this).data("icon")&&(b='<i id="{0}" data-clipboard-target="{2}" data-clipboard-text="{1}" class="fa fa-copy js_link_copy"></i><span class="alert copy-success  alert-success hd " style="position: absolute;left: -173px;top:-3px;">复制成功,请粘帖到您需要的地方</span>');var d="copy_button{0}".format(a),e=b,f=c(this),g=f.text().trim(),h=f.attr("id");h?f.after(e.format(d,"",h)):f.append(e.format(d,g));var i=c("#"+d),j=new ZeroClipboard(i),k=function(a){var b=a.nextAll("span.copy-success");b.show(),setTimeout(function(){b.fadeOut()},1e3),setTimeout(function(){c("#ajaxModalLink").modal("hide")},2e3)};j.on("complete",function(a){k(c(a.options.button))})}),k.on("click","button.js_link_copy",function(){var a=c(this),b=a.data("clipboard-text").trim();c.browser.msie?(window.clipboardData.setData("Text",b),success(a)):prompt("按下 Ctrl+C 复制到剪贴板",b)})})}else e.msg.error(b.message)},e.lang.exception,!1,d)}function j(a){var b=[],c=a.totalPage,d=a.currentPage;if(c>0)if(c-d>=2){var e=1,f=5;e=d-2>0?d-2:1,f=e+4;for(var g=e;f>=g;g++)g>0&&c>=g&&b.push(g)}else{var e=1,f=5;f=c>=d+2?d+2:c,e=f-4;for(var g=e;f>=g;g++)g>0&&c>=g&&b.push(g)}return b}c("#ajaxModalLink").remove();var k=c('<div class="modal fade" id="ajaxModalLink"><div class="modal-body "></div></div>');c(document).append(k),k.modal();var l=null,m=d.data("path"),n=d.data("type"),o=d.data("holder")||"图文标题",p="选择图文素材",q=d.data("select")||"goods";"copy"==n&&(p="复制链接");var r={path:m,types:n,ctype:q,title:p,holder:o};k.append2(template.compile(g)(r),function(){var a=c(".nav-tabs a[data-type="+q+"]",k).data("id"),b=c("#"+a,k),d=b.find(".js_alllink_list");i(m,{},d,q,n),setTimeout(function(){c(".appmsg_sort").masonry()},500)}),c('a[data-toggle="tab"]',k).on("show.bs.tab",function(a){var b=c(a.target),d=b.data("id"),e=c("#"+d).find(".js_alllink_list");e.length>0?e.html('<i class="fa fa-spinner fa-spin"></i>'):c("#"+d).html('<i class="fa fa-spinner fa-spin"></i>')}),c('a[data-toggle="tab"]',k).on("shown.bs.tab",function(a){var b=c(a.target),d=b.data("id"),e=b.data("type"),f=c("#"+d).find(".js_alllink_list");f.length>0?i(m,{},f,e,n):i(m,{},c("#"+d),e,n),setTimeout(function(){c(".appmsg_sort").masonry()},500)}),k.on("click",".js_graphic_add_model,.js_appmsg_col_list",function(){var a=c(this),b=(a.data("lists"),a.data("id")),e=l.map(function(a){return a.id}).indexOf(b),f=d.closest(".js_replay_type_div"),g=d.data("page"),h=c(".js_appmsg_list",f);"qrcode"==g?(h=d.closest(".col-sm-8"),h.after(template("js_graphic_list_template",{zitem:l[e]})),h.addClass("hide"),h.find(".nosubmit").attr("disabled","disabled")):(h.html(template("js_graphic_list_template",{zitem:l[e]})),h.removeClass("hide"),c(".js_graphic_select",f).addClass("hide")),k.modal("hide")}),k.on("click","footer[data-type='ajaxPage'] a",function(){var a=c(this),b=a.closest("li"),d=b.hasClass("disabled"),e=b.hasClass("active"),f=a.closest("div.tab-pane"),g=(f.attr("id"),f.find("form")),h=g.data("type"),j=g.data("path"),l=c(".js_alllink_page",g),m=f.find(".js_alllink_list"),o=a.data("pageNum");if(j+="?submittype=page",!d&&!e){l.val(o),k.find("footer[data-type='ajaxPage'] li.active").removeClass("active"),b.addClass("active");var p=g.serialize();m.length>0?i(j,p,m,h,n):i(j,p,f,h,n),setTimeout(function(){c(".appmsg_sort").masonry()},500)}}),k.on("click","button[data-type='ajaxSearch']",function(){var a=c(this),b=a.closest("div.tab-pane"),d=a.closest("form"),e=d.data("type"),f=d.data("path"),g=c(".js_alllink_page",d),h=b.find(".js_alllink_list");g.val(1);var j=d.serialize();f+="?submittype=search",h.length>0?i(f,j,h,e,n):i(f,j,b,e,n),setTimeout(function(){c(".appmsg_sort").masonry()},500)})}}),define("dist/graphic/template/modal.html",[],'<div class="modal-dialog" style="width:780px">\n    <div class="modal-content">\n        <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal">×</button>\n            <h4 class="modal-title">{{title}}</h4>\n        </div>\n        <div class="modal-body">\n            <section class="panel panel-default" style="margin-bottom:0;">\n                <header class="panel-heading bg-light hide">\n                    <ul class="nav nav-tabs">\n                        <li class="{{if ctype==\'goods\'}}active{{/if}}">\n                            <a href="#js_alllink_goods" data-id="js_alllink_goods" data-toggle="tab" data-path="{{path}}" data-type="goods">素材</a>\n                        </li>\n                        \n                    </ul>\n                </header>\n\n                <div class="panel-body">\n                    <div class="tab-content"> \n                        <div class="tab-pane {{if ctype==\'goods\'}}active{{/if}}" id="js_alllink_goods" data-type="goods" style="overflow-x:hidden">\n                            <form class="form-horizontal search-form" data-type="goods" data-path="{{path}}">\n                                <div class="form-group">\n                                    <div class="col-sm-6 col-sm-offset-6">\n                                        <div class="input-group">\n                                            <input type="text" class="input-sm form-control" name="keywords" placeholder="{{holder}}" value=""/>\n                                            <span class="input-group-btn">\n                                                <button class="btn btn-sm btn-default" data-type="ajaxSearch" type="button" title="搜索">\n                                                    <i class="fa fa-search"></i>\n                                                </button>\n                                            </span>\n                                        </div>\n                                    </div>\n                                </div>\n                                <input type="hidden" name="page" class="js_alllink_page" value="1"/>\n                            </form>\n                            <div class="js_alllink_list">\n                                <i class="fa fa-spinner fa-spin"></i>\n                            </div>\n                            \n                        </div>\n                    </div>\n                </div>\n            </section>\n            \n        </div>\n        <form class="form-horizontal form-modal" method="post"  novalidate="novalidate">\n            <div class="modal-footer m-t-none">\n                <input type="hidden" value="12306" name="id">\n                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\n            </div>\n        </form>\n    </div>\n</div>\n'),define("dist/graphic/template/goods.html",[],'\n{{if data.list}}\n<div class="row m-t-none">\n  <div class="col-sm-12 m-t-none">\n    <div class="appmsg_list appmsg_sort">\n      {{each data.list as zitem}}\n      <div class="appmsg_col show_item pointer js_appmsg_col_list" data-id="{{zitem.id}}" data-lists="{{zitem}}" style="margin-right:4px;margin-left:4px">\n        <div class="inner">\n          <div class="js_appmsgitem">\n            <div class="appmsg multi">\n              <div class="appmsg_content">\n                <div class="appmsg_info">\n                  {{if zitem.isInValid}}\n                  <h3 class="m-t-none text-danger">有失效商品</h3>\n                  {{/if}} <em class="appmsg_date">{{zitem.date}}</em>\n                </div>\n                <div class="cover_appmsg_item">\n                  <h4 class="appmsg_title js_title">{{zitem.subtitle}}</h4>\n                  <div class="appmsg_thumb_wrp">\n                    <img src="{{zitem.img}}" alt="" class="appmsg_thumb"></div>\n                </div>\n                {{if zitem.item}}\n                    {{each zitem.item as sitem}}\n                <div class="appmsg_item">\n                  <img src="{{sitem.img}}">\n                  <h4 class="appmsg_title js_title">{{sitem.title}}</h4>\n                </div>\n                {{/each}}\n                  {{/if}}\n                <div class="appmsg_opr">\n                  <ul>\n                    <li class="appmsg_opr_item grid_item size1of2 no_extra" style="width:100%;">\n                      <a href="javascript:;"  class="js_graphic_add_model" title="选择" data-id="{{zitem.id}}" data-lists="{{zitem}}"> <i class="fa fa-check-circle text-muted" style="border-right:0"></i>\n                      </a>\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="appmsg_col_list_hover">\n              \n          </div>\n        </div>\n      </div>\n      {{/each}}\n    </div>\n\n  </div>\n</div>\n{{else}}\n<div class="row m-t-sm text-center">暂无数据</div>\n{{/if}}\n\n{{if data.count>0}}\n<footer class="footer bg-white b-t m-t-sm" data-type="ajaxPage">\n  <div class="row text-center-xs">\n    <div class="col-md-6 hidden-sm">\n      <p class="text-muted m-t">总共{{data.count}}条 当前为第{{data.currentPage}}页</p>\n    </div>\n    <div class="col-md-6 col-sm-12 text-right text-center-xs">\n      <ul class="pagination pagination-sm m-t-sm m-b-none" data-apages-total="{{data.totalPage}}" data-apage-current="{{data.currentPage}}">\n\n        <li {{if data.currentPage==1}} class="disabled"{{/if}}>\n          <a href="javascript:;" rel="first" data-page-num="1"> <i class="fa fa-angle-double-left" title="第一页"></i>\n          </a>\n        </li>\n        <li {{if data.currentPage==1}} class="disabled"{{/if}}>\n          <a href="javascript:;" rel="prev" data-page-num="{{data.currentPage-1}}">\n            <i class="fa fa-angle-left" title="上一页"></i>\n          </a>\n        </li>\n        {{each data.pagelist as item}}\n        <li {{if data.currentPage==item}} class="active"{{/if}}>\n          <a href="javascript:;" data-page-num="{{item}}" data-page-isnum="true">{{item}}</a>\n        </li>\n        {{/each}}\n        <li {{if data.currentPage==data.totalPage}} class="disabled"{{/if}}>\n          <a href="javascript:;" rel="next" data-page-num="{{data.currentPage+1}}">\n            <i class="fa fa-angle-right" title="下一页"></i>\n          </a>\n        </li>\n        <li {{if data.currentPage==data.totalPage}} class="disabled"{{/if}}>\n          <a href="javascript:;" rel="last" data-page-num="{{data.totalPage}}">\n            <i class="fa fa-angle-double-right" title="最后页" ></i>\n          </a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</footer>\n{{/if}}');