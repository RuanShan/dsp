/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/event/init",["$","dist/application/app"],function(a){"use strict";function b(a,b,d){c(document).on("change",a,function(){var a=c(this),e=a.data("val"),f=c(this).parents("div.sel-box").find(".js_con_box");f.html(""),e?(c(b).addClass("hide"),c(d).removeClass("hide")):(c(b).removeClass("hide"),c(d).addClass("hide"))})}{var c=a("$"),d=a("dist/application/app"),e=d.config;d.method}c(document).on("change",".js_limit",function(a){a.preventDefault();var b=c(this),d=b.data("msg"),f=b.parents("div.sel-box").find(".js_event_add"),g=b.parents("div.sel-box").find(".js_con_box");b.prop("checked")?e.msg.msgbox.confirm(d,function(a){a?(f.addClass("hide"),g.html("")):(f.removeClass("hide"),b.removeAttr("checked"))}):f.removeClass("hide")}),c(document).on("click",".js_event_add",function(){var a=c(this).parents("div.sel-box"),b=a.find(".js_con_box"),d=a.data("val"),f=a.find("div.event-list").length,g=f+1,h=a.find('.js_tit input[type="radio"]:checked').data("val"),i={};if(i.num=g,i.size=f,i.tit=h,1==d)if(5>f){var j=template("cut_temp",i);c(j).appendTo(b)}else e.msg.info("最多添加5个优惠");else if(2==d)if(5>f){var j=template("agio_temp",i);c(j).appendTo(b)}else e.msg.info("最多添加5个优惠");else if(4==d)if(5>f){var j=template("son_temp",i);c(j).appendTo(b)}else e.msg.info("最多添加5个优惠");else if(3==d)if(5>f){i.area="<span class='js_no_area'>默认全国包邮<input type='hidden' value='{&quot;110000&quot;:{&quot;checkall&quot;:false},&quot;110100&quot;:{&quot;checkall&quot;:false}}' name='area["+f+"]'><input type='hidden' value='' name='text["+f+"]' ></span>";var j=template("postage_temp",i);c(j).appendTo(b)}else e.msg.info("最多添加5个优惠")}),b(".js_cut_type",".js_cut_money",".js_cut_num"),b(".js_agio_type",".js_agio_money",".js_agio_num"),b(".js_son_type",".js_son_money",".js_son_num"),b(".js_postage_type",".js_postage_money",".js_postage_num"),c(document).on("click",".js_del",function(){var a=c(this).parents("div.event-list"),b=a.siblings("div.event-list"),d=!1;3==c(this).parents("div.sel-box").data("val")&&(d=!0),a.remove(),b.each(function(a){var b=c(this).find("input"),e=a+1;if(c(this).find(".js_num").html("优惠"+(a+2)+"："),b.each(function(){if(c(this).prop("name")){var a=c(this).attr("name").split("[");a.splice(1,1,e+"]");var b=a.join("[");c(this).attr("name",b)}}),d){var f=c(this).find("a.js_edit_city");f.attr("data-name","area["+e+"]"),f.attr("data-text","text["+e+"]")}})}),c(".js_cxselect_type:checked").data("val")?c(".js_postage_cxselect").removeClass("hide"):c(".js_postage_cxselect").addClass("hide"),c(document).on("change",".js_cxselect_type",function(){var a=c(this).data("val");a?c(".js_postage_cxselect").removeClass("hide"):c(".js_postage_cxselect").addClass("hide")}),c(document).on("click",".js_sec",function(){var a=c(this),b=c("div.sel-box");b.each(function(){var b=c(this);if(!b.hasClass("hide")){var d=b.data("val");if(1==d){var f=b.find("div.event-list"),g=0,h=0,i=0,j=f.length-1,k=b.find('.js_tit input[type="radio"]:checked').data("bools");b.closest("form").valid(),b.closest("form").valid()&&f.each(function(b){var d=c(this).find('input[type="text"]'),l=c(this).find("input.js_coupon_value"),m=[],n=[];if(d.each(function(){c(this).closest("div.form-group").hasClass("hide")||c(this).hasClass("js_couponajax")||m.push(parseFloat(c(this).val()))}),l.each(function(){c(this).closest("div.form-group").hasClass("hide")||parseFloat(c(this).val())&&n.push(parseFloat(c(this).val()))}),0==b){if(g=m[0],i=n[0],h=m[1],h>=g&&k)return e.msg.error("优惠"+(b+1)+"设置有误"),!1;1==f.length&&a.submit()}else{var o=m[0],p=n[0],q=m[1];if(k){if(!(o>g&&q>h&&o>q))return e.msg.error("优惠"+(b+1)+"设置有误"),!1;if(g=o,h=q,!(p>i)&&i&&p)return e.msg.error("优惠"+(b+1)+"设置有误"),!1;p&&(i=p),b==j&&a.submit()}else{if(!(o>g&&q>h))return e.msg.error("优惠"+(b+1)+"设置有误"),!1;if(g=o,h=q,!(p>i)&&i&&p)return e.msg.error("优惠"+(b+1)+"设置有误"),!1;p&&(i=p),b==j&&a.submit()}}})}else if(2==d){var f=b.find("div.event-list"),g=0,h=0,i=0,j=f.length-1;b.closest("form").valid(),b.closest("form").valid()&&f.each(function(b){var d=c(this).find('input[type="text"]'),k=c(this).find("input.js_coupon_value"),l=[],m=[];if(d.each(function(){c(this).closest("div.form-group").hasClass("hide")||c(this).hasClass("js_couponajax")||l.push(parseFloat(c(this).val()))}),k.each(function(){c(this).closest("div.form-group").hasClass("hide")||parseFloat(c(this).val())&&m.push(parseFloat(c(this).val()))}),0==b)g=l[0],i=m[0],h=l[1],1==f.length&&a.submit();else{var n=l[0],o=m[0],p=l[1];if(!(n>g&&h>p))return e.msg.error("优惠"+(b+1)+"设置有误"),!1;if(g=n,h=p,!(o>i)&&i&&o)return e.msg.error("优惠"+(b+1)+"设置有误"),!1;o&&(i=o),b==j&&a.submit()}})}else if(4==d){var f=b.find("div.event-list"),g=0,h=0,i=0,j=f.length-1;b.closest("form").valid(),b.closest("form").valid()&&f.each(function(b){var d=c(this).find('input[type="text"]'),k=c(this).find("input.js_coupon_value"),l=[],m=[];if(d.each(function(){c(this).closest("div.form-group").hasClass("hide")||c(this).hasClass("js_couponajax")||l.push(parseFloat(c(this).val()))}),k.each(function(){c(this).closest("div.form-group").hasClass("hide")||parseFloat(c(this).val())&&m.push(parseFloat(c(this).val()))}),0==b)g=l[0],i=m[0],h=l[1],1==f.length&&a.submit();else{var n=l[0],o=m[0],p=l[1];if(!(n>g))return e.msg.error("优惠"+(b+1)+"设置有误"),!1;if(g=n,h=p,!(o>i))return e.msg.error("优惠"+(b+1)+"设置有误"),!1;i=o,b==j&&a.submit()}})}else{var f=b.find("div.event-list"),g=0,j=f.length-1;b.closest("form").valid(),b.closest("form").valid()&&f.each(function(b){var d=c(this).find('input[type="text"]'),h=(c(this).find(".js_scro"),[]);if(d.each(function(){c(this).closest("div.form-group").hasClass("hide")||h.push(parseFloat(c(this).val()))}),0==b)g=h[0],1==f.length&&a.submit();else{var i=h[0];if(!(i>g))return e.msg.error("优惠"+(b+1)+"设置有误"),!1;g=i,b==j&&a.submit()}})}}})}),c(document).on("change",".js_goods_type",function(a){a.preventDefault();var b=c(this),d=b.data("msg"),f=b.parents("div.step-forms").find(".js_event_goods"),g=b.closest("label").siblings("label").find(".js_goods_type");b.data("val")?e.msg.msgbox.confirm(d,function(a){a?(f.addClass("hide"),c(".js_goods_type").val(1)):(f.removeClass("hide"),b.removeAttr("checked"),g.attr("checked","checked"),c(".js_goods_type").val(0))}):(f.removeClass("hide"),c(".js_goods_type").val(0)),"js_goods_typeall"==b.data("type")&&f.addClass("hide")}),c(document).on("click",".js_step_prev",function(){{var a=c(this),b=c(".js_step"),d=b.data("step"),e=c(".js_step1"),f=c(".js_step2"),g=c(".js_step3"),h=c(".js_step1_title"),i=c(".js_step2_title"),j=c(".js_step3_title"),k=c(".js_step_next");a.closest("form")}2==d&&(f.addClass("hide"),e.removeClass("hide"),a.addClass("hide"),h.addClass("js_active"),i.removeClass("js_active"),b.data("step",d-1)),3==d&&(g.addClass("hide"),f.removeClass("hide"),k.removeClass("hide"),i.addClass("js_active"),j.removeClass("js_active"),b.data("step",d-1)),setTimeout(function(){c(".js_scrollable")[0].scrollTop=0},1)}),c(document).on("click",".js_step_next",function(){{var a=c(this),b=c(".js_step"),d=b.data("step"),e=c(".js_step1"),f=c(".js_step2"),g=c(".js_step3"),h=c(".js_step1_title"),i=c(".js_step2_title"),j=c(".js_step3_title"),k=c(".js_step_prev");a.closest("form")}1==d&&(e.addClass("hide"),f.removeClass("hide"),k.removeClass("hide"),h.removeClass("js_active"),i.addClass("js_active"),b.data("step",d+1)),2==d&&(f.addClass("hide"),a.addClass("hide"),g.removeClass("hide"),i.removeClass("js_active"),j.addClass("js_active"),b.data("step",d+1)),setTimeout(function(){c(".js_scrollable")[0].scrollTop=0},1)}),c(document).on("click",'[data-toggle="couponajaxremove"]',function(){var a=c(this),b=a.closest(".input-group");c(".js_coupon_value",b).val(""),c(".js_couponajax",b).val(""),c(".js_coupon_id",b).val("")}),window.bclose=function(){setTimeout(function(){window.opener=null,window.open("","_self"),window.close()},3e3)}});