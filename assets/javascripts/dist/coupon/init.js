/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/coupon/init",["$","dist/application/app","./coupon","validate","./goods","./settings"],function(a){"use strict";{var b=a("$"),c=a("dist/application/app");c.config,c.method}a("./coupon"),a("./goods"),a("./settings"),b(document).on("click",".couponUL li",function(){var a=b(this),c=a.closest(".couponUL");b(".js_sign_input",c).attr("disabled",!0),b(".selected-sign",c).addClass("hide"),b(".selected-sign-i",c).addClass("hide"),b(".selected-sign",a).removeClass("hide"),b(".selected-sign-i",a).removeClass("hide"),b(".js_sign_input",a).attr("disabled",!1),b(".coupon_panel2").addClass("hide"),b(".coupon_panel1").addClass("hide"),a.hasClass("couponli1")?b(".coupon_panel1").removeClass("hide"):b(".coupon_panel2").removeClass("hide")}),b(document).on("click",".coupon_panel1_1select",function(){b(".coupon_panel1_1").removeClass("hide"),b(".coupon_panel1_2").addClass("hide")}),b(document).on("click",".coupon_panel1_2select",function(){b(".coupon_panel1_2").removeClass("hide"),b(".coupon_panel1_1").addClass("hide")}),b(document).on("click",".coupon_panel2_1select",function(){b(".coupon_panel2_1").removeClass("hide"),b(".coupon_panel2_2").addClass("hide")}),b(document).on("click",".coupon_panel2_2select",function(){b(".coupon_panel2_2").removeClass("hide"),b(".coupon_panel2_1").addClass("hide")}),b(document).on("click",".js_select_url_type",function(){var a=b(this),c=a.closest(".input-group1"),d=a.closest(".form_sel");b(".js_select_url_type",d).each(function(){var a=b(this),c=a.closest(".input-group1");b("input[type='text']",c).prop("disabled",!0).removeClass("error"),b("select",c).prop("disabled",!0),c.next("span.error").remove()}),b("input[type='text']",c).prop("disabled",!1),b("select",c).prop("disabled",!1),b(this).hasClass("condselect")?b(this).closest(".form_sel").find(".addselecttip").removeClass("hide"):b(this).closest(".form_sel").find(".addselecttip").addClass("hide")})}),define("dist/coupon/coupon",["$","dist/application/app","validate"],function(a){"use strict";{var b=a("$"),c=a("dist/application/app");c.config,c.method}a("validate"),b(document).on("click",'button[data-toggle="toDetail"]',function(a){a&&a.preventDefault();var c=b(this),d=c.closest(".modal-content").find("input:checked").data("url");d&&(window.location=d)}),b.validate.addMethod("isValidNum",function(a,b){var c=/^[1-9](\.[0-9])?$/;return this.optional(b)||c.test(a)},"请填写1-9.9之间的数字"),b.validate.addMethod("isValidNum2",function(a,b){var c=parseFloat(a);return this.optional(b)||c>.01},"请填写大于0.01的数字"),b(document).on("click",".js_color",function(){var a=b(this),c=a.data("class"),d=b(".js_selected_color"),e=d.data("class"),f=b(".js_hidden_color");d.removeClass(e).addClass(c).data("class",c),f.val(c)})}),define("dist/coupon/goods",["$","dist/application/app"],function(a){"use strict";var b=a("$"),c=a("dist/application/app"),d=c.config,e=(c.method,b("div.table-responsive")),f=b('table tbody tr td:first-child [type="checkbox"]',e),g=b('[data-toggle^="selGoods"]'),h=b('[data-trigger="selGoods"]');if(f.length>0){var i=function(){var a=b('table tbody tr td:first-child [type="checkbox"]:checked',e),c=a.map(function(){return b(this).val()}).get().join(",");return{ckbox_list:a,values:c}};g.on("click",function(){var a=b(this),c=b(this).data("href"),e=a.html(),f=a.data("return"),g=a.data("returnUrl");d.msg.msgbox.confirm(a.data("msg")||"确定添加选定的商品？",function(h){if(h){a.attr("disabled","disabled");var j=i();a.html('<i class="fa fa-spinner fa-spin"></i>'),b.post(c,{ids:j.values}).done(function(b){d.issucceed(b)?(d.msg.suc(b.message||d.lang.saveSuccess,b.url),f?g?window.location.href=g:window.location.reload():a.removeAttr("disabled")):d.msg.error(b.message||d.lang.saveError,b.url),a.html(e)}).fail(function(){a.html(e),d.msg.info(d.lang.exception)})}})}),b(document).on("change",'div.table-responsive table thead th:first [type="checkbox"]',function(a){a&&a.preventDefault();var c=b(a.target).closest("table"),d=b(a.target).is(":checked");b('tbody tr td:first-child  [type="checkbox"]',c).prop("checked",d),g.add(h).addAttr("disabled",!d)}),b(document).on("change",'div.table-responsive table tbody td:first-child [type="checkbox"]',function(a){a&&a.preventDefault();var c=b(a.target).closest("table"),d=b(a.target).is(":checked"),e=b('tbody tr td:first-child  [type="checkbox"]:checked',c);b('thead th:first [type="checkbox"]',c).prop("checked",d&&e.length==f.length),g.add(h).addAttr("disabled",0==e.length)})}}),define("dist/coupon/settings",["$","dist/application/app"],function(a){"use strict";function b(a,b){d.each(a,function(a,c){var e=d(c).text(),f=template("cityTemplate",{city:e});b.find(".btn-group:contains("+e+")").remove(),b.append(f)})}function c(a,b){d.each(a,function(a,c){var e=d(c).text();b.find(".btn-group:contains("+e+")").remove()})}{var d=a("$"),e=a("dist/application/app"),f=e.config;e.method}d(document).on("click",".js_select_all",function(){var a=d(this),c=d(".js_select_city").next(),e=a.prop("checked"),f=a.closest("table").find('input[type="checkbox"]').not(a);e?(f.attr("checked","checked"),d(".js_city_container").empty(),b(c,d(".js_city_container"))):(f.removeAttr("checked"),d(".js_city_container").empty())}),d(document).on("click",".js_select_dist",function(){var a=d(this),e=d(".js_select_all"),f=a.prop("checked"),g=a.closest("tr").find('input[type="checkbox"]').not(a),h=g.next();f?(g.attr("checked","checked"),b(h,d(".js_city_container"))):(g.removeAttr("checked"),c(h,d(".js_city_container")));var i=d(".js_select_city").length,j=d(".js_select_city:checked").length,k=i==j?!0:!1;k?e.attr("checked","checked"):e.removeAttr("checked")}),d(document).on("click",".js_select_city",function(){var a=d(this),c=d(".js_select_all"),e=a.next(),f=e.text(),g=a.prop("checked"),h=a.closest("tr").find(".js_select_dist"),i=d(".js_select_city").length,j=d(".js_select_city:checked").length,k=a.closest("td").find('input[type="checkbox"]').length,l=a.closest("td").find('input[type="checkbox"]:checked').length,m=k==l?!0:!1,n=i==j?!0:!1;m?h.attr("checked","checked"):h.removeAttr("checked"),n?c.attr("checked","checked"):c.removeAttr("checked"),g?b(e,d(".js_city_container")):d(".js_city_container .btn-group:contains("+f+")").remove()}),d(document).on("click",".js_del",function(){var a=d(this),b=a.prev().text(),c=a.closest(".btn-group"),e=d(".js_select_all"),f=d(".js_select_city").length,g=d(".js_select_city"),h=g.next();c.remove(),d.each(h,function(a,c){var e=d(c),f=e.text();b==f&&(e.prev().removeAttr("checked"),e.closest("tr").find(".js_select_dist").removeAttr("checked"))});var i=d(".js_select_city:checked").length,j=f==i?!0:!1;j?e.attr("checked","checked"):e.removeAttr("checked")}),d(".js_number").text(d(".js_input_number").val()||1001),d(".js_total_price").text(Number(d(".js_input_number").val()*d(".js_price").text()).toFixed(2)),d(".js_input_number").on("input",function(){var a,b=Number(d(this).val()),c=Number(d(".js_price").text()),e=d(".js_total_price"),a=Number(b*c).toFixed(2);e.text(a),d(".js_number").text(d(this).val()),d.ajax({url:window.account,type:"POST",data:{total:a,aid:window.aid}}).done(function(b){var c,e=d(".js_tips_container");0==b.status?c='<p class="form-control-static text-muted js_amount_tips">*该¥<span class="text-danger">'+a+"</span>元投放费用，将暂时冻结。开始投放时将自动开始扣除。若审核不通过，该金额会返还到账户余额中。</p>":(c='<p class="form-control-static text-danger js_amount_tips">*您推广账户的余额不足，请至财务中心充值。</p>',f.msg.info("您推广账户的余额不足，请至财务中心充值!")),e.find(".js_amount_tips").remove().end().prepend(c)}).fail(function(){f.msg.info("网络异常")})})});