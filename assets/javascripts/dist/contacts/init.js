/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/contacts/init",["$","dist/application/app","jstree"],function(a){"use strict";var b=a("$"),c=a("dist/application/app"),d=c.config,e=c.method;a("jstree");var f=b(".js_party_tree");f.length&&b.each(f,function(){var a=b(this),c=a.data("methodPath"),f=a.data("selected"),g=a.data("edit"),h=a.data("addPath")||c,i=a.data("delPath")||c,j=a.data("editPath")||c;c&&e.get(c.format("get_all"),function(c){var k=b.tokenInputConverter.forparty2node(c,{selected:f||[-1]});a.jstree({core:{data:k,check_callback:function(){return!0},themes:{name:!1,url:!1,dir:!1,icons:!0,variant:!1,stripes:!1,responsive:!0,dots:!0}},contextmenu:{select_node:!1,items:function(){if(g){var a=b.jstree.defaults.contextmenu.items();return a.create.label="新增子部门",a.create.action=function(a){var c=b.jstree.reference(a.reference),d=c.get_node(a.reference);c.create_node(d,{type:"default",text:"新增子部门"},"last",function(a){setTimeout(function(){c.edit(a)},0)})},a.rename.label="编辑部门",a.remove.label="删除部门",a.remove.action=function(a){var c=b.jstree.reference(a.reference),f=c.get_node(a.reference);d.msg.msgbox.confirm("<p>确定删除 {0} ?</p><p>没有子部门且没有成员的部门才可以被删除。</p>".format(f.text),function(a){a&&e.postd(i.format("delete"),function(a){d.issucceed(a)?c.delete_node(c.is_selected(f)?c.get_selected():f):d.msg.error(a.message||d.lang.removeError,a.url)},{id:f.id})})},delete a.ccp,a}}},types:{"default":{icon:"icon icon_folder_blue"},valid_children:{icon:"icon icon_folder_blue"}},plugins:["types","contextmenu","wholerow"]}).on("delete_node.jstree",function(a,c){b.jstree.reference(c.node)}).on("create_node.jstree",function(a,c){var f=b.jstree.reference(c.node);e.postd(h.format("create"),function(a){d.issucceed(a)?c.instance.set_id(c.node,a.id):(f.delete_node(c.node),d.msg.error(a.message||d.lang.removeError,a.url))},{type:c.node.type,pid:c.node.parent,text:c.node.text})}).on("rename_node.jstree",function(a,c){b.jstree.reference(c.reference);e.postd(j.format("rename"),function(a){d.issucceed(a)?c.instance.set_id(c.node,a.id):d.msg.error(a.message||d.lang.removeError,a.url)},{id:c.node.id,text:c.text})}).on("select_node.jstree",function(a,b){window.location="?did={0}".format(b.node.id)}).on("set_icon.jstree",function(a){console.log(a)}).on("ready.jstree",function(){f&&f[0]&&b(".js_party_tree").scrollTop(b("#"+f[0]).position().top+b(".js_party_tree").scrollTop())})})});var g=b("#js_app_modal");g.length>0&&function(){var a=g.data("show");a&&setTimeout(function(){g.modal("show")},200)}(),window.attention=function(a){var c=b("#js_attention_modal");b(".js_attention_number",c).html(a),c.modal("show")}});