/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/table/init",["$","dist/application/app","./paginator","./talbe-search"],function(require,exports,module){"use strict";var $=require("$"),app=require("dist/application/app"),config=app.config,method=app.method,entity=app.entity;require("./paginator"),require("./talbe-search");var $pagination=$("ul.pagination");$pagination.length>0&&$pagination.Paginator({totalPages:$pagination.data("pagesTotal"),currentPage:$pagination.data("pageCurrent"),page:function(a){return $("#pageNumber").val(a).trigger("pageNumber:change"),!0}}),$(document).on("click",'[data-toggle^="refresh"]',function(a){a&&a.preventDefault(),window.location.reload()});var $tabletable_responsive=$("div.table-responsive"),ttable=!1,$firsttable="",$lasttable="",$checkbox_list=$('table tbody tr td:first-child [type="checkbox"]',$tabletable_responsive),$batch=$('[data-toggle^="batch"]'),$trigger_batch=$('[data-trigger="batch"]');if($("div.table-responsive table.table-scroll").length>1){ttable=!0,$firsttable=$("div.table-responsive.tab-content:first"),$lasttable=$("div.table-responsive.tab-content:last");var offset=$lasttable.data("offset")||0;$lasttable.css("max-height",$("body").height()-$firsttable.height()-118-offset),$lasttable.scroll(function(){$firsttable.scrollLeft($lasttable.scrollLeft())})}if($checkbox_list.length>0){var get_list=function(){var a=$('table tbody tr td:first-child [type="checkbox"]:checked',$tabletable_responsive),b=a.map(function(){return $(this).val()}).get().join(",");return{ckbox_list:a,values:b}};$batch.on("click",function(){var a=$(this),b=$(this).data("href"),c=a.html();config.msg.msgbox.confirm(a.data("msg")||config.lang.confirmAllremove,function(d){if(d){a.attr("disabled","disabled");var e=get_list();a.html('<i class="fa fa-spinner fa-spin"></i>'),$.post(b,{ids:e.values}).done(function(b){if(config.issucceed(b)){config.msg.suc(b.message||config.lang.removeSuccess,b.url);var d=$.Deferred(),f=function(a){var b=0;return e.ckbox_list.parents("tr").fadeOut(function(){$(this).remove(),b++,e.ckbox_list.length==b&&a.resolve()}),a};$.when(f(d)).done(function(){$batch.addAttr("disabled",0==$('table tbody tr td:first-child [type="checkbox"]:checked',$tabletable_responsive).length),0==$("table tbody tr",$tabletable_responsive).length&&window.location.reload()})}else config.msg.error(b.message||config.lang.removeError,b.url);a.html(c)}).fail(function(){a.html(c),config.msg.info(config.lang.exception)})}})}),$trigger_batch.on("click",function(){var a=get_list();$(this).data("set",{ids:a.values})}),$(document).on("change",'div.table-responsive table thead th:first [type="checkbox"]',function(a){a&&a.preventDefault();var b=$(a.target).closest("table"),c=$(a.target).is(":checked");$('tbody tr td:first-child  [type="checkbox"]',b).prop("checked",c),$batch.add($trigger_batch).addAttr("disabled",!c)}),$(document).on("change",'div.table-responsive table tbody td:first-child [type="checkbox"]',function(a){a&&a.preventDefault();var b=$(a.target).closest("table"),c=$(a.target).is(":checked"),d=$('tbody tr td:first-child  [type="checkbox"]:checked',b);$('thead th:first [type="checkbox"]',b).prop("checked",c&&d.length==$checkbox_list.length),$batch.add($trigger_batch).addAttr("disabled",0==d.length)})}$(document).on("click",'div.table-responsive table tbody [data-toggle="ajaxRemove"]',function(e){e.preventDefault(),console.log(23);var $this=$(this),$remote=$this.data("remote")||$this.attr("href"),$confirm=$this.data("confirm"),$isremove=$this.data("remove");$confirm="undefined"==typeof $confirm?!0:$confirm,$this.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>');var done=function(){var org=$this.html();$this.button("loading"),$.post($remote).done(function(d){if(config.issucceed(d)){config.msg.suc(d.message||config.lang.removeSuccess,d.url);var $tr=$this.parents("tr");$tr.css({"background-color":"#dff0d8"}).find("td").css({"background-color":"#dff0d8"}),$isremove||$tr.fadeOut(function(){$tr.remove(),0==$("table tbody tr").length&&window.location.reload()}),d.callback&&eval(d.callback)}else $this.button("reset"),config.msg.error(d.message||config.lang.removeError,d.url)}).fail(function(){$this.button("reset"),config.msg.info(config.lang.exception)})};$confirm&&config.msg.msgbox.confirm($this.data("msg")||config.lang.confirmRemove,function(a){a&&done()}),!$confirm&&done()}),$(document).on("click","table.entity-view tbody tr",function(a){var b=$(this),c=b.closest("table"),d=b.data("id"),e=b.data("set");if(d)if(b.hasClass("js_entity_selected")){var f=$(".entity-panel");f.length&&f.trigger("close")}else{var g=c.data("path").format(d),h=c.data("form");if(h){var i=$(h).serialize();g=g+"&"+i}var j=$.extend(!0,{onShow:function(){b.addClass("js_entity_selected active")},onClose:function(){b.removeClass("js_entity_selected active")}},{path:g,set:e});entity.init(j,a)}})}),define("dist/table/paginator",["$"],function(a){"use strict";a("$");+function(a){var b=function(a,b){this.isCurrent=function(){return b==a.currentPage},this.isFirst=function(){return 1==b},this.isLast=function(){return b==a.totalPages},this.isPrev=function(){return b==a.currentPage-1},this.isNext=function(){return b==a.currentPage+1},this.isLeftOuter=function(){return b<=a.outerWindow},this.isRightOuter=function(){return a.totalPages-b<a.outerWindow},this.isInsideWindow=function(){return a.currentPage<a.innerWindow+1?b<=2*a.innerWindow+1:a.currentPage>a.totalPages-a.innerWindow?a.totalPages-b<=2*a.innerWindow:Math.abs(a.currentPage-b)<=a.innerWindow},this.number=function(){return b}},c={firstPage:function(b,c,d){var e=a("<li>").append(a('<a href="#">').html(c.first).bind("click.bs-Paginator",function(){return b.firstPage(),!1}));return d.isFirst()&&e.addClass("disabled"),e},prevPage:function(b,c,d){var e=a("<li>").append(a('<a href="#">').attr("rel","prev").html(c.prev).bind("click.bs-Paginator",function(){return b.prevPage(),!1}));return d.isFirst()&&e.addClass("disabled"),e},nextPage:function(b,c,d){var e=a("<li>").append(a('<a href="#">').attr("rel","next").html(c.next).bind("click.bs-Paginator",function(){return b.nextPage(),!1}));return d.isLast()&&e.addClass("disabled"),e},lastPage:function(b,c,d){var e=a("<li>").append(a('<a href="#">').html(c.last).bind("click.bs-Paginator",function(){return b.lastPage(),!1}));return d.isLast()&&e.addClass("disabled"),e},gap:function(b,c){return a("<li>").addClass("disabled").append(a('<a href="#">').html(c.gap))},page:function(b,c,d){var e=a("<li>").append(function(){var c=a('<a href="#">');return d.isNext()&&c.attr("rel","next"),d.isPrev()&&c.attr("rel","prev"),c.html(d.number()),c.bind("click.bs-Paginator",function(){return b.page(d.number()),!1}),c});return d.isCurrent()&&e.addClass("active"),e}},d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$ul=a(b),this.render()};d.DEFAULTS={currentPage:null,totalPages:null,innerWindow:2,outerWindow:0,first:'<i class="fa fa-angle-double-left" title="第一页"></i>',prev:'<i class="fa fa-angle-left" title="上一页"></i>',next:'<i class="fa fa-angle-right" title="下一页"></i>',last:'<i class="fa fa-angle-double-right" title="最后页"></i>',gap:"..",truncate:!1,page:function(){return!0}},d.prototype.render=function(){var a=this.options;if(!a.totalPages)return void this.$element.hide();this.$element.show();var d=new b(a,a.currentPage);d.isFirst()&&a.truncate||(a.first&&this.$ul.append(c.firstPage(this,a,d)),a.prev&&this.$ul.append(c.prevPage(this,a,d)));for(var e=!1,f=1,g=a.totalPages;g>=f;f++){var h=new b(a,f);h.isLeftOuter()||h.isRightOuter()||h.isInsideWindow()?(this.$ul.append(c.page(this,a,h)),e=!1):!e&&a.outerWindow>0&&(this.$ul.append(c.gap(this,a)),e=!0)}d.isLast()&&a.truncate||(a.next&&this.$ul.append(c.nextPage(this,a,d)),a.last&&this.$ul.append(c.lastPage(this,a,d)))},d.prototype.page=function(a,b){var c=this.options;return void 0===b&&(b=c.totalPages),a>0&&b>=a&&c.page(a)&&(this.$ul.empty(),c.currentPage=a,c.totalPages=b,this.render()),!1},d.prototype.firstPage=function(){return this.page(1)},d.prototype.lastPage=function(){return this.page(this.options.totalPages)},d.prototype.nextPage=function(){return this.page(this.options.currentPage+1)},d.prototype.prevPage=function(){return this.page(this.options.currentPage-1)};var e=a.fn.Paginator;a.fn.Paginator=function(b){var c=arguments;return this.each(function(){var e=a(this),f=e.data("bs.Paginator"),g="object"==typeof b&&b;f||e.data("bs.Paginator",f=new d(this,g)),"string"==typeof b&&f[b].apply(f,Array.prototype.slice.call(c,1))})},a.fn.Paginator.Constructor=d,a.fn.Paginator.noConflict=function(){return a.fn.Paginator=e,this}}(jQuery)}),define("dist/table/talbe-search",["$","dist/application/app"],function(a){"use strict";var b=a("$"),c=a("dist/application/app"),d=c.config,e=b("form.talbe-search");if(e.length>0){var f=b("input[type='radio'][name='pageSize']"),g=b("#pageNumber"),h=b("#orderBy"),i=b("#order");f.bind("change",function(){e.submit()}),g.bind("pageNumber:change",function(){e.submit()}),i.bind("order:change",function(){e.submit()});var j=b("th.th-sortable");if(i.val().length>0){var k=b('[data-sort-name="'+i.val()+'"]'),l="asc"==h.val();k.adddClass("select",l),k.append(l?'<span class="th-sort"><i class="fa fa-sort-down text-active"></i><i class="fa fa-sort-up text"></i>  <i class="fa fa-sort"></i>  </span>':'<span class="th-sort">  <i class="fa fa-sort-down text"></i>   <i class="fa fa-sort-up text-active"></i>  <i class="fa fa-sort"></i>  </span>'),k.siblings(".th-sortable").append('<span class="th-sort"><i class="fa fa-sort-down text-active"></i><i class="fa fa-sort-up text-active"></i>  <i class="fa fa-sort"></i>  </span>')}else j.append('<span class="th-sort"><i class="fa fa-sort-down text-active"></i><i class="fa fa-sort-up text-active"></i>  <i class="fa fa-sort"></i>  </span>');j.on("click",function(){var a=b(this),c=a.data("sortName"),d=i.val();i.val(c);var f=d==c?a.hasClass("select"):!0;h.val(f?"desc":"asc"),e.submit()}),b("button[type='submit']",e).bind("click",function(){var a=b('[data-rule-required="true"]');return a.length>0&&0==b.trim(a.val()).length?(d.msg.info("请输入搜索关键词"),!1):void 0}),b("button.clean_btn",e).length&&b("button.clean_btn",e).bind("click",function(){var a=b("input[type='radio']"),c=b("input[type='hidden']"),d=b("input[type='text']");a.val(0),c.val(""),d.val(""),b("#pageNumber").length&&b("#pageNumber").val(1),b("#orderBy").length&&b("#orderBy").val("desc"),b("#order").length&&b("#order").val("depart"),e.submit()})}});