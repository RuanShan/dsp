/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/application/app",["$","./setting","dist/tips/init","./method","./extend","./element","./entity","./plugins","jstree","./tmp/members.html","./tmp/logtmp.html","./jqplugins","./template"],function(a){var b=a("$"),c=a("./setting"),d=a("./method");a("./extend"),a("./element");var e=a("./plugins");e.init(document),a("./jqplugins");var f=a("./entity");return window.template=a("./template"),b.ajaxSetup({cache:!1,dataType:"json"}),b("form.form-validate").length>0&&a.async("dist/form/init",function(a){var c=b("form.form-validate");c.length&&a.init(c)}),b("table").length>0&&a.async("dist/table/init"),template.helper("transMsgTime",function(a){return d.transMsgTime(1e3*parseInt(a))}),{config:c,method:d,plugin:e,entity:f,v:"1.0.1"}}),define("dist/application/setting",["$","dist/tips/init"],function(a,b){"use strict";var c=(a("$"),a("dist/tips/init")),b={kindeditor:{"default":{items:["source","|","undo","redo","|","preview","print","template","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","insertfile","table","hr","emoticons","baidumap","code","pagebreak","link","unlink"],height:"400px",width:"100%",afterCreate:function(){this.sync()},afterBlur:function(){this.sync()},extraFileUploadParams:window.extraFileUploadParams},simple:{items:["undo","redo","plainpaste","plainpaste","wordpaste","clearhtml","quickformat","selectall","fullscreen","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","hr","removeformat","|","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist","|","emoticons","image","link","unlink","preview"],height:"300px",width:"100%",afterCreate:function(){this.sync()},afterBlur:function(){this.sync()}},mini:{items:["fontsize","forecolor","hilitecolor","bold","italic","removeformat","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist","link","unlink"],height:"300px",width:"100%",afterCreate:function(){this.sync()},afterBlur:function(){this.sync()}}},loading:'<div  class="load"></div>',issucceed:function(a){return 0==a.status},membersp:"p",empty:"",lang:{saveSuccess:"保存成功",modifySuccess:"修改成功",saveError:"保存失败",modifyError:"修改失败",exception:"网络异常 请重试",confirmRemove:"确定删除 ?",confirmAllremove:"确定删除选定 ?",removeSuccess:"删除成功",removeError:"删除失败",attributeError:"获取商品属性出错,请重试",specificationsError:"获取商品规格出错,请重试",confirmPost:"确定提交",confirmChangedelivery:"切换计价方式后,所设置当前模版的运费信息将被清空,确认继续",confirmChangetemplet:"你要载入新模版吗？当前数据将被清空",shelvesSuccess:"上架成功",shelvesError:"上架失败 请重试",confirmRefund:"<p><b>确认退款</b></p><p>确认后钱将直接通过原支付方式返回，无法撤销，请再次确认。</p>",confirmRefundGoods:"<p><b>同意退款退货</b></p><p>退货地址：加载中...</p>",confirmCloseOrder:"确定关闭订单,关闭订单后将无法改价或发货",widgetError:"部件添加失败,请重试",pageInfoError:"部件添加失败,请重试",templateConfigLoadError:"模版配置加载失败,请重试",maxNavLength:"最多添加5个导航",maxFnLength:"最多添加4个导航",minOneItem:"至少保留一个",maxItem10:"最多添加10个",pathError:"无法获取Path",uplodError:"上传失败，请重新上传。"},statistics:{},domain:{www:window.location.protocol+"//"+window.location.host,"static":window.location.protocol+"//"+window.location.host}};return window.wm=b,b.msg=window.top!=window.self?window.parent.msg:c,b}),define("dist/application/method",["$","dist/application/setting","dist/tips/init"],function(a){"use strict";var b=a("$"),c=a("dist/application/setting"),d=function(a,c,d,e,f){b.ajax(a,{type:e||"post",data:f,dataType:"json"}).done(function(a){c&&c(a)}).fail(function(){})};return{get:function(a,b,c,e){d(a,b,c,"get",e)},post:function(a,b,c,e,f){d(a,b,c,e,f)},postd:function(a,b,c){d(a,b,!1,!1,c)},transMsgTime:function(a){var b,c,d,e,f,g={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四"};return a?(c=new Date,b="object"==typeof a&&a.constructor===Date?a:new Date(a),d=(c-b)/1e3,60>d?"刚刚":3600>d?Math.floor(d/60)+"分钟前":10800>d?Math.floor(d/3600)+"小时前":(f={year:b.getFullYear(),month:b.getMonth()+1,date:b.getDate(),day:b.getDay(),hours:b.getHours()>=10?b.getHours():"0"+b.getHours().toString(),min:b.getMinutes()>=10?b.getMinutes():"0"+b.getMinutes().toString()},e={year:c.getFullYear(),month:c.getMonth()+1,date:c.getDate(),day:c.getDay()},f.date===e.date&&f.month===e.month&&f.year===e.year?"今天"+f.hours+":"+f.min:e.date-f.date===1&&172800>d?"昨天"+f.hours+":"+f.min:e.day-f.day>0&&604800>d?g[f.day]+f.hours+":"+f.min:f.year===e.year?f.month+"月"+f.date+"日":f.year+"年"+f.month+"月"+f.date+"日")):""},getFormatDateStr:function(a){var b=new Date(1e3*a),c=b.getFullYear(),d=(b.getDate(),b.getMonth()+1);return c+"年"+d+"月"},getFormatDateStrNow:function(){return(new Date).format("yyyy年M月")},getfileExt:function(a){return/[.]/.exec(a)?/[^.]+$/.exec(a.toLowerCase()):""},eventarget:function(a){var a=a||window.event;return a.target||a.srcElement},validKindEditor:function(){var a=!0;return"undefined"!=typeof KindEditor&&KindEditor.instances&&b.each(KindEditor.instances,function(){this.sync();var d=b(this.srcElement[0]),e=d.data("ruleRequired"),f=d.data("msgRequired"),g=d.data("ruleRangelength"),h=d.data("novlida"),i=d.data("msgRangelength"),j=b.trim(d.val()).replace(/(&nbsp;)|\s|\u00a0/g,"");if(e&&!h&&0==j.length){var k=f;c.msg.error(k||"内容不能为空"),a=!1}if(g&&!h){var l=g[0],m=g[1],n=d.val();(n.length<l||n.length>m)&&(c.msg.error(i||"内容不能小于{0}且大于{1}".format(l,m)),a=!1)}}),a},OpenWindowWithPost:function(a,b,c,d){var e=document.createElement("form");e.setAttribute("method",d),e.setAttribute("action",a),e.setAttribute("target",b);for(var f in c){var g=document.createElement("input");g.type="hidden",g.name=c[f].name,g.value=c[f].value,e.appendChild(g)}document.body.appendChild(e),e.submit(),document.body.removeChild(e)},select:function(a){function d(a,c){var g=b(a).data("selected");g&&(c=g);var k=h.length?h[h.length-1].key+","+h[h.length-1].value:j.root;h.push({element:a,key:k,value:c});var l=0;for(var m in i)l++;for(var n in h)if(h[n].element==a)var o=parseInt(n);for(var n in h)o>n&&h[n].element.change(function(){e(a)});o>0&&h[o-1].element.change(function(){e(a,h[o].key)}),a.change(function(){var c=h[o-1]?h[o].key+","+b(this).val():"0,"+b(this).val();"undefined"!=typeof h[o+1]&&(h[o+1].key=c),j.field_name&&b(j.field_name).val(b(this).val()),j.auto&&"undefined"==typeof h[o+1]&&f(c,function(c,f){if(f){var g=b('<select class="form-control pull-left input-s-lg m-r-xs m-b-xs"></select>');a.after(g),d(g,""),e(h[o+1].element,c,f)}})}),e(a,k,c)}function e(a,c,d){var g,h,i,k,l,m,n;if(a.empty(),a.append('<option value="">{0}</option>'.format(j.default_text)),g=f(c,function(){e(a,c,d)}),!g)return j.auto&&a.hide(),!1;a.show();var o=new Array;for(var p in g)o.push(p);0==o.length&&a.hide(),h=1,i=0;for(k in g)g.hasOwnProperty(g[k])||(l=g[k],m="",k==d&&(i=h,m='selected="selected"'),n=b('<option value="'+k+'" '+m+">"+l+"</option>"),a.append(n),h++);a[0]&&(setTimeout(function(){a[0].options[i].selected=!0},0),a[0].selectedIndex=0,a.attr("selectedIndex",i))}function f(a,c){var d,e;if("undefined"==typeof a||","==a[a.length-1])return null;if("undefined"==typeof i[a]){d=0;for(e in i){d++;break}j.ajax?b.getJSON(j.ajax,{key:a},function(b){i[a]=b,c(a,b)}):j.file&&0==d&&b.getJSON(j.file,function(b){i=b,c(a,b)})}return i[a]}function g(a){return"string"==typeof a?b(a):a}var h=[],i={},j={data:{},file:null,root:"0",ajax:null,timeout:30,method:"post",field_name:null,auto:!1,default_text:"请选择"};return a&&jQuery.extend(j,a),i=j.data,{bind:function(a,b){"object"!=typeof a&&(a=g(a)),b=b?b:"",d(a,b)},find:function(a){if(a.length>0)var b=i[0][a[0]],d=i["0,{0}".format(a[0])][a[1]],e=i["0,{0},{1}".format(a[0],a[1])][a[2]];return{p:b,c:d,d:e,toString:function(){return e="undefined"==typeof e?c.empty:e,b+d+e}}}}},URL:function(a){var b=a||window.location.href,c="",d={},e="",f=function(){var a=b,f=a.indexOf("#");if(f>0&&(e=a.substr(f),a=a.substring(0,f)),f=a.indexOf("?"),f>0){c=a.substring(0,f),a=a.substr(f+1);for(var g=a.split("&"),h=0;h<g.length;h++){var i=g[h].split("=");d[i[0]]=i[1]}}else c=b,d={}};this.set=function(a,b){d[a]=encodeURIComponent(b)},this.remove=function(a){a in d&&(d[a]=void 0)},this.get=function(a){return d[a]},this.url=function(){var a=c,b=[];for(var f in d)d[f]&&b.push(f+"="+d[f]);return b.length>0&&(a+="?"+b.join("&")),e.length>0&&(a+=e),a},this.debug=function(){var a=[];for(var b in d)a.push(b+"="+d[b]);alert(a)},f()}}}),define("dist/application/extend",[],function(){"use strict";String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")}),String.prototype.parameters||(String.prototype.parameters=function(){for(var a={},b=new RegExp("([\\?|&])(.+?)=([^&?]*)","ig"),c=b.exec(this);c;)a[c[2]]=c[3],c=b.exec(this);return a}),String.prototype.stripTags||(String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+>/gi,"")}),String.prototype.getNum||(String.prototype.stripTags=function(){return this.replace(/[^d]/g,"")}),String.prototype.getEn||(String.prototype.getEn=function(){return this.replace(/[^A-Za-z]/g,"")}),String.prototype.getCn||(String.prototype.getCn=function(){return this.replace(/[^u4e00-u9fa5uf900-ufa2d]/g,"")}),Date.prototype.format||(Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};/(y+)/i.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a}),window.StringBuilder=function(){this.tmp=new Array},StringBuilder.prototype.Append=function(a){return this.tmp.push(a),this},StringBuilder.prototype.Clear=function(){tmp.length=1},StringBuilder.prototype.toString=function(){return this.tmp.join("")}}),define("dist/application/element",["$","dist/application/setting","dist/tips/init","dist/application/method","dist/application/entity","dist/application/plugins","jstree"],function(require,exports,module){"use strict";function formatRepo(a){if(a.loading)return a.text;var b="<li>"+a.value+"</li>";return b}function formatRepoSelection(a){return a.value||a.text}var $=require("$"),config=require("dist/application/setting"),method=require("dist/application/method"),entity=require("dist/application/entity"),plugin=require("dist/application/plugins");$(document).on("click",'[data-toggle="trigger"]',function(a){a&&a.preventDefault();var b=$(this).data("target").split(":");b&&$(b[0]).trigger(b[1])}),$(document).on("click",'[data-toggle="back"]',function(a){a&&a.preventDefault();var b=$(this).data("url");b?window.location=b:window.history.go(-1)}),$(document).on("click",'[data-toggle="alert"]',function(a){a&&a.preventDefault();var b=$(this),c=b.data("msg")||"确定",d=b.data("url")||"";msgbox.alert(c,function(){d&&(document.location=d)})});var $loadAlert=$('[data-toggle="loadAlert"]');$loadAlert.length>0&&function(){var a=$loadAlert.data("msg")||"确定",b=$loadAlert.data("url")||"";setTimeout(function(){msgbox.alert(a,function(){b&&(document.location=b)})},200)}(),$.fn.extend({popoverClosable:function(a){var b={template:'<div class="popover"><div class="arrow"></div><div class="popover-header"><button type="button" class="close m-r-xs m-t-xs" data-dismiss="popover" aria-hidden="true">&times;</button><h3 class="popover-title"></h3></div><div class="popover-content"></div></div>'};a=$.extend({},b,a);var c=this;c.popover(a),c.on("click",function(a){a.preventDefault(),c.not(this).popover("hide")}),$(document).on("click",'[data-dismiss="popover"]',function(){c.popover("hide")})}}),$('[data-toggle="popover"]').popoverClosable(),$(document).on("click",'[data-toggle^="class"]',function(a){"checkbox"!=a.target.type&&"radio"!=a.target.type&&a&&a.preventDefault();var b,c,d,e,f,g=$(a.target);!g.data("toggle")&&(g=g.closest('[data-toggle^="class"]')),b=g.data().toggle,c=g.data("target")||g.attr("href"),b&&(d=b.split(":")[1])&&(e=d.split(",")),c&&(f=c.split(",")),f&&f.length&&$.each(f,function(a){"#"!=f[a]&&$(f[a]).toggleClass(e[a])}),g.toggleClass("active");var h=$(this),i=h.data("ajax"),j=h.data("fun"),k=h.data("remote")||h.attr("href"),l=null;if(j)switch(j){case"shelves":l=function(a){config.issucceed(a)?config.msg.suc(a.message||config.lang.shelvesSuccess,a.url):config.msg.error(a.message||config.lang.shelvesError,a.url)}}i&&method.post(k,l,null,null,{toggle:h.hasClass("active")})}),$(document).on("click",'[data-toggle="ajaxModal"]',function(a){var b=$(this),c=b.data("confirm"),c="undefined"==typeof c?!1:c,d=function(){$("#ajaxModal").remove(),a.preventDefault();var c=b.data("remote")||b.attr("href"),d=b.data("set"),e=$('<div class="modal fade" id="ajaxModal"><div class="modal-body "></div></div>');$(document).append(e),e.modal(),$.ajax(c,{type:"get",dataType:"html",data:d}).done(function(a){e.append2(a,function(){var a=$("form.form-validate",e);a.length>0&&require.async("dist/form/init",function(b){$("button[type='submit']",e).length&&$("button[type='submit']",e).removeAttr("disabled"),b.init(a),plugin.init(a),$('[data-toggle="popover"]').popover();var c=$('[data-toggle="select2"]');c.length>0&&require.async(["select2"],function(){c.each(function(){var a=$(this),b={},c=a.data("maxcount"),d=a.data("chang"),e=(a.data("remote")||a.attr("href"),a.data("msgRequired")||a.data("placeholder"));c&&(b.maximumSelectionSize=c);var f=$(this).closest("form");if($(f).on("click",'button[type="submit"]',function(){var b=a.val(),c=a.data("ruleRequired"),d=a.closest("div");return!c||d.is(":hidden")||b?void 0:(config.msg.info(e||"请输入必填项"),!1)}),d)switch(d){case"submit":a.on("change",function(){a.closest("form ").submit()})}a.select2(b)})});var d=$('[data-toggle="select2_4"]',a);d.length>0&&require.async(["select2_4"],function(a){console.log(a),d.each(function(){{var a=$(this),b={},c=a.data("maxcount"),d=a.data("chang"),e=a.data("remote")||a.attr("href"),f=a.data("pid"),g=a.data("placeboolean");a.data("msgRequired")||a.data("placeholder")}if(c&&(b.maximumSelectionSize=c),d)switch(d){case"submit":a.on("change",function(){a.closest("form ").submit()})}e?(void 0!=f&&(e=e.format(f)),a.select2({ajax:{url:e,dataType:"json",delay:500,data:function(a){return{q:a.term,page:a.page||1}},processResults:function(b,c){return config.issucceed(b)?(c.page=c.page||1,1==c.page&&g&&b.items.unshift({id:"js_select2_4placeholder",value:a.data("placeholder")}),{results:b.items,pagination:{more:c.page*b.page_num<b.total_count}}):void config.msg.error(b.message||config.lang.sendError)},cache:!0},escapeMarkup:function(a){return a},minimumInputLength:0,templateResult:formatRepo,templateSelection:formatRepoSelection})):a.select2(b),a.change(function(){var a=$(this);"js_select2_4placeholder"==a.val()&&a.find("option:selected").attr("value","")})})});var f=$('[data-toggle="echartsLineArea"]',a);f.length>0&&require.async(["dist/echarts/init.js"],function(a){f.each(function(){var b=$(this).data("path"),c=$(this).data("echartid"),d=$(this).data("type"),e=!0;"line"==d&&(e=!1),b&&method.get(b,function(b){config.issucceed(b)?a.line(c,b.data,{toolbox:{show:!1},isarea:e}):config.msg.error(b.message)})})})}),b.trigger("init",e)})})};c&&config.msg.msgbox.confirm({message:b.data("confirmMsg")||"确认",buttons:{confirm:{label:b.data("confirmText")||"确定"}},callback:function(a){a&&d()}}),!c&&d()}),$('[data-toggle="buttons"]').bind("change",function(){var a=$(this),b=a.data("change");switch(b){case"submit":a.closest("form").submit()}}),$(document).on("click.dropdown-menu",".dropdown-select > .js_custom_list",function(a){return a.preventDefault(),!1}),$(document).on("click.dropdown-menu",".dropdown-select > li > a",function(a){a.preventDefault();var b,c,d,e,f,g,h=$(a.target),i=!1,j=h.data("hide");if(!h.is("a")&&(h=h.closest("a")),c=h.closest(".dropdown-menu"),d=c.parent().find(".dropdown-label"),e=d.text(),b=h.find("input"),i=b.is(":checked"),!(b.is(":disabled")||"radio"==b.attr("type")&&i)){"radio"==b.attr("type")&&c.find("li").removeClass("active"),h.parent().removeClass("active"),!i&&h.parent().addClass("active"),b.prop("checked",!b.prop("checked")),"checkbox"==b.attr("type")&&(""==b.val()?(c.find("input").each(function(){$(this).removeAttr("checked"),$(this).closest("li").removeClass("active")}),b.attr("checked","checked")):c.find("input").each(function(){""==$(this).val()&&($(this).removeAttr("checked"),$(this).closest("li").removeClass("active"))}),h.closest("dd").find("span.dropdown-label").hasClass("error")&&h.closest("dd").find("span.dropdown-label").removeClass("error")),f=c.find("li > a > input:checked"),f.length?(g=[],f.each(function(){var a=$(this).parent().text();$(this).data("title")&&(a=$(this).data("title")),a&&g.push($.trim(a))}),d.data("text",g.join(",")),g=g.length<6?g.join(","):" 选中"+g.length+"项",d.html(g)):(d.html(d.data("placeholder")),d.data("text",d.data("placeholder"))),b.trigger("change",[b.val()]);var k=c.data("change");if(k)switch(k){case"submit":c.closest("form ").submit()}return j?!1:void 0}}),$(document).on("click",'table [data-toggle="removeRow"]',function(){var a=$(this).closest("tr");a.fadeOut(function(){a.remove()})}),$(document).on("click",".js_entity_view",function(a){var b=$(this);if(b.hasClass("js_entity_selected")){var c=$(".entity-panel");c.length&&c.trigger("close")}else{var d=$.extend(!0,{onShow:function(){b.addClass("js_entity_selected active")},onClose:function(){b.removeClass("js_entity_selected active")}},b.data());entity.init(d,a)}}),$(document).on("click",'[data-toggle="openPost"]',function(){var a=$(this),b=a.closest("form"),c=a.data("set"),d=a.data("type")||"get";if(b.length){var e=b.serializeArray();e.push({name:"set",value:c}),method.OpenWindowWithPost(b.attr("action"),"form1",e,d)}}),$(document).on("click",'[data-toggle="ajaxPost"]',function(e){e.preventDefault();var $this=$(this),$remote=$this.data("remote")||$this.attr("href"),$confirm=$this.data("confirm"),$msgType=$this.data("msgType"),$data=$this.data("set"),$remove=$this.data("remove"),$back=$this.data("back");$this.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>');var done=function(){var org=$this.html();$this.button("loading"),$.post($remote,$data).done(function(d){if($this.button("reset"),config.issucceed(d)){if($remove){var $el=$this.closest($remove);$el.fadeOut(function(){$el.remove()})}config.msg.suc(d.message||config.lang.removeSuccess,d.url),$back&&window.history.go(-1)}else config.msg.error(d.message||config.lang.removeError,d.url);d.callback&&eval(d.callback)}).fail(function(){$this.button("reset"),config.msg.info(config.lang.exception)})},retrunMsg=function(a){switch(a){case"refund":return config.lang.confirmRefund;case"refundGoods":return config.lang.confirmRefundGoods}},confirmMsg=$msgType?retrunMsg($msgType):$this.data("msg");$confirm&&config.msg.msgbox.confirm({message:confirmMsg||config.lang.confirmPost,buttons:{confirm:{label:$this.data("confirmText")||"确定"}},callback:function(a){a&&done()}}),!$confirm&&done()}),$(document).on("click",".js_remove_dd_item",function(){var a=$(this),b=a.closest(".dd-item");b.fadeOut(function(){b.remove(),0==$(".dd-item").length&&$("#noitems").removeClass("hide")})}),$(document).on("click",'ol li [data-toggle="ajaxRemove"]',function(a){a.preventDefault();var b=$(this),c=b.data("remote")||b.attr("href"),e=b.data("confirm");e="undefined"==typeof e?!0:e;var f=function(){var a=b.html();b.html('<i class="fa fa-spinner fa-spin"></i>'),$.post(c).done(function(c){if(config.issucceed(c)){config.msg.suc(c.message||config.lang.removeSuccess,c.url);var d=b.parents("li").first();d.find(".dd-handle").css({"background-color":"#dff0d8"}),d.fadeOut(function(){d.remove(),0==$(".dd-item").length&&$noClassify.removeClass("hide")})}else b.html(a),config.msg.error(c.message||config.lang.removeError,c.url)}).fail(function(){b.html(a),config.msg.info(config.lang.exception,d.url)})};e&&config.msg.msgbox.confirm(b.data("msg")||config.lang.confirmRemove,function(a){a&&f()}),!e&&f()}),$(document).on("click",'[data-dismiss="entity"]',function(){$(this).closest(".entity-panel").trigger("close")});var outside="input,textarea,button,select,option,a,button,.entity-panel,.modal";$(document).on("keyup",function(a){var b=$(".entity-panel");if(b.length){if($(method.eventarget(a)).closest(outside).length)return!0;27===a.which&&b.trigger("close")}}),$(document).on("click",'[data-toggle="ajaxPostPage"]',function(e){e.preventDefault();var $this=$(this),$remote=$this.data("remote")||$this.attr("href"),$confirm=$this.data("confirm"),$msgType=$this.data("msgType"),$data=$this.data("set"),$remove=$this.data("remove");$this.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>');var done=function(){var org=$this.html();$this.button("loading"),$.post($remote).done(function(d){if($this.button("reset"),config.issucceed(d)){if($remove){var $el=$this.closest($remove);$el.fadeOut(function(){$el.remove()})}config.msg.suc(d.message||config.lang.removeSuccess,d.url),d.callback&&eval(d.callback)}else config.msg.error(d.message||config.lang.removeError,d.url)}).fail(function(){$this.button("reset"),config.msg.info(config.lang.exception)})};done()}),$(document).on("click",function(a){return $(method.eventarget(a)).closest(outside).length?!0:void(!$(this).closest("table.entity-view").length&&function(){var a=$(".entity-panel");a.length&&a.trigger("close")}())}),$(document).on("click",'[data-toggle="ajaxSwitch"]',function(e){e.preventDefault();var $this=$(this),$remote=$this.data("remote")||$this.attr("href"),done=function(){$.post($remote).done(function(d){config.issucceed(d)?($this.toggleClass("active"),config.msg.suc(d.message,d.url),d.callback&&eval(d.callback)):config.msg.error(d.message,d.url)}).fail(function(){config.msg.info(config.lang.exception)})};done()})}),define("dist/application/entity",["$","dist/application/setting","dist/tips/init","dist/application/method","dist/application/plugins","jstree"],function(a){"use strict";var b=a("$"),c=a("dist/application/setting"),d=a("dist/application/method"),e=a("dist/application/plugins"),f=a("dist/application/tmp/logtmp.html");return{init:function(a,g){var h=b(g.target),i=h.data("force");if(!i&&b(d.eventarget(g)).closest("input,textarea,button,select,option,a").length)return!0;this.options=b.extend(!0,{},a);var j=b(".entity-panel");j.length&&j.trigger("close"),this.options.path?b.ajax(this.options.path,{type:"get",dataType:"html",data:a.set}).done(function(c){var d=b(c);b("body").append(d),e.init(d),d.removeClass("hd").animate({right:0},"fast"),d.bind("close",function(){d.animate({right:"-35%"},"fast",function(){d.remove()}),a.onClose&&a.onClose()});var g=b(".js_operlog",d);if(g.length>0){var h=g.data("path");h&&g.scrollPage({selector:".contact_log_items li:last",path:h,data:{count:40}},function(a,c){a.scrollPage("toggleDone",c.is_continue),c.list&&c.list.length>0&&b(".contact_log_items",g).append(template.compile(f)(c))})}}).fail(function(){c.msg.info(c.lang.exception)}).always(function(){a.onShow&&a.onShow()}):(c.msg.info(c.lang.exception),console.error(c.lang.pathError))}}}),define("dist/application/plugins",["$","dist/application/setting","dist/tips/init","dist/application/method","jstree"],function(a,b){"use strict";var c=a("$"),d=a("dist/application/setting"),e=a("dist/application/method");c("[data-toggle=tooltip]").tooltip(),b.init=function(b){function f(a,b){var d=a.data("path");a.fullCalendar({header:{left:"",center:"prev,title,next",right:""},loadOutDate:d,lang:"zh-cn",defaultDate:b,selectable:!1,dayClick:function(a,b){var d=c(b.target).closest("td"),e=d.closest("#calendar"),f=e.closest("form"),g=c(e.data("target"),f),h=d.closest(".fc-week"),i=c(".fc-bg",h),j=a.format("YYYY-MM-DD"),k=c("td[data-date="+j+"]",i);k.hasClass("disabled")||(k.hasClass("selected")?(c("td[data-date="+j+"]",h).removeClass("selected"),g.val("")):(g.val(j),e.find("td").removeClass("selected"),c("td[data-date="+j+"]",h).addClass("selected")))},events:function(){}})}function g(a){if(a.loading)return a.text;var b="<li>"+a.value+"</li>";return b}function h(a){return a.value||a.text}var i=c("#calendar",b);i.length>0&&a.async(["fullcalendarno"],function(){var a=i.data("default");window.dateconfig=[],f(i,a)});var j=c('[data-toggle="chosen"]',b);j.length>0&&a.async(["chosen","style/plugins/chosen/chosen.min.css"],function(){j.each(function(){var a=c(this),b=a.data("nosearch"),e={},f=a.data("maxlength"),g=a.data("remote")||a.attr("href");f&&(e.max_selected_options=f),b&&(e.disable_search_threshold=9999999),e.hide=!1,e.no_results_text="找不到",g?(console.log(g),c.ajax(g,{type:"post",dataType:"json"}).done(function(b){c.each(b,function(b,c){var d='<option value="{1}">{0}</option>';a.append(d.format(c.text,c.value))}),a.chosen(e)}).fail(function(){d.msg.info("网络异常")})):a.chosen(e)})});var k=c('[data-toggle="select2"]',b);k.length>0&&a.async(["select2","style/plugins/select2/select2.min.css"],function(){k.each(function(){{var a=c(this),b={},d=a.data("maxcount"),e=a.data("chang");a.data("remote")||a.attr("href")}if(d&&(b.maximumSelectionSize=d),e)switch(e){case"submit":a.on("change",function(){a.closest("form ").submit()})}a.select2(b)})});var l=c('[data-toggle="select2_4"]',b);l.length>0&&a.async(["select2_4"],function(){l.each(function(){{var a=c(this),b={},e=a.data("maxcount"),f=a.data("chang"),i=a.data("remote")||a.attr("href"),j=a.data("pid"),k=a.data("placeboolean");a.data("msgRequired")||a.data("placeholder")}if(e&&(b.maximumSelectionSize=e),f)switch(f){case"submit":a.on("change",function(){a.closest("form ").submit()})}i?(void 0!=j&&(i=i.format(j)),a.select2({ajax:{url:i,dataType:"json",delay:500,data:function(a){return{q:a.term,page:a.page||1}},processResults:function(b,c){return d.issucceed(b)?(c.page=c.page||1,1==c.page&&k&&b.items.unshift({id:"js_select2_4placeholder",value:a.data("placeholder")}),{results:b.items,pagination:{more:c.page*b.page_num<b.total_count}}):void d.msg.error(b.message||d.lang.sendError)},cache:!0},escapeMarkup:function(a){return a},minimumInputLength:0,templateResult:g,templateSelection:h})):a.select2(b),a.change(function(){var a=c(this);"js_select2_4placeholder"==a.val()&&a.find("option:selected").attr("value","")})})});var m=c('[data-toggle="reportrange"]',b);m.length>0&&a.async(["moment","daterangepicker","style/plugins/daterangepicker/daterangepicker-bs3.min.css"],function(){m.each(function(){var a=c(this),b=(a.data("selected"),a.find("span")),d=b.text().split("-"),e=moment(d[0]),f=moment(d[1]),g=(f.diff(e,"days"),!1),h=a.data("format")||"YYYY/MM/DD",i=a.data("timePickerIncrement")||30;"YYYY/MM/DD HH:mm"==h&&(g=!0),a.daterangepicker({format:h,timePicker:g,timePickerIncrement:i,timePicker12Hour:!1,ranges:{"今天":[moment(),moment()],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",6),moment()],"最近30天":[moment().subtract("days",29),moment()],"这个月":[moment().startOf("month"),moment().endOf("month")],"上个月":[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]},startDate:e||moment(),endDate:f||moment()},function(b,d){var e=b.format(h)+" - "+d.format(h);c("span",a).html(e),c('input[type="hidden"]',a).val(e);var f=a.data("change");if(f)switch(f){case"submit":a.closest("form ").submit()}})})});var n=c('[data-toggle="reportrangecount"]',b);n.length>0&&a.async(["moment","daterangepicker","style/plugins/daterangepicker/daterangepicker-bs3.min.css"],function(){n.each(function(){var a=c(this),b=(a.data("selected"),a.find("span")),d=b.text().split("-"),e=moment(d[0]),f=moment(d[1]),g=f.diff(e,"days");a.daterangepicker({format:"YYYY/MM/DD HH:mm",ranges:{"过去7天":[moment().subtract("days",6),moment()],"过去15天 ":[moment().subtract("days",14),moment()],"过去30天 ":[moment().subtract("days",29),moment()]},startDate:e||moment().subtract("days",g),endDate:f||moment()},function(b,d){var e=b.format("YYYY/MM/DD")+" - "+d.format("YYYY/MM/DD");c("span",a).html(e),c('input[type="hidden"]',a).val(e);var f=a.data("change");if(f)switch(f){case"submit":a.closest("form ").submit()}})})});var o=c('[data-toggle="reportrangebus"]',b);o.length>0&&a.async(["moment","daterangepicker","style/plugins/daterangepicker/daterangepicker-bs3.min.css"],function(){o.each(function(){var a=c(this),b=(a.data("selected"),a.find("span")),d=b.text().split("-"),e=moment(d[0]),f=moment(d[1]),g=(f.diff(e,"days"),!1),h=a.data("timePickerIncrement")||30,i=a.data("format")||"YYYY/MM/DD";"YYYY/MM/DD HH:mm"==i&&(g=!0),a.daterangepicker({format:i,timePickerIncrement:h,timePicker:g,timePicker12Hour:!1,ranges:{"今天":[moment(),moment()],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",6),moment()],"最近30天":[moment().subtract("days",29),moment()]},startDate:e||moment(),endDate:f||moment()},function(b,d){var e=b.format(i)+" - "+d.format(i);c("span",a).html(e),c('input[type="hidden"]',a).val(e);var f=a.data("change");if(f)switch(f){case"submit":a.closest("form ").submit()}})})});var p=c('[data-toggle="combodate"]',b);p.length>0&&a.async(["combodate"],function(){p.each(function(){var a=c(this);a.combodate({minuteStep:1})})});var q=c('[data-toggle="clockpicker"]',b);q.length>0&&a.async(["clockpicker","style/plugins/clockpicker/clockpicker.min.css"],function(){q.each(function(){var a=c(this),b=a.find("input[type='text']:first"),d=a.data("placement")||"top",e=a.data("align")||"left",f=a.data("autoclose")||!1,g=b.data("than"),h=b.data("less"),i=b.data("day"),j=a.data("minutes5")||!1;a.clockpicker({placement:d,align:e,minutes5:j,autoclose:f,afterDone:function(){var d=a.closest(".form-group").find(i),e=d.find("option:selected").data("type");if(e)return!1;if(g){var f=c(g),j=f.val(),k=b.val();if(k){var l=k.split(":");if(j){var m=j.split(":"),n=b.closest(".form-group"),o=b.data("thanMsg")||"时间",p=l[0]-0,q=l[1]-0,r=m[0]-0,s=m[1]-0;0>p-r?(b.removeClass("error"),n.find(".js_validate_error").remove(),n.append("<span class='error help-block js_validate_error'>"+o+"设置有误，必须大于"+j+"！</span>"),b.addClass("error")):p-r==0&&0>=q-s?(b.removeClass("error"),n.find(".js_validate_error").remove(),n.append("<span class='error help-block js_validate_error'>"+o+"设置有误，必须大于"+j+"！</span>"),b.addClass("error")):(b.removeClass("error"),f.removeClass("error"),n.find(".js_validate_error").remove())}}}if(h){var t=c(h),u=t.val(),k=b.val();if(k){var l=k.split(":");if(u){var m=u.split(":"),n=b.closest(".form-group"),o=b.data("lessMsg")||"时间",p=l[0]-0,q=l[1]-0,r=m[0]-0,s=m[1]-0;p-r>0?(b.removeClass("error"),n.find(".js_validate_error").remove(),n.append("<span class='error help-block js_validate_error'>"+o+"设置有误，必须小于"+u+"！</span>"),b.addClass("error")):p-r==0&&q-s>=0?(b.removeClass("error"),n.find(".js_validate_error").remove(),n.append("<span class='error help-block js_validate_error'>"+o+"设置有误，必须小于"+u+"！</span>"),b.addClass("error")):(b.removeClass("error"),t.removeClass("error"),n.find(".js_validate_error").remove())}}}}});var k=a.next("span.input-group-addon"),l=a.prev("span.input-group-addon");k.add(l).on("click",function(){a.clockpicker("show")})})});var r=c('[data-toggle="daterangepicker"]',b);r.length>0&&a.async(["moment","daterangepicker","style/plugins/daterangepicker/daterangepicker-bs3.min.css"],function(){r.each(function(){var a=c(this),b=a.data("opens")||"right",d=a.data("minDate")||!1,e=a.data("maxDate")||!1,f=a.data("format")||"YYYY/MM/DD HH:mm",g=a.data("timePickerIncrement")||30;a.daterangepicker({timePicker:!0,opens:b,timePicker12Hour:!1,minDate:d,timePickerIncrement:g,maxDate:e,format:f},function(){var b=a.data("change");if(b)switch(b){case"submit":a.closest("form ").submit()}else a.blur()});var h=a.next("span.input-group-addon"),i=a.prev("span.input-group-addon");h.add(i).on("click",function(){a.trigger("click")
})})});var s=c('[data-toggle="dateRange"]',b);s.length>0&&a.async(["moment","daterangepicker","style/plugins/daterangepicker/daterangepicker-bs3.min.css"],function(){s.each(function(){var a=c(this),b=c(this).data("format"),d=c(this).data("timePicker");a.daterangepicker({timePicker:d,format:b})})});var t=c('[data-toggle="switch"]',b);t.length>0&&a.async(["switch","style/plugins/switch/switch.min.css"],function(){c.each(t,function(){var a=c(this),b=a.data("path");a.bootstrapSwitch(),b&&function(){a.on("switchChange.bootstrapSwitch",function(a,c){e.postd(b,function(a){d.issucceed(a)||d.msg.error(a.message||d.lang.modifyError,a.url)},{state:c})})}()})});var u=c('[data-toggle="datepicker"]',b);u.length>0&&a.async(["datepicker","style/plugins/datepicker/datepicker3.min.css"],function(){u.each(function(){var a=c(this),b=a.data("startdate"),d="",e=a.data("format")||"yyyy-mm-dd",f=0,g=a.data("endDate"),h="",i=a.data("pastdays");d="now"==b||""==b?new Date:new Date(b),h="now"==g||""==g?new Date:new Date(g),"yyyy-mm"==e?f=1:"yyyy"==e&&(f=2),a.datepicker({startDate:d,endDate:h,minViewMode:f,format:e}).on("changeDate",function(b){if(a.blur(),i){var d=b.date.format("yyyy-MM-dd"),e=new Date(d);e.setDate(e.getDate()-(i-1));var f=e.format("yyyy-MM-dd"),g=a.closest("form"),h=c(".js_date_show",g),j=f+"~"+d;h.removeClass("hide"),c("p",h).html(j+"<span class='pull-right'>（"+i+"天）</span>"),c("input[type='hidden']",h).val(j)}var k=a.data("change");if(k)switch(k){case"submit":a.closest("form ").submit()}});var j=a.next("span.input-group-addon"),k=a.prev("span.input-group-addon");j.add(k).on("click",function(){a.datepicker("show")})})});var v=c('[data-toggle="datepickersub"]');v.length>0&&a.async(["datepicker","style/plugins/datepicker/datepicker3.min.css"],function(){v.each(function(){var a=c(this),b=a.data("startdate"),d="",e=a.data("format")||"yyyy-MM-dd",f=0,g=a.data("endDate"),h="";d="now"==b||""==b?new Date:new Date(b),h="now"==g||""==g?new Date:new Date(g),"yyyy-MM"==e?f=1:"yyyy"==e&&(f=2),a.datepicker({startDate:d,endDate:h,minViewMode:f,format:e}).on("changeDate",function(b){var d=b.date.format(e);c("span",a).html(d),c('input[type="hidden"]',a).val(d);var f=a.data("change");if(f)switch(f){case"submit":a.closest("form ").submit()}})})});var w=c('[data-toggle="datetimepicker"]',b);w.length>0&&a.async(["moment","datetimepicker","style/plugins/datetimepicker/datetimepicker.min.css"],function(){w.each(function(){var a=c(this),b=a.data("minutestep")||5,e=a.data("position")||"bottom-left",f="",g=a.data("startdate"),h="",i=a.data("enddate"),j=a.data("after"),k=a.data("before"),l=a.data("especially"),m=a.data("especiallyMsg"),n=a.data("offsetday")-0||0;if("now"==g?(f=new Date,f.setDate(f.getDate()+n)):(f=new Date(g),f.setDate(f.getDate()+n)),"now"==i?(h=new Date,h.setDate(h.getDate())):(h=new Date(i),h.setDate(h.getDate())),l){var o=c("#"+l).val(),p=o.split("-");f=new Date(p[0]),f.setDate(f.getDate()+n),h=new Date(p[1]),h.setDate(h.getDate())}a.datetimepicker({language:"zh-CN",startDate:f,endDate:h,autoclose:!0,minuteStep:b,pickerPosition:e}).on("show",function(){if(j&&c(j).val()){var b=new Date(c(j).val());b.setDate(b.getDate()+n),a.datetimepicker("setStartDate",b)}if(k&&c(k).val()){var b=new Date(c(k).val());b.setDate(b.getDate()+n),a.datetimepicker("setEndDate",b)}if(l){{var d=c("#"+l).val(),e=d.split("-");new Date(e[0])}if(d){var f=new Date(moment(e[0]).subtract(1,"minutes").format("YYYY-MM-DD HH:mm:ss"));f.setDate(f.getDate()),a.datetimepicker("setEndDate",f)}}}).on("changeDate",function(){var b=a.data("change");if(""==c("#"+l).val()&&(d.msg.error(m||"请选择使用时间"),a.val("")),a.blur(),b)switch(b){case"submit":a.closest("form ").submit()}});var q=a.next("span.input-group-addon"),r=a.prev("span.input-group-addon");q.add(r).on("click",function(){a.datetimepicker("show")})})});var x=c('[data-provides="fileinput"]',b);x.length>0&&a.async("fileupload");var y=c('[data-toggle="ajaxfile"]',b);y.length>0&&a.async("ajaxfileupload",function(){c.each(y,function(){var a=c(this),b=a.data();c(this).ajaxfile({path:b.path},function(a){if(0==a.error?b.target&&c(""+b.target).attr("src",a.url):d.msg.error(a.message||d.lang.removeError,a.url),a.refresh){var f=new e.URL(window.parent.location.href);f.set("url",window.location.href),window.parent.location=f.url()}})})});var z=c(".js_fresco",b);z.length>0&&a.async(["fresco","style/plugins/fresco/fresco.min.css"],function(){var a=c.map(z,function(a){return{options:{thumbnail:c(a).attr("src")},url:c(a).data("src")}});z.closest("li").on("click",function(){var b=c(this).index();Fresco.show(a,{ui:"inside"},b+1)})});var A=c('[data-toggle="frescos"]',b);A.length>0&&a.async(["fresco","style/plugins/fresco/fresco.min.css"],function(){A.each(function(){var a=c(this),b=c(".js_frescos",a),d=c.map(b,function(a){return{options:{thumbnail:c(a).attr("src")},url:c(a).data("src")}});b.closest("li").on("click",function(){var a=c(this).index();Fresco.show(d,{ui:"inside"},a+1)})})});var B=c(".alert_big_imgs",b);B.length>0&&a.async(["dist/rotate/init.js","style/plugins/alert_img/skin.min.css"],function(a){a.init(b)});var C=c('[data-toggle="location"]',b);C.length>0&&a.async("dist/location/init.js",function(a){c.each(C,function(){var b=c(this),d=c('[data-location="provinces"]',b),e=c('[data-location="city"]',b),f=c('[data-location="district"]',b),g=new a.select({data:a.data});g.bind(d),g.bind(e),g.bind(f)})});var D=c('[data-toggle="overseas"]',b);D.length>0&&a.async("dist/location/overseas.js",function(a){c.each(D,function(){var b=c(this),d=c('[data-location="provinces"]',b),e=c('[data-location="city"]',b),f=c('[data-location="district"]',b),g=new a.select({data:a.data});g.bind(d),g.bind(e),g.bind(f)})});var E=c('[data-toggle="select_level2"]',b);if(E.length>0){var F=c("form.form-validate",b);a.async("dist/location/init.js",function(a){var b=c('[data-location="select_level_1"]',F),d=c('[data-location="select_level_2"]',F),e=new a.select({data:window.select_level2_data});e.bind(b),e.bind(d)})}var G=c('[data-toggle="select_level3"]',b);if(G.length>0){var F=c("form.form-validate",b);a.async("dist/location/init.js",function(a){var b=c('[data-location="select_level_1"]',F),d=c('[data-location="select_level_2"]',F),e=c('[data-location="select_level_3"]',F),f=new a.select({data:window.select_level3_data});f.bind(b),f.bind(d),f.bind(e)})}var H=c(".js_copy_text",b);H.length>0&&a.async("zeroclipboard",function(){ZeroClipboard.setDefaults({moviePath:"/assets/swf/zeroclipboard.swf"}),c.each(H,function(a){var b='<button class="btn btn-default js_copy btn-sm" id="{0}" type="button" data-clipboard-target="{2}" data-clipboard-text="{1}"><i class="fa fa-copy m-r-xs"></i>复制</button>  <span class="alert copy-success  alert-success hd "  >复制成功,请粘帖到您需要的地方</span>';c(this).data("icon")&&(b='<i id="{0}" title="复制" data-clipboard-target="{2}" data-clipboard-text="{1}" class="fa fa-copy js_copy"></i><span class="alert copy-success  alert-success hd "  >复制成功,请粘帖到您需要的地方</span>');var d="copy_button{0}".format(a),e=b,f=c(this),g=f.text().trim(),h=f.attr("id");h?f.after(e.format(d,"",h)):f.append(e.format(d,g));var i=c("#"+d),j=new ZeroClipboard(i),k=function(a){var b=a.nextAll("span.copy-success");b.show(),setTimeout(function(){b.fadeOut()},1e3)};j.on("complete",function(a){k(c(a.options.button))})}),c(document).on("click","button.js_copy",function(){var a=c(this),b=a.data("clipboard-text").trim();c.browser.msie?(window.clipboardData.setData("Text",b),success(a)):prompt("按下 Ctrl+C 复制到剪贴板",b)})}),window.wm.tokeninputtree=function(b){a.async(["jstree","tokeninput","style/plugins/tokeninput/tokeninput.min.css","style/plugins/jstree/jstree.min.css"],function(){c.each(b,function(){var a=c(this),b=a.data("path"),f=a.data("contact"),g=a.data("selected"),h=a.data("selectedContact"),i=a.data("tokenLimit"),j=a.data("part"),k=a.data("submit"),l=a.data("organization"),m=a.data("member"),n="";k?n=k:(n="js_no_submit_css",k="js_space_tree_placeholder");var o=function(b){var d=[];h&&(d=h.split(",")),c.each(b,function(b,e){c.inArray(e.id,d)>-1&&a.tokenInput("add",e)})};b?e.get(b,function(b){a.tokenInputTree(c.tokenInputConverter.forparty2token(b),c.tokenInputConverter.forparty2node(b),{classes:{dropdown:"token-input-dropdown memberDialog_selectTree "+n},onAdd:function(a){if(l){var b=c("#"+a.id,c(l));b.length&&(b.addClass("jstree-clicked"),c(".jstree-anchor:first",b).addClass("jstree-clicked"))}if(m){var b=c("#members_"+a.id,c(m));b.length&&(b.addClass("selected"),c("input[type='checkbox']",b).prop("checked",!0))}},onDelete:function(a){if(l){var b=c("#"+a.id,c(l));b.length&&(b.removeClass("jstree-clicked"),c(".jstree-anchor:first",b).removeClass("jstree-clicked"))}if(m){var b=c("#members_"+a.id,c(m));b.length&&(b.removeClass("selected"),c("input[type='checkbox']",b).prop("checked",!1))}},tokenLimit:i||999},g),f&&e.get(f,function(b){var d=a.data("settings"),e=c.tokenInputConverter.formember2token(b);d.local_data=d.local_data.concat(e),o(e)},!1,j?{department:g,member:h}:!1)},!1,j?{department:g}:!1):f&&e.get(f,function(b){var d=c.tokenInputConverter.formember2token(b);a.tokenInputTree(d,0,{classes:{dropdown:"token-input-dropdown memberDialog_selectTree "+n},onAdd:function(a){if(m){var b=c("#members_"+a.id,c(m));b.addClass("selected"),c("input[type='checkbox']",b).prop("checked",!0)}},onDelete:function(a){if(m){var b=c("#members_"+a.id,c(m));b.removeClass("selected"),c("input[type='checkbox']",b).prop("checked",!1)}},tokenLimit:i||999},0),o(d)},!1,j?{department:g,member:h}:!1),a.closest("form").on("click",'button[type="submit"],[data-toggle="method"]',function(){if(a.data("ruleRequired")&&!a.prev(".token-input-list").is(":hidden")&&0==a.tokenInput("get").length){var c="请选择{0}{1}",e=b?"部门":"",g=b?f?"或人员":"":f?"人员":"",h=c.format(e,g),i=a.data("requiredMsg");return d.msg.info(i||h),window.formValided=!1,!1}}),c(document).on("click","."+k+" .jstree-node",function(){c(this).find(".jstree-disabled").length||setTimeout(function(){a.closest("form").submit()},200)})})})};var I=c('[data-toggle="tokeninputtree"]',b);I.length>0&&window.wm.tokeninputtree(I);var J=c('[data-toggle="treeinput"]',b);J.length>0&&a.async(["jstree","style/plugins/jstree/jstree.min.css"],function(){c.each(J,function(){{var a=c(this),d=a.data("path"),f=a.data("icon"),g=a.data("selected");a.data("submit")}e.get(d,function(d){for(var e=c.tokenInputConverter.forparty2node(d,{selected:g||[-1]}),h={},i=e.length-1;i>=0;i--)h[e[i].id]=e[i].text;for(var j={},i=e.length-1;i>=0;i--)j[e[i].id]=e[i].cid;a.jstree({core:{data:e,themes:{name:!1,url:!1,dir:!1,icons:f,variant:!1,stripes:!1,responsive:!0,dots:!0}},types:{"default":{icon:"icon icon_folder_blue"},types:{disabled:{check_node:!1,uncheck_node:!0}}},plugins:["types","wholerow"]}).on("select_node.jstree",function(){}).on("changed.jstree",function(a,d){c(".jstreeinput_val",b).val(d.selected);for(var e=[],f=d.selected.length-1;f>=0;f--)e.push(j[d.selected[f]]);c(".jstreeinput_val",b).data("list",e),c("#principal").length&&c("#principal").val(e)})})}),c(b).on("click",'button[type="submit"]',function(){var a=c(this).closest(".form-horizontal").find(".jstreeinput_val").length;if(c(".jstreeinput_val",b).val().length<1&&a){var e=c(this).data("msg");return d.msg.msgbox.alert(e||"至少选择一个部门"),!1}})});var K=c('[data-table="ajax"]');K.length>0&&a.async(["datatables"],function(){K.each(function(){var a=c(this),b=a.data("path"),d=a.data("search")||!1,e=a.data("placeholder")||"",f=a.data("bsort")||!1,g=a.data("aocolumndefs")||!1;g&&(f=!0),a.dataTable({processing:!0,serverSide:!0,aLengthMenu:[20,30,50],searching:d,bSort:f,aoColumnDefs:g,sPaginationType:"full_numbers",ajax:{url:b,type:"post",data:function(a){a.myKey="myValue"}},oLanguage:{sLengthMenu:" <span>每页显示</span>_MENU_ <span>条记录</span> ",sZeroRecords:"对不起，查询不到任何相关数据",sInfo:"当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",sInfoEmtpy:"找不到相关数据",sInfoFiltered:"数据表中共为 _MAX_ 条记录)",sProcessing:"正在加载中...",sSearch:"<span>搜索:</span> ",sUrl:"",oPaginate:{sFirst:"首页",sPrevious:" 上一页 ",sNext:" 下一页 ",sLast:" 末页 "}}}),a.width(window.outerWidth-323),a.closest(".dataTables_wrapper").find(".dataTables_filter input").attr("placeholder",e)})});var L=c(".js_label_tree",b);if(L.length){a("jstree"),template.helper("members_checked",function(a,b){return c.inArray(a,b)>-1?'checked="checked"':d.empty}),template.helper("members_selected",function(a,b){return c.inArray(a,b)>-1?"selected":d.empty});var M=a("dist/application/tmp/members.html");c.each(L,function(){var a=c(this),d=a.data("methodPath"),f=a.data("selected"),g=(a.data("edit"),a.data("type")),h=a.data("target"),i="";"organization"==g&&(i="checkbox"),d&&e.get(d.format("get_all"),function(b){var e=c.tokenInputConverter.forparty2node(b,{selected:f||[-1]});"members"==g&&b&&c.post(d.format("get_members"),{id:b[0].id},function(a){var b={},d=[];b.data=a,d=c(".js_tokeninputtree").val().split(","),b.select=d,c(h).html(template.compile(M)(b))}),a.jstree({core:{data:e,check_callback:function(){return!0},themes:{name:!1,url:!1,dir:!1,icons:!0,variant:!1,stripes:!1,responsive:!0,dots:!1}},checkbox:{three_state:!1},types:{"default":{icon:"icon icon_folder_blue"}},plugins:["types",i,"wholerow"]}).on("select_node.jstree",function(a,b){"organization"==g?c(".js_tokeninputtree").tokenInput("add",{id:b.node.id,name:b.node.text}):c.post(d.format("get_members"),{id:b.node.id},function(a){var b={},d=[];b.data=a,d=c(".js_tokeninputtree").val().split(","),b.select=d,c(h).html(template.compile(M)(b))})}).on("deselect_node.jstree",function(a,b){c(".js_tokeninputtree").tokenInput("remove",{id:b.node.id})})}),"members"==g&&c(b).on("click",".listview-item",function(){var a=c(this),b=a.data("id"),d=a.data("name"),e=a.data("src"),f=c("input[type='checkbox']",a);a.hasClass("selected")?(a.removeClass("selected"),f.prop("checked",!1),c(".js_tokeninputtree").tokenInput("remove",{id:b})):(a.addClass("selected"),f.prop("checked",!0),c(".js_tokeninputtree").tokenInput("add",{id:b,name:d,thumb_path:e}))})})}c(b).on("click","[data-toggle='couponajax']",function(){var d=c(this);a.async("dist/couponajax/init",function(a){a.init(b,d)})})}}),define("dist/application/tmp/members.html",[],'{{each data as item}}\n	<div class="mod-tree-people__people-item {{members_selected "p"+item.id select}} listview-item" data-id="p{{item.id}}" data-src="{{item.thumb_path}}" data-name="{{item.username}}" id="members_p{{item.id}}">\n		<img class="mod-tree-people__people-avatar" height="28" width="28" src="{{item.thumb_path}}">\n		<span class="mod-tree-people__people-name">{{item.username}}</span>\n		<input class="mod-tree-people__people-checkbox" type="checkbox" {{members_checked "p"+item.id select}}/>\n	</div>\n{{/each}}'),define("dist/application/tmp/logtmp.html",[],'{{each list as item index}}\n<li>\n    <p class="log_time">{{transMsgTime item.Time}}</p>\n    <p class="log_text">{{item.Operation}}</p>\n</li>\n{{/each}}'),define("dist/application/jqplugins",["$","dist/application/setting","dist/tips/init","dist/application/method"],function(c){"use strict";{var d=c("$"),e=c("dist/application/setting");c("dist/application/method")}d(function(){var a=d(".no-touch .slim-scroll");a.length>0&&c.async(["slimscroll"],function(){a.each(function(){var a,b=d(this),c=b.data();b.slimScroll(c),d(window).resize(function(){clearTimeout(a),a=setTimeout(function(){b.slimScroll(c)},500)})})})}),d.fn.addAttr=function(a,b){return this.each(function(){var c=d(this);b?c.attr(a,a):c.removeAttr(a)})},d.fn.adddClass=function(a,b){return this.each(function(){var c=d(this);b&&c.addClass(a)})},d.fn.addhtml=function(a,b){return this.each(function(){var c=d(this);b?c.append(a):c.prepend(a)})},d.fn.append2=function(a,b){var c=d("body").html().length;this.append(a);var e=1,f=setInterval(function(){e++;var a=function(){clearInterval(f),b()},g=c!=d("body").html().length||e>1e3;g&&a()},1)},!function(c){var d=function(a,b){return b||(b={}),{id:a.id,parent:a.parentid||"#",text:a.name,state:{opened:b.selected?a.id==b.selected||-1==b.selected&&0==a.parentid:0==a.parentid,disabled:a.is_readonly,selected:c.inArray(a.id,b.selected)>-1,selectedCid:c.inArray(a.cid,b.selectedCid)>-1},wid:a.wid,cid:a.cid}},f=function(a,b){b||(b={});var c={id:a.id,name:a.name,keywords:[a.name,a.pinyinname],wid:a.wid,readonly:b.readonly};return a.name&&c.keywords.push(a.name),a.pinyinname&&c.keywords.push(a.pinyinname),c},g=function(a,b){b||(b={});var c={id:e.membersp+a.id,name:a.username,username:a.username,keywords:[],thumb_path:a.thumb_path,readonly:b.readonly,JoinStatus:a.JoinStatus};return a.username&&c.keywords.push(a.username),a.pinyinname&&c.keywords.push(a.pinyinname),a.bizmpid&&c.keywords.push(a.bizmpid),c};c.tokenInputConverter={party2node:function(a,b){return d(a,b)},forparty2node:function(a,b){var e=[];return c.each(a,function(a,c){e.push(d(c,b))}),e},party2token:function(){return f(item,options)},forparty2token:function(a,b){var d=[];return c.each(a,function(a,c){d.push(f(c,b))}),d},member2token:function(a,b){return g(a,b)},formember2token:function(a,b){var d=[];return c.each(a,function(a,c){d.push(g(c,b))}),d},membersForValue:function(c){var d=c.split(","),e=[];return a.each(d,function(a,c){c&&c[0]!=b&&e.push(c)}),e},partiesForValue:function(c){var d=c.split(","),e=[];return a.each(d,function(a,c){c&&c[0]==b&&e.push(c.substr(1))}),e}}}(jQuery),!function(a){function b(a){return a.replace(d,function(a){return c[a]})}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},d=/[&<>"'\/]/g,f={init:function(c,d,f,g){var h=this,i=h.data("organization"),j=function(b){if(!h.data("jstree")){var c=a('<div class="token-input-jstree">token-input-jstree</div>').appendTo(b).on("select_node.jstree",function(a,b){h.data("tokeninput").tokenInput("add",{id:b.node.id,name:b.node.text,wid:b.node.wid})});c.jstree({core:{themes:{name:!1,url:!1,dir:!1,icons:!0,variant:!1,stripes:!1,responsive:!0,dots:!0},data:d},types:{"default":{icon:"icon icon_folder_blue"}},plugins:["wholerow","types"]}),h.data("jstree",c)}},k=function(a){var c=a.id.toString(),d=a.name;return c[0]==e.membersp?"<li><img src='"+a.thumb_path+"' style='float:left;width:26px;height:26px;margin-right:6px'><span>"+(this.enableHTML?d:b(d))+"</span></li>":"<li><i style='color:#C9DDF6;' class='fa fa-folder m-r-xs'></i>"+(this.enableHTML?d:b(d))+"</li>"},l=function(a){var c=a.id.toString(),d=a.name;return c[0]==e.membersp?"<li><img src='"+a.thumb_path+"' style='float:left;width:26px;height:26px'><p class='group_item_name'>"+(this.enableHTML?d:b(d))+"</p></li>":"<li><p class='group_item_name'><i style='color:#6EA6E7;' class='fa fa-folder m-r-xs'></i>"+(this.enableHTML?d:b(d))+"</p></li>"},m={propertyToSearch:"keywords",searchDelay:50,searchingText:null,resultsLimit:20,excludeCurrent:!0,preventDuplicates:!0,animateDropdown:!1,hintText:i?"输入搜索条件":d&&d.length?j:"输入成员名称",resultsFormatter:k,tokenFormatter:l};f=a.extend({},m,f);var n=h.tokenInput(c,f);g&&a.each(d,function(b,c){a.inArray(c.id,g)>-1&&n.tokenInput("add",{id:c.id.toString(),name:c.text,wid:c.wid})}),h.data("tokeninput",n)},destroy:function(){this.data("jstree")&&(this.data("jstree").jstree().destroy(),this.removeData("jstree")),this.data("tokeninput")&&(this.data("tokeninput").tokenInput("destroy"),this.removeData("tokeninput"))},addtoken:function(){}};a.fn.tokenInputTree=function(a){return f[a]?f[a].apply(this,Array.prototype.slice.call(arguments,1)):f.init.apply(this,arguments)}}(jQuery),!function(a){var b=function(b,c,d){this.element=a(d),this.init(b,c),this.perform=!1};b.defaults={selector:null,bufferPx:30,appendElement:null,state:{is_continue:1,currPage:1},data:{},path:null},b.prototype={init:function(c,d){this.options=a.extend(!0,{},b.defaults,c);var e=this;this.element.on("scroll",function(){e.is_continue()&&e.beginAjax(e.element,d)}),e.beginAjax(e.element,d)},selector:function(){return a(this.options.selector)},is_continue:function(){var b=this.selector();return b.length?!this.perform&&this.options.state.is_continue&&b.offset().top+this.options.bufferPx<a(window).height():!1},beginAjax:function(b,c){var d=this;d.perform=!0;var f=a.extend(!0,{page:this.options.state.currPage},this.options.data);a.ajax({dataType:"json",type:"GET",data:f,url:this.options.path}).done(function(a){c(b,a)}).fail(function(){e.msg.info(e.lang.exception)}).always(function(){d.options.state.currPage++,d.perform=!1})},update:function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))},destroy:function(){this.element.unbind("scroll"),this.element.removeData("scrollPage")},toggleDone:function(a){this.options.state.is_continue=a}},a.fn.scrollPage=function(c,d){var e=typeof c;if("string"===e){var f=Array.prototype.slice.call(arguments,1);this.each(function(){var b=a.data(this,"scrollPage");return b&&a.isFunction(b[c])&&"_"!==c.charAt(0)?void b[c].apply(b,f):!1})}else this.each(function(){var e=a.data(this,"scrollPage");e?e.update(c):(e=new b(c,d,this),a.data(this,"scrollPage",e))})}}(jQuery),!function(a){var b=function(a,b,c){this.element=c.get(0),this.defaults_file_type=b,this.init(a)};b.defaults={url:e.empty,multi:!1,prevent_duplicates:!1,mime_types:[],max_file_size:0,data:{},max_count:0,max_count_tips:0,extensions:"",dropElement:"",FilesAdded:function(){},UploadProgress:function(){},FileUploaded:function(){},UploadComplete:function(){}},b.prototype={init:function(c){var d=this;if(this.defaults_file_type){switch(this.defaults_file_type){case"picture":b.defaults.max_file_size="2mb",b.defaults.mime_types=[{title:"图片文件",extensions:"bmp,png,jpeg,jpg,gif"}],plupload.addI18n({"File extension error.":"图片格式必须为以下格式：bmp, jpeg, jpg, gif","File size error.":"文件大小错误。"});break;case"voice":b.defaults.max_file_size="5mb",b.defaults.mime_types=[{title:"音频文件",extensions:"mp3,wma,wav,amr"}],plupload.addI18n({"File extension error.":"语音格式必须为以下格式：mp3, wma, wav, amr"});break;case"video":b.defaults.max_file_size="20mb",b.defaults.mime_types=[{title:"视频文件",extensions:"rm,rmvb,wmv,avi,mpg,mpeg,mp4"}],plupload.addI18n({"File extension error.":"视频格式必须为以下格式：rm, rmvb, wmv, avi, mpg, mpeg, mp4"});break;case"file":b.defaults.max_file_size="10mb",b.defaults.mime_types=[{title:"自定义文件",extensions:"txt,xml,pdf,zip,doc,ppt,xls,docx,pptx,xlsx"}],plupload.addI18n({"File extension error.":"文件格式必须为以下格式：txt, xml, pdf, zip, doc, ppt, xls, docx, pptx, xlsx"});break;case"other":b.defaults.max_file_size=c.max_file_size,b.defaults.mime_types=[{title:"自定义文件",extensions:""+c.extensions}],plupload.addI18n({"File extension error.":"文件格式必须为以下格式：{0}".format(c.extensions)})}plupload.addI18n({"File size error.":"最大只能上传{0}的文件".format(b.defaults.max_file_size)})}this.options=a.extend(!0,{},b.defaults,c),this.plupload=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:d.element,url:d.options.url,drop_element:d.options.dropElement,flash_swf_url:"/assets/swf/Moxie.swf",silverlight_xap_url:"/assets/swf/Moxie.xap",multi_selection:d.options.multi,filters:{max_file_size:d.options.max_file_size,prevent_duplicates:d.options.prevent_duplicates,mime_types:d.options.mime_types},multipart_params:d.options.data,init:{FilesAdded:function(a,b){return d.options.max_count&&a.files.length>d.options.max_count?(e.msg.info(d.options.max_count_tips?"最多上传{0}个文件".format(d.options.max_count_tips):"最多上传{0}个文件".format(d.options.max_count)),plupload.each(b,function(b){a.removeFile(b)}),!1):(d.options.FilesAdded(a,b),void a.start())},UploadProgress:function(a,b){d.options.UploadProgress(a,b)},UploadComplete:function(a,b){d.options.UploadComplete(a,b)},FileUploaded:function(b,c,e){d.options.FileUploaded(b,c,a.parseJSON(e.response))},Error:function(a,b){return e.msg.info(b.message),!1}}}),this.plupload.init()},update:function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))},destroy:function(){this.plupload.destroy(),this.element.removeData("uploader")}},a.fn.uploader=function(d,e){var f=this,g=arguments;c.async(["plupload"],function(){var c=typeof d;if("string"===c){var h=Array.prototype.slice.call(g,1);f.each(function(){var b=a.data(f,"uploader");return console.log(b),b&&a.isFunction(b[d])&&"_"!==d.charAt(0)?void b[d].apply(b,h):!1})}else f.each(function(){var c=a.data(f,"uploader");c?c.update(d):(c=new b(d,e,f),a.data(f,"uploader",c))})})}}(jQuery),!function(a){a.fn.setCursorPosition=function(b){return 0==this.lengh?this:a(this).setSelection(b,b)},a.fn.setSelection=function(a,b){if(0==this.lengh)return this;var c=this[0];if(c.createTextRange){var d=c.createTextRange();d.collapse(!0),d.moveEnd("character",b),d.moveStart("character",a),d.select()}else c.setSelectionRange&&(c.focus(),c.setSelectionRange(a,b));return this},a.fn.focusEnd=function(){this.setCursorPosition(this.val().length)}}(jQuery),!function(a){a.fn.ajaxfile=function(b,d){var f=a(this);c.async("ajaxfileupload",function(){f.on("click",function(){var a=f.find(":file"),c=f.find(".btn"),g=f.data();c.data("loadingText",'<i class="fa fa-spinner fa-spin"></i>上传中'),a.on("change",function(f){var h=void 0!==f.target.files?f.target.files[0]:f.target.value?{name:f.target.value.replace(/^.+\\/,"")}:null,i=function(d){c.button("loading"),jQuery.ajaxFileUpload({url:b.path,secureuri:!1,dataType:"json",fileElement:a,data:b.data,success:function(a){d(a),c.button("reset")},error:function(a){return console.log(a),c.button("reset"),e.msg.info("上传文件错误，请重新上传。"),!1}})};if(h.name)if(g.type)switch(g.type){case"img":if(!/(.*)\.(jpg|gif|jpeg|png|bmp)$/i.test(h.name))return e.msg.info("请上传jpg、gif、jpeg、png或bmp格式的图片。"),!1;i(function(a){d(a)})}else console.error("输入类型")})})})}}(jQuery),jQuery.extend({unselectContents:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}}),jQuery.fn.extend({selectContents:function(){d(this).each(function(a){var b,c,d,e,f=this;(d=f.ownerDocument)&&(e=d.defaultView)&&"undefined"!=typeof e.getSelection&&"undefined"!=typeof d.createRange&&(b=window.getSelection())&&"undefined"!=typeof b.removeAllRanges?(c=d.createRange(),c.selectNode(f),0==a&&b.removeAllRanges(),b.addRange(c)):document.body&&"undefined"!=typeof document.body.createTextRange&&(c=document.body.createTextRange())&&(c.moveToElementText(f),c.select())})},setCaret:function(){if(d.browser.msie){var a=function(){var a=d(this).get(0);a.caretPos=document.selection.createRange().duplicate()};d(this).click(a).select(a).keyup(a)}},insertAtCaret:function(a){var b=d(this).get(0);if(document.all&&b.createTextRange&&b.caretPos){var c=b.caretPos;c.text=""==c.text.charAt(c.text.length-1)?a+"":a}else if(b.setSelectionRange){var e=b.selectionStart,f=b.selectionEnd,g=b.value.substring(0,e),h=b.value.substring(f);b.value=g+a+h,b.focus();var i=a.length;b.setSelectionRange(e+i,e+i),b.blur()}else b.value+=a}})}),!function(a){"use strict";var b=function(a,c){return b["string"==typeof c?"compile":"render"].apply(b,arguments)};b.version="2.0.4",b.openTag="<%",b.closeTag="%>",b.isEscape=!0,b.isCompress=!1,b.parser=null,b.render=function(a,c){var d=b.get(a)||e({id:a,name:"Render Error",message:"No Template"});return d(c)},b.compile=function(a,d){function g(c){try{return new k(c,a)+""}catch(f){return i?e(f)():b.compile(a,d,!0)(c)}}var h=arguments,i=h[2],j="anonymous";"string"!=typeof d&&(i=h[1],d=h[0],a=j);try{var k=f(a,d,i)}catch(l){return l.id=a||d,l.name="Syntax Error",e(l)}return g.prototype=k.prototype,g.toString=function(){return k.toString()},a!==j&&(c[a]=g),g};var c=b.cache={},d=b.helpers=function(){var a=function(b,c){return"string"!=typeof b&&(c=typeof b,"number"===c?b+="":b="function"===c?a(b.call(b)):""),b},c={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},d=function(b){return a(b).replace(/&(?![\w#]+;)|[<>"']/g,function(a){return c[a]})},e=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},f=function(a,b){if(e(a))for(var c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)};return{$include:b.render,$string:a,$escape:d,$each:f}}();b.helper=function(a,b){d[a]=b},b.onerror=function(b){var c="Template Error\n\n";for(var d in b)c+="<"+d+">\n"+b[d]+"\n\n";a.console&&console.error(c)},b.get=function(d){var e;if(c.hasOwnProperty(d))e=c[d];else if("document"in a){var f=document.getElementById(d);if(f){var g=f.value||f.innerHTML;e=b.compile(d,g.replace(/^\s*|\s*$/g,""))}}return e};var e=function(a){return b.onerror(a),function(){return"{Template Error}"}},f=function(){var a=d.$each,c="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",e=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,f=/[^\w$]+/g,g=new RegExp(["\\b"+c.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),h=/^\d[^,]*|,\d[^,]*/g,i=/^,+|,+$/g,j=function(a){return a.replace(e,"").replace(f,",").replace(g,"").replace(h,"").replace(i,"").split(/^$|,+/)};return function(c,e,f){function g(a){return r+=a.split(/\n/).length-1,b.isCompress&&(a=a.replace(/[\n\r\t\s]+/g," ").replace(/<!--.*?-->/g,"")),a&&(a=w[1]+l(a)+w[2]+"\n"),a}function h(a){var c=r;if(o?a=o(a):f&&(a=a.replace(/\n/g,function(){return r++,"$line="+r+";"})),0===a.indexOf("=")){var e=!/^=[=#]/.test(a);if(a=a.replace(/^=[=#]?|[\s;]*$/g,""),e&&b.isEscape){var g=a.replace(/\s*\([^\)]+\)/,"");d.hasOwnProperty(g)||/^(include|print)$/.test(g)||(a="$escape("+a+")")}else a="$string("+a+")";a=w[1]+a+w[2]}return f&&(a="$line="+c+";"+a),i(a),a+"\n"}function i(b){b=j(b),a(b,function(a){a&&!s.hasOwnProperty(a)&&(k(a),s[a]=!0)})}function k(a){var b;"print"===a?b=y:"include"===a?(t.$include=d.$include,b=z):(b="$data."+a,d.hasOwnProperty(a)&&(t[a]=d[a],b=0===a.indexOf("$")?"$helpers."+a:b+"===undefined?$helpers."+a+":"+b)),u+=a+"="+b+","}function l(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}var m=b.openTag,n=b.closeTag,o=b.parser,p=e,q="",r=1,s={$data:1,$id:1,$helpers:1,$out:1,$line:1},t={},u="var $helpers=this,"+(f?"$line=0,":""),v="".trim,w=v?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],x=v?"$out+=$text;return $text;":"$out.push($text);",y="function($text){"+x+"}",z="function(id,data){data=data||$data;var $text=$helpers.$include(id,data,$id);"+x+"}";a(p.split(m),function(a){a=a.split(n);var b=a[0],c=a[1];1===a.length?q+=g(b):(q+=h(b),c&&(q+=g(c)))}),p=q,f&&(p="try{"+p+"}catch(e){throw {id:$id,name:'Render Error',message:e.message,line:$line,source:"+l(e)+".split(/\\n/)[$line-1].replace(/^[\\s\\t]+/,'')};}"),p=u+w[0]+p+"return new String("+w[3]+");";try{var A=new Function("$data","$id",p);return A.prototype=t,A}catch(B){throw B.temp="function anonymous($data,$id) {"+p+"}",B}}}();"function"==typeof define?define("dist/application/template",[],function(){return b}):"undefined"!=typeof exports&&(module.exports=b),a.template=b}(this),function(a){a.openTag="{{",a.closeTag="}}",a.parser=function(b){b=b.replace(/^\s/,"");var c=b.split(" "),d=c.shift(),e=c.join(" ");switch(d){case"if":b="if("+e+"){";break;case"else":c="if"===c.shift()?" if("+c.join(" ")+")":"",b="}else"+c+"{";break;case"/if":b="}";break;case"each":var f=c[0]||"$data",g=c[1]||"as",h=c[2]||"$value",i=c[3]||"$index",j=h+","+i;"as"!==g&&(f="[]"),b="$each("+f+",function("+j+"){";break;case"/each":b="});";break;case"echo":b="print("+e+");";break;case"include":b="include("+c.join(",")+");";break;default:a.helpers.hasOwnProperty(d)?b="=#"+d+"("+c.join(",")+");":(b=b.replace(/[\s;]*$/,""),b="="+b)}return b}}(this.template);