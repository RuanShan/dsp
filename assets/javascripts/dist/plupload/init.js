/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/plupload/init",["./uploadFile","$","dist/application/app","jquery_ui","./template/imageTemp.html","./template/progress.html","./template/files.html"],function(a){"use strict";a("./uploadFile")}),define("dist/plupload/uploadFile",["$","dist/application/app","jquery_ui"],function(require,exports,module){"use strict";var $=require("$"),app=require("dist/application/app"),config=app.config,method=app.method;require("jquery_ui");var imageTemp=require("dist/plupload/template/imageTemp.html"),progressTemp=require("dist/plupload/template/progress.html"),filesTemp=require("dist/plupload/template/files.html"),render_item=template.compile(imageTemp),render_progress=template.compile(progressTemp),render_files=template.compile(filesTemp),uploadimte=null;window.files_data&&window.files_data.file_item.length>0&&$(".js_fileList",".js_upload_container").append(render_files(window.files_data)),window.upload_config&&$(".js_new_upload").each(function(){var $el=$(this),$form=$el.closest(".js_upload_container"),sname=$el.data("submitname"),upload_path=$el.data("uploadpath"),deletepath=$el.data("delpath"),count=$el.data("count"),datas=eval("("+$el.data("data")+")")||null,extensions=$el.data("extensions"),maxSize=$el.data("maxsize"),max_count=count-($form.find("li.imgbox").length||0);if((void 0==count||""==count)&&(max_count=null),$el.uploader({multi:!0,url:upload_path,delete_path:deletepath,max_count:max_count,max_count_tips:count,dropElement:"drop",extensions:window.upload_config.extensions,max_file_size:window.upload_config.maxSize,data:datas,FilesAdded:function(a,b){$.each(b,function(a,b){$(".js_file_upload_queue",$form).append(render_progress({id:b.id,filename:b.name,filesize:Math.ceil(b.size/1024)}))})},UploadProgress:function(a,b){var c="upload{0}".format(b.id);if(uploadimte=$("#{0}".format(c)),uploadimte.length){var d=b.percent+"%";$(".data",uploadimte).text(d),$(".uploadify-progress-bar",uploadimte).width(d)}},FileUploaded:function(a,b,c){if($.isPlainObject(c)){var d=method.getfileExt(b.name).toString()||!1;c.file.explorer="jpg"==d||"gif"==d||"png"==d||"jpeg"==d?!0:!1,c.file.progressid=b.id,c.file.sname=sname,c.file.deletepath=deletepath,c.file.fileType=d,c.file.fileName=b.name,c.file.index=$form.find("li.imgbox").length,$(".js_fileList",$form).append(render_item(c.file)),uploadimte.remove()}else uploadimte.addClass("uploadify-error"),uploadimte.remove(),a.files.removeFile(b),config.msg.info(c||config.lang.uplodError)},UploadComplete:function(){$(".uploadify-progress-bar",uploadimte).remove()}},"other"),$("ul.ipost-list",$form).sortable({opacity:.8}),"draggable"in document.createElement("chooseDocument")){if("undefinde"==typeof window.FileReader)return;var holder=document.getElementById("chooseDocument"),drop=document.getElementById("drop");holder.ondragover=function(){return $("#drop").removeClass("hide"),!1},drop.ondragenter=function(){return $("#drop .dorp-dis").html("<strong>释放鼠标</strong>"),!1},holder.ondragleave=function(){return $("#drop .dorp-dis").html("<strong>请将文件拖拽至此区域</strong>"),!1},window.ondrop=function(a){a.preventDefault(),$("#drop").addClass("hide"),$("#drop .dorp-dis").html("<strong>请将文件拖拽至此区域</strong>");a.dataTransfer.files;return!1}}$(document).on("click","a.item_new_close",function(a){var b=$(this),c=b.data("progressid"),d=b.data("delpath");$.post(d,{id:b.data("post-id"),url:b.data("path")});var e=$(a.target).closest("li.imgbox");e.fadeOut(function(){e.remove(),$("#upload"+c).remove();var a=count-($form.find("li.imgbox").length||0),b=0;$form.find("li.imgbox").each(function(){$(this).find("a.item_new_close").data("progressid")&&b++}),count&&(c?$.data($el,"uploader").plupload.removeFile(c):$el.uploader("update",{max_count:a+b}))})})})}),define("dist/plupload/template/imageTemp.html",[],'{{if explorer}}\n<li class="imgbox" data-post-id="{{id}}" data-path="{{thumbnail}}">\n	<a class="item_new_close item_close" href="javascript:void(0)" data-delpath="{{deletepath}}" data-progressid="{{progressid}}" title="删除"  data-path="{{thumbnail}}" data-post-id="{{id}}"></a>  \n	<input type="hidden" value="{{id}}" name="{{sname}}[{{index}}][id]"> \n	<input type="hidden" value="{{thumbnail}}" name="{{sname}}[{{index}}][path]"> \n	<span class="item_box"><img src="{{path}}"></span>\n</li>\n{{else}}\n<li class="imgbox item" data-post-id="{{id}}" data-path="{{thumbnail}}">\n	<a class="item_new_close item_close" href="javascript:void(0)" data-delpath="{{deletepath}}" data-progressid="{{progressid}}" title="删除"  data-path="{{thumbnail}}" data-post-id="{{id}}"></a> \n	<div class="file_unit">\n        <span class="icon_filetype filetype_{{fileType}}"></span>\n        <p class="filetype_name">{{fileName}}</p>\n        <div class="choose_mode_style"></div>\n        <input type="hidden" value="{{id}}" name="{{sname}}[{{index}}][id]"> \n		<input type="hidden" value="{{thumbnail}}" name="{{sname}}[{{index}}][path]"> \n    </div>\n</li>\n{{/if}}'),define("dist/plupload/template/progress.html",[],'<div id="upload{{id}}" class="uploadify-queue-item">  \n	<span class="fileName">{{filename}} ({{filesize}}KB)</span>\n	<span class="data"> -上传完成 正在加载.....</span>   \n	<div class="uploadify-progress">                        \n		<div class="uploadify-progress-bar" style="width: 1%;"><!--Progress Bar-->\n		</div>                    \n	</div>                \n</div>'),define("dist/plupload/template/files.html",[],'{{each file_item as item index}}\n	{{if item.explorer}}\n	<li class="imgbox" data-post-id="{{item.file_id}}" data-path="{{item.thumbnail}}">\n		<a class="item_new_close item_close" href="javascript:void(0)" title="删除" data-delpath="{{item.deletepath}}"  data-path="{{item.thumbnail}}" data-progressid="{{item.progressid}}" data-post-id="{{item.file_id}}"></a>  \n		<span class="item_box"><img src="{{item.path}}"></span>\n	</li>\n	{{else}}\n	<li class="imgbox item" data-post-id="{{item.file_id}}" data-path="{{item.thumbnail}}">\n		<a class="item_new_close item_close" href="javascript:void(0)" title="删除" data-delpath="{{item.deletepath}}"  data-path="{{item.thumbnail}}" data-progressid="{{item.progressid}}" data-post-id="{{item.file_id}}"></a> \n		<div class="file_unit">\n	        <span class="icon_filetype filetype_{{item.format}}"></span>\n	        <p class="filetype_name">{{item.file_name}}</p>\n	        <div class="choose_mode_style"></div>\n	    </div>\n	</li>\n	{{/if}}\n{{/each}}');