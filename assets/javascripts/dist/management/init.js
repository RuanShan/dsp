/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/management/init",["$","dist/application/app","dist/echarts/init"],function(a){"use strict";function b(){d("#header").html(0==j?"在线签署商家入驻文件（非全球购入驻协议）":"在线签署商家入驻文件（全球购入驻协议）")}function c(a){var b=d(".js_free_postage_tips");a?b.removeClass("hide"):b.addClass("hide")}var d=a("$"),e=a("dist/application/app"),f=e.config,g=e.method,h=a("dist/echarts/init.js"),i=d("#interact_charts");i.length&&function(){var a=i.data("path");a&&g.get(a,function(a){f.issucceed(a)?h.line("interact_charts",a.data):f.msg.error(a.message)})}(),d(document).on("click",".js_get_code",function(){var a=d(this),b=a.data("path"),c=d(".js_phone_number_val").val(),e=a.data("msg")||"请正确填写手机号码";if(c&&!d(".js_phone_number_val").hasClass("error")){a.attr("disabled","disabled");var h=59e3;a.text("60秒后重新获取");var i=setInterval(function(){a.text("{0}秒后重新获取".format(h/1e3)),h-=1e3,0==h&&(a.text("获取验证码").removeAttr("disabled"),clearInterval(i))},1e3);g.postd(b,function(a){f.issucceed(a)?f.msg.info(a.message||f.lang.sendSuccess):f.msg.error(a.message||f.lang.sendError)},{phone:c})}else f.msg.error(e)}),window.bangdingPhone=function(a){var b=d(".js_phone_show_div").closest(".form-group");d(".js_phone_show_div",b).html(a.phone),d(".js_phone_number",b).val(a.phone),d(".js_phone_bangbtn",b).html("点击换绑"),d(".js_info_show_div").removeClass("hide")};var j=parseInt(d("#header").attr("data-protocol")),k=0,l=0;d(document).on("click",".js_agreement_btn",function(){var a=d(this),b=a.closest("form"),c=d("input[type='checkbox']",b),e=a.data("msg")||"您未勾选同意我们的协议",g=!0;return c.prop("checked")?(d("#protocolType").val(j),d("#companyBody").val(k),d("#paymentChannel").val(l)):(f.msg.error(e),g=!1),g});var m=0,n=d("#js_changename_modal"),o=d("#js_changename_modal2");d(document).ready(function(){window.auto&&n.modal("show")}),d(".step-list-opr").on("click",function(){var a=d(this).index();m=a,d(".step-list-opr:eq("+a+") a").removeClass("btn-disabled"),a+=1,a%=2,d(".step-list-opr:eq("+a+") a").addClass("btn-disabled"),j=0==a?1:0}),b(),d("#js_changename_modal .btn-primary").on("click",function(){0==j?(d("#header").html("在线签署商家入驻文件（非全球购入驻协议）"),d(".xy").hide(),d(".xy_0").show()):(d("#header").html("在线签署商家入驻文件（全球购入驻协议）"),d(".xy").hide(),d(".xy_1").show()),n.modal("hide")}),d("#js_changename_modal .btn-default").on("click",function(){n.modal("hide"),b(),d(".modal-body .step-list-opr:eq("+j+") .btn").click(),k=0,l=0}),d(".gngszt").on("click",function(){0==d(this).index()?d("#gngszt_nr").hide():d("#gngszt_nr").show()}),d("#js_changename_modal2 .btn-primary").on("click",function(){o.modal("hide"),d("#gjgszt").is(":checked")?(d(".xy").hide(),d(".xy_1").show(),k=0):(d(".xy").hide(),d(".xy_2").show(),k=1),l=d("#gnzf").is(":checked")?0:1}),d("#js_changename_modal2 .btn-default").on("click",function(){o.modal("hide"),b(),d(".modal-body .step-list-opr:eq("+j+") .btn").click(),k=0,l=0}),d("#btn_again").on("click",function(){n.modal("show"),b(),d(".modal-body .step-list-opr:eq("+j+") .btn").click(),k=0,l=0}),d(document).on("click",".js_add_freetax",function(){var a=d(this),b=a.closest(".col-sm-10").find(".row"),c=a.closest(".col-sm-10").find(".row_city").length,e=c+1,g=template("freetaxDistrict",{size:e}),h=d(g).find("select.js_change_city option").length-1;c+1>h?f.msg.error("新增保税区不能超过"+h+"个"):b.last().before(g)}),d(document).on("click",".js_add_freetax1",function(){var a=d(this),b=a.data("sname"),c=a.closest(".row_city").find(".addcheck"),e=a.closest(".col-sm-10").find(".row_city").length,g=a.closest(".row_city").find(".delcheck").length,h=g+1,i=template("freetaxDistrict1",{size:e,size2:h,name:b}),j=d(i).find("select.js_change_beian option").length-1;g+1>j?f.msg.error("最多添加"+j+"行"):c.append(i)}),d(document).on("click",".js_del_freetax",function(a){a.preventDefault();var b=d(this),c=(b.data("sname"),b.closest(".col-sm-10")),e=(c.find(".row_city"),b.closest(".delcheck"),b.closest(".row_city").find(".delcheck").length);e>1?b.closest(".delcheck").remove():b.closest(".row_city").remove();var f=d(".js_change_city"),g=(d(".row_city .js_change_beian"),0);d.each(f,function(){g++;var a="freetax"+g+"[city]";d(this).attr("name",a)});var h=0;d(".row_city").each(function(){h++;var a=0;d(d(this).find(".js_change_beian")).each(function(){a++;var b="freetax"+h+"_"+a+"[beian]";d(this).attr("name",b)})});var i=0;d(".row_city").each(function(){i++;var a=0;d(d(this).find(".js_change_othernumber")).each(function(){a++;var b="freetax"+i+"_"+a+"[othernumber]";d(this).attr("name",b)})});var j=0;d.each(d(".row_city"),function(){j++,d(this).find(".js_add_freetax1").data("sname",j),d(this).find(".js_del_freetax").data("sname",j)})}),d(document).on("change",".js_change_city",function(){var a=d(this),b=a.closest(".col-sm-10"),c=b.find("select").not(a),e=a.val();return""==e?!1:void d.each(c,function(b,c){var g=d(c).val();return g==e?(f.msg.error("这个已经选过了,请重新选择！"),void a.val("")):void 0})}),d(document).on("change",".js_change_beian",function(){var a=d(this),b=a.closest(".addcheck"),c=b.find("select").not(a),e=a.val();return""==e?!1:void d.each(c,function(b,c){var g=d(c).val();return g==e?(f.msg.error("这个已经选过了,请重新选择！"),void a.val("")):void 0})});var p=d(".js_all_free_postage:checked");p.length&&function(){c(p.prop("checked"))}(),d(document).on("click",".js_all_free_postage",function(){c(d(this).prop("checked"))})});