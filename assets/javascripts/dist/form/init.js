/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/form/init",["$","./controls","dist/application/app","./validate","./tip","./wizard"],function(a,b){"use strict";var c=(a("$"),a("./controls")),d=a("./validate"),e=a("./wizard");window.formValided=!0,b.init=function(a){c.init(a),d.init(a),e.init(a)}}),define("dist/form/controls",["$","dist/application/app"],function(a,b){"use strict";var c=a("$"),d=a("dist/application/app"),e=d.config,f=d.method;b.init=function(b){function d(a,b){var d=c(a.target),e=d.prevAll("input[type=text]"),f=d.closest("div.input-group").find("input[type=text]"),g=d.data("insert"),h=d.data("input"),i=d.data("maxSize"),k=e.val();h&&(k=f.val()),b.loadPlugin("image",function(){b.plugin.imageDialog({showRemote:j,imageUrl:k,clickFn:function(a){if(g||void 0==g){e.val(a).hide();var j=d.prevAll("img"),k=c(d.data("target")),l=c(d.data("targetimg"));if(k.length>0)k.attr("src",a).removeClass("hide");else if(j.length>0)j.attr("src",a).removeClass("hide");else{i||(i=100);var m='<img class="thumb_img" src="{0}" style="max-height: '+i+'px;">';e.before(m.format(a))}l.length>0&&l.attr("src",a)}else d.trigger("insert",a);h&&f.val(a),d.trigger("callback",a),b.hideDialog()}})})}function g(){var a=KindEditor.editor({allowFileManager:!0});i.on("click",function(b){d(b,a)}),b.on("click",'[data-toggle="selectimg2"]',function(b){d(b,a)})}var h=c('[data-toggle="kindeditor"]',b),i=c('[data-toggle="selectimg"]',b),j=i.data("linepic");h.length>0?a.async("kindeditor",function(){h.each(function(){var a=c(this),b=a.data("config"),d=a.data("tongji"),f=b?e.kindeditor[b]:e.kindeditor["default"];if(window.extraUploadPath&&(f=c.extend({},f,{uploadJson:window.extraUploadPath})),d){var g=a.data("tongjiTarget"),h=a.data("ruleRangelength")[1];if(g){var i=c(g),j=i.html();f=c.extend({},f,{afterChange:function(){var a="remain"==d?h-this.count():this.count();0>a||a>h?i.addClass("error"):i.removeClass("error"),i.html(j.format(a))}})}}KindEditor.create(a,f)}),g()}):i.length>0&&a.async(["kindeditor","assets/kindeditor/themes/default/default.css"],function(){g()});var k=c('[data-toggle="method"]',b);if(k.length>0){var l=c("#method"),m=k.data("confirm");k.on("click",function(){var a=c(this),b=a.data("method"),d=function(){l.val(b),a.button("loading"),k.closest("form").submit()};m&&e.msg.msgbox.confirm(k.data("msg")||e.lang.confirmCloseOrder,function(a){a&&d()}),k.closest("form").valid()&&window.formValided&&!m&&f.validKindEditor()&&d()})}var n=c(".js_sortable",b);n.length&&function(){n.sortable()}();var n=c(".js_sortable");n.length&&function(){n.sortable()}();var o=c(".js_map",b);o.length&&a.async("dist/map/init.js",function(a){var b=new a;b.init(o),window.wm.map=b});var p=c('[data-toggle="select_select_lvs"]',b);if(p.length>0){var q=c('[data-toggle="select_input_lvs"]',b),r=p.data("path"),s=new f.select({ajax:r,auto:!0,field_name:q});s.bind(p)}var t=c(".js_partial_require",b);if(t.length){var u=function(){var a=c(".js_form_tips",b),d=!1;c.each(t,function(){return(d=c(this).val().trim().length>0)?!1:void a.addClass("error")}),d&&a.removeClass("error")};t.on("blur",u),c(b).on("click",'button[type="submit"]',function(){return u(),c(".js_form_tips",b).hasClass("error")?!1:void 0})}}}),define("dist/form/validate",["$","dist/application/app","dist/form/tip"],function(a,b){"use strict";var c=a("$"),d=a("dist/application/app"),e=d.config,f=d.method;b.init=function(b){var d=b.hasClass("form-modal"),h=null;d&&(h=b.parents(".modal"),h.on("hidden",function(){b.resetForm()}));var i={errorElement:"span",errorClass:"help-block error",errorPlacement:function(a,b){var c=b.parents(".input-group");c.length>0?c.after(a):b.after(a)},highlight:function(a){c(a).removeClass("error has-success").addClass("error")},success:function(a){a.addClass("valid")},onkeyup:function(a){c(a).valid()},onfocusout:function(a){c(a).valid()},submitHandler:function(a){var b=!0;if(c('[data-toggle="kindeditor"]',a).length>0&&(b=f.validKindEditor()),c('[data-toggle*="selectimg"]').length>0&&c('[data-toggle*="selectimg"]',a).each(function(){var a=c(this),d=a.prev("input[type='text']"),f=d.data("ruleRequired"),g=d.data("msg")||"请上传图片";f&&!d.val()&&(e.msg.error(g),b=!1)}),c('[data-toggle*="chosen"]',a).length>0&&c('[data-toggle*="chosen"]',a).each(function(){var a=c(this),d=a.data("ruleRequired"),f=a.data("msgRequired")||"请选择";d&&!a.val()&&(e.msg.error(f),b=!1)}),b){var d=c("button[type='submit']",a);d.button("loading"),c(a).ajaxSubmit({dataType:"json",success:function(a){d.add(c("[data-toggle='method']")).add("[data-toggle='method1']").button("reset"),h&&h.modal("hide"),g.run(a)},error:function(a){d.add(c("[data-toggle='method']")).button("reset"),h&&h.modal("hide"),www_debug?e.msg.msgbox.alert(a.responseText):e.msg.info("网络异常")}})}}},j=b.data("ignore");j&&(i.ignore=j);var k=c("div.errorContainer"),l={errorContainer:c("div.errorContainer"),errorLabelContainer:c("div.errorLabelContainer"),errorElement:"label"};k.length>0&&c.extend(i,l),a.async(["validate","jform"],function(){b.each(function(){c(this).validate(i)})})};var g=a("dist/form/tip")}),define("dist/form/tip",["$","dist/application/app"],function(require,exports,module){"use strict";var $=require("$"),app=require("dist/application/app"),config=app.config;return exports.run=function(data){switch(data.status){case 0:data.message&&data.message.length?config.msg.suc(data.message,data.url):data.url&&data.url.length&&(window.parent.mainFrame?window.parent.document.getElementById("mainFrame").src=data.url:window.location=data.url);break;default:config.msg.info(data.message||config.lang.exception,data.url)}data.callback&&eval(data.callback)},exports}),define("dist/form/wizard",["$","dist/application/app","dist/form/tip"],function(a,b){"use strict";var c=a("$"),d=a("dist/application/app"),e=d.config;b.init=function(b){a.async(["jquery_ui","wizard","jform"],function(){b.hasClass("form-wizard-step")&&c(".form-wizard-step").length>0&&c(".form-wizard-step").formwizard({validationEnabled:!0,formPluginEnabled:!0,focusFirstInput:!0,disableUIStyles:!1,validationOptions:{},formOptions:{dataType:"json",success:function(a){f.run(a)},beforeSubmit:function(){var a=!0;return c('[data-toggle*="selectimg"]').length>0&&c('[data-toggle*="selectimg"]').each(function(){var b=c(this),d=b.prev("input[type='text']"),f=d.data("ruleRequired"),g=d.data("msg")||"请上传相关材料";f&&!d.val()&&(e.msg.error(g),a=!1)}),a},error:function(a){e.msg.info(a.responseText)}}})})};var f=a("dist/form/tip")});