/*! weimob_vshop_admin
*author:<a.b.c@hd3p.com> */
define("dist/subject/init",["$","dist/application/app","jquery_ui","bootstrap","kindeditor","./move"],function(a){"use strict";function b(a,b){var c=arguments;E(document).on("click","a."+a,function(){var a,d={},e=E("#parent_list div.panel").length,f=e+1;d.num=f,d.size=e,a=template(b,d);var g=E(a),h=g.find('input[type="hidden"][name*="type"]').val(),i=E('#parent_list input[type="hidden"][name*="type"][value="'+h+'"]').length;if(i>=E(this).data("max")&&0!=E(this).data("max"))return void G.msg.info("该组件最多添加{0}个".format(E(this).data("max")));if(E("#parent_list").append(a),E("ul.ipost-list","#parent_list").sortable({opacity:.8}),void 0!=c[2]){var j=E(this).closest("form");c[2](j)}else if(void 0!=c[3]){var k="#children-box-"+d.size;c[3](k)}I()})}function c(a,b,c,d,e,f){E(document).on("click","li."+a,function(){"js_add_brand_tmp"==a&&(L=E(this).index()),J=b,K=d;var g=E(this).data("size"),h={type:1,page:1};E(c).modal("show"),E(c+" "+f).data("size",g),E(c+' input[type="radio"]').removeAttr("checked"),E(c+' .js_select_all input[type="checkbox"]').removeAttr("checked"),B(b,h,function(a){var b=a.data;if(0==a.status&&b.length>0){E(c+" table tbody").empty(),E(c+" .goodsPager").remove(),E.each(b,function(a,b){var d=template(e,b);E(d).appendTo(E(c+" table tbody"))});var d=template("goodsLists_pager_tmp",a);E(d).appendTo(E(c+" .modal-body")),y()}else G.msg.info(a.message)})})}function e(a,b,c,d){E(c).on("click",function(){var c=E(this).parents(".modal").attr("id"),e=E("#"+c+" "+a).val(),g=E("#"+c+" "+b+" .active").index();O="",f(c,e,g,d)})}function f(a,b,c,d){var e=J,f={type:1,page:1,keyword:b,keytype:c};N=[],B(e,f,function(b){var c=b.data;if(0==b.status&&c.length>0){E("#"+a+" table tbody").empty(),E("#"+a+" .goodsPager").remove(),E.each(c,function(b,c){var e=template(d,c);E(e).appendTo(E("#"+a+" table tbody"))});var e=template("goodsLists_pager_tmp",b);E(e).appendTo(E("#"+a+" .modal-body")),y()}else G.msg.info(b.message)})}function g(a,b,c,d){E(document).on("click","li."+a,function(){J=c,K=d;var a=E(this),e=a.data("size"),f=window.get_activity,g=a.closest("form").find('input[data-toggle="daterangepicker"]').val();E(b).modal("show"),E(b+" #saveData").data("size",e),E("#shop_id").val(""),E("#file_id .fileinput-filename").text(""),E("#file_id").find('input[type="file"][name="files"]').val(""),E("#file_id").find("a.fileinput-exists").trigger("click"),E(b+" .change_shop1").val(""),E(b+" .change_shop2").val(""),E(b+" .shoping_chosed").val(""),E(b+" #selectGoods table tbody").empty(),E(b+" #selectGoods .goodsPager").remove(),E(b+' #selectGoods .js_select_all input[type="checkbox"]').removeAttr("checked"),E("#myTab li a:first").click();var h=(E("#myTab li"),{time:g});B(f,h,function(a){var b=a.data;if(0==a.status&&b.length>0){var c=E(".change_goods");c.empty(),c.append('<option value="">--请选择活动--</option>'),E.each(b,function(a,b){var d=E('<option value="'+b.id+'">'+b.name+" </option>");c.append(d)})}else G.msg.info(a.message),E("#selectGoods table tbody").empty(),E("#selectGoods .goodsPager").remove()})})}function h(a,b,c,d,e,f,g){function h(){var b=E(f).val(),h=E(d).val(),j=E(e).val(),k=E(g).val(),l=E(c).val();i(b,h,j,l,k,a)}E(document).on("click",b,h),E(document).on("change",d,h),E(document).on("change",e,h),E(document).on("change",f,h)}function i(a,b,c,d,e,f){var g=f,h={type:a,commodity:b,category:c,keyword:d,keytype:e,page:1};return E('.js_select_all input[type="checkbox"]').removeAttr("checked"),N=[],0==a.length?(E("#selectGoods table tbody").empty(),void E("#selectGoods .goodsPager").remove()):void B(g,h,function(a){var b=a.data;if(0==a.status&&b.length>0){E("#selectGoods table tbody").empty(),E("#selectGoods .goodsPager").remove(),E.each(b,function(a,b){var c=template("goods_table_tmp",b);E(c).appendTo(E("#selectGoods table tbody"))});var c=template("goodsLists_pager_tmp",a);E(c).appendTo(E("#selectGoods")),y()}else E("#selectGoods table tbody").empty(),E("#selectGoods .goodsPager").remove(),G.msg.info(a.message)})}function j(a,b,c,d,e,f){E(document).on("click","li."+a,function(){J=d,K=e;var a=E(this),g=a.data("size"),h=a.closest("form").find('input[data-toggle="daterangepicker"]').val();E(b).modal("show"),E(b+' input[type="radio"]').removeAttr("checked"),E(b+" "+f).data("size",g),E(b+' .js_select_all input[type="checkbox"]').removeAttr("checked"),E("#selectGoods table tbody").empty(),E("#selectGoods .goodsPager").remove(),B(c,{time:h},function(a){var c=a.data;if(0==a.status&&c.length>0){var d=E(b+" #goods_id option:eq(0)").html(),e=E(b+" #goods_id");e.empty(),e.append('<option value="">'+d+"</option>"),E.each(c,function(a,b){var c=E('<option value="'+b.id+'">'+b.name+" </option>");e.append(c)})}else G.msg.info(a.message),E("#selectGoods table tbody").empty(),E("#selectGoods .goodsPager").remove()})})}function k(a,b){E(document).on("change",a+" #goods_id",function(){var c=E(this).val(),d={type:c,page:1};return E('.js_select_all input[type="checkbox"]').removeAttr("checked"),N=[],0==c.length?(E(a+" #selectGoods table tbody").empty(),void E(a+" #selectGoods .goodsPager").remove()):void B(J,d,function(c){var d=c.data;if(0==c.status&&d.length>0){E(a+" #selectGoods table tbody").empty(),E(a+" #selectGoods .goodsPager").remove(),E.each(d,function(c,d){var e=template(b,d);E(e).appendTo(E(a+" #selectGoods table tbody"))});var e=template("goodsLists_pager_tmp",c);E(e).appendTo(E(a+" #selectGoods")),y()}else E(a+" #selectGoods table tbody").empty(),E(a+" #selectGoods .goodsPager").remove(),G.msg.info(c.message)})})}function l(a,b,c,d){E(a+" #saveData").on("click",function(){function e(){var a=E("#file_id").find('input[type="file"][name="files"]');if(""==a.val()&&void 0==a.val())return void G.msg.info("请先选择!");var b=new FormData,c=a[0].files[0],e=a.val();e=e.toLowerCase(),b.append("file",c),"-1"!=e.indexOf("csv")?E.ajax(d,{type:"post",data:b,dataType:"json",enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){var b=a.data;0==a.status&&b.length>0?(E.each(b,function(a,b){b.size=j;var c=template("li_hasTag_tmp",b);E(c).insertBefore(E(h).find("li.js_add_goods_tmp"))}),G.msg.info(a.message)):G.msg.info(a.message)}).fail(function(){G.msg.info("网络异常")}):G.msg.info("您选择的文件格式不对,请选择csv格式的文件!")}function f(){var a=E(".change_goods").val();return i="activityId="+a+"&goodsIds="+N,0==N.length?void G.msg.info("请先选择!"):void B(c,i,function(a){var b=a.data;0==a.status&&b.length>0?(E.each(b,function(a,b){b.size=j;var c=template("li_hasTag_tmp",b);E(c).insertBefore(E(h).find("li.js_add_goods_tmp"))}),G.msg.info(a.message)):G.msg.info(a.message),N=[],E('#selectGoods table tbody input[type="checkbox"]').removeAttr("checked")})}function g(){var c=E(a+" #shop_id").val();if(""==c)return void G.msg.info("请先选择!");var d="goodsId="+c;B(b,d,function(a){if(0==a.status){a.size=j;var b=template("li_hasTag_tmp",a);E(b).insertBefore(E(h).find("li.js_add_goods_tmp")),G.msg.info(a.message)}else G.msg.info(a.message)})}for(var h="#children-box-"+E(this).data("size"),i=E(this).closest("form").serialize(),j=E(this).data("size"),k=E(a+" #myTab li"),l=0;l<k.length;l++)if(E(a+" #myTab li:eq("+l+")").hasClass("active")||1==k.length){var m=E(a+" #myTab li:eq("+l+") a"),n=m.attr("data-type");1==n?g():3==n?f():2==n&&e()}})}function m(a,b){E(a+" "+b).on("click",function(){var b="#children-box-"+E(this).data("size"),c=E(this).closest("form").serialize(),d=E(this).data("size");return c="goodsIds="+N,0==N.length?void G.msg.info("请先选择!"):void B(K,c,function(c){var e=c.data;0==c.status&&e.length>0?(E.each(e,function(a,c){c.size=d;var e=template("li_tmp",c);E(e).insertBefore(E(b).find("li.js_tmp"))}),G.msg.info(c.message)):G.msg.info(c.message),N=[],E(a+' table tbody input[type="checkbox"]').removeAttr("checked")})})}function n(a,b,c,d){E(document).on("click",a+" "+b,function(){if(""==O)return void G.msg.info("请先选择!");var b="#children-box-"+E(this).data("size"),e=E(this).closest("form").serialize(),f=E(this).data("size");if(void 0!=d)var e=d+"="+O;else var e="materialId="+O;if("#js_shop_modal"==a){var g=E("#shops_id").val();e+="&activityId="+g}B(K,e,function(d){if(0==d.status){d.size=f,"#js_shop_modal"==a&&(d.activityId=g);var e=template("li_tmp",d);if(!c){var h=E(b).find("li.js_tmp").parent().find("li");h.length>1&&E(b).find("li.js_tmp").parent().find("li:first").remove()}E(e).insertBefore(E(b).find("li.js_tmp")),G.msg.info(d.message)}else G.msg.info(d.message)})})}function o(a,b,c){E(document).on("click",a+" "+c,function(){var a="#children-box-"+E(this).data("size"),c=E(this).closest("form").serialize(),d=E(this).data("size");c="materialId="+O,O="",B(K,c,function(c){if(0==c.status){c.size=d;{var e=template("li_tmp",c);E(a).find("li."+b).parent().find("li")}E(a).find("li."+b).parent().find("li:eq("+L+")").hide(),E(e).insertBefore(E(a).find("li."+b).parent().find("li:eq("+L+")")),G.msg.info(c.message)}else G.msg.info(c.message)})}),E(document).on("click",".brand a.js_del",function(a){a.stopPropagation();var b=E(this).closest("li").index(),c=E(this).closest("li").parent().children("li:eq("+(b+1)+")");setTimeout(function(){c.show()},300)})}function p(a,b,c,d){E(document).on("click","li."+a,function(){J=c,K=d;var a=E(this),e=window.get_activity,f=a.closest("form").find('input[data-toggle="daterangepicker"]').val(),g=a.data("size");E(b).modal("show"),E(b+" #saveData").data("size",g),E(b+' input[type="radio"]').removeAttr("checked");var h={time:f};B(e,h,function(a){var c=a.data;if(0==a.status&&c.length>0){var d=E("#shops_id");d.empty(),d.append('<option value="">--请选择活动--</option>'),E(b+" table tbody").empty(),E(b+" .goodsPager").remove(),E.each(c,function(a,b){var c=E('<option value="'+b.id+'">'+b.name+" </option>");d.append(c)})}else G.msg.info(a.message)})})}function q(a,b){E(document).on("change",a,function(){var a=E(this).val(),c={type:a,page:1};return 0==a.length?(E(b+" table tbody").empty(),void E(b+" .goodsPager").remove()):void B(J,c,function(a){var c=a.data;if(0==a.status&&c.length>0){E(b+" table tbody").empty(),E(b+" .goodsPager").remove(),E.each(c,function(a,c){var d=template("shop_table_tmp",c);E(d).appendTo(E(b+" table tbody"))});var d=template("goodsLists_pager_tmp",a);E(d).appendTo(E(b+" .modal-body")),y()}else G.msg.info(a.message),E(b+" table tbody").empty(),E(b+" .goodsPager").remove()})})}function r(a){E(document).on("click",a+' table tbody input[type="radio"]',function(){var a=E(this),b=a.next().data("id");O=b})}function s(a){E(document).on("click",a+' table tbody input[type="checkbox"]',function(){var b=E(this),c=b.next().data("id"),d=N.indexOf(c),e=b.prop("checked"),f=E(a+' table tbody input[type="checkbox"]'),g=E(a+' table tbody input[type="checkbox"]:checked');e?-1==d&&N.push(c):-1!=d&&N.splice(d,1),f.length==g.length?E(a+' .js_select_all input[type="checkbox"]').prop("checked",!0):E(a+' .js_select_all input[type="checkbox"]').removeAttr("checked")}),E(document).on("click",a+" .js_select_all",function(){var a=E(this),b=a.closest("table").find('tbody input[type="checkbox"]'),c=a.closest("table").find('tbody input[type="hidden"]'),d=a.find('input[type="checkbox"]').prop("checked");d?(E.each(c,function(a,b){var c=E(b).data("id");N.length>0?-1==N.indexOf(c)&&N.push(c):N.push(c)}),b.prop("checked",!0)):(E.each(c,function(a,b){var c=E(b).data("id"),d=N.indexOf(c);N.length>0&&-1!=d&&N.splice(d,1)}),b.removeAttr("checked"))})}function t(a){var b=E(a+' table tbody input[type="radio"]');if(b.length>0)for(var c=0;c<b.length;c++){var d=E(a+' table tbody input[type="radio"]:eq('+c+")"),e=d.next().data("id");e==O?d.attr("checked","checked"):d.removeAttr("checked")}}function u(a,b,c,d){var e="#"+E(b).parents(".modal").attr("id"),f=E(e+" .materials_chosed").val(),g=E(e+" .materials_word .active").index(),h=J,i={type:1,page:a,keyword:f,keytype:g};B(h,i,function(a){var b=a.data;if(0==a.status&&b.length>0){E(e+" table tbody").empty(),E(e+" .goodsPager").remove(),E.each(b,function(a,b){var d=template(c,b);E(d).appendTo(E(e+" table tbody"))});var f=template("goodsLists_pager_tmp",a);E(f).appendTo(E(e+" .modal-body")),d&&A(e),z(e),t(e)}else G.msg.info(a.message)})}function v(a,b,c,d){var e="#"+E(b).parents(".modal").attr("id"),f=J,g={type:c,page:a};B(f,g,function(a){var b=a.data;if(0==a.status&&b.length>0){E(e+" table tbody").empty(),E(e+" .goodsPager").remove(),E.each(b,function(a,b){var c=template(d,b);E(c).appendTo(E(e+" table tbody"))});var c=template("goodsLists_pager_tmp",a);E(c).appendTo(E(e+" .modal-body")),z(e),t(e)}else G.msg.info(a.message)})}function w(a,b,c){var d="#"+E(b).parents(".modal").attr("id");B(J,c,function(a){var b=a.data;if(0==a.status&&b.length>0){E(d+" #selectGoods table tbody").empty(),E(d+" #selectGoods .goodsPager").remove(),E.each(b,function(a,b){var c=template("goods_table_tmp",b);E(c).appendTo(E(d+" #selectGoods table tbody"))});var c=template("goodsLists_pager_tmp",a);E(c).appendTo(E(d+" #selectGoods")),A(d),z(d),t(d)}else G.msg.info(a.message)})}function x(a,b){function c(a,c,d,e,f){var g=E(e).val(),h=E(c).val(),i=E(d).val(),j=E(f).val(),k=E(a).val(),l={type:g,commodity:h,category:i,keyword:k,keytype:j,page:b};return l}var d="#"+E(a).parents(".modal").attr("id");if("#js_goods_modal"==d){var e=c(".shoping_chosed",".change_shop1",".change_shop2",".change_goods",".keyword_ss .active input");w(b,a,e)}else if("#js_shop_modal"==d){var f=E("#shops_id").val();v(b,a,f,"shop_table_tmp")}else if("#js_crazy_modal"==d){var f=E(d+" #goods_id").val(),e={type:f,page:b};w(b,a,e)}else"#js_special_modal"==d?u(b,a,"special_table_tmp",!0):u(b,a,"material_table_tmp",!1)}function y(){var a=E(".goodsPager .js_next").data("page"),b=E(".goodsPager .js_next").data("total");1==a&&1==b&&(E(".goodsPager .js_next").attr("disabled","disabled"),E(".goodsPager .js_last").attr("disabled","disabled")),E(".goodsPager .js_first").attr("disabled","disabled"),E(".goodsPager .js_prev").attr("disabled","disabled")}function z(a){var b=E(a+" .goodsPager .js_prev").data("page"),c=E(a+" .goodsPager .js_next").data("total");1==b?(E(".goodsPager .btn-default").attr("disabled",!1),E(".goodsPager .js_prev").attr("disabled","disabled"),E(".goodsPager .js_first").attr("disabled","disabled")):b==c?(E(".goodsPager .btn-default").attr("disabled",!1),E(".goodsPager .js_next").attr("disabled","disabled"),E(".goodsPager .js_last").attr("disabled","disabled")):E(".goodsPager .btn-default").attr("disabled",!1)}function A(a){E(a+' .js_select_all input[type="checkbox"]').removeAttr("checked");var b=E(a+' table tbody input[type="hidden"]');E.each(b,function(a,b){var c=E(b).data("id"),d=N.indexOf(c);-1!=d&&E(b).prev().attr("checked","checked")});var c=E(a+' table tbody input[type="checkbox"]'),d=E(a+' table tbody input[type="checkbox"]:checked');c.length==d.length&&E('.js_select_all input[type="checkbox"]').prop("checked",!0)}function B(a,b,c){E.ajax({url:a,type:"post",data:b,dataType:"json"}).done(function(a){c(a)}).fail(function(){G.msg.info("网络异常")})}function C(a,b,c){{var d=E(a),e=String(d.val()),f=d.data("id").split(","),g=E(b+" .js_subjects select"),h=(E("#parent_list div.panel").length,window.get_special_by_type);d.closest("form")}if(h=h+"?type="+e,0==e.length)return g.empty(),void g.hide();for(var i=0;i<f.length;i++)if(e==f[i])return g.empty(),void g.hide();E.ajax({url:h,type:"get",dataType:"json"}).done(function(a){if(0==a.status){var b=a.data;g.empty(),g.append('<option value="">请选择专题</option>'),E.each(b,function(a,b){var c=template("delivery_city_tem",b);g.append(c)}),g.show(),null!=c&&c()}else G.msg.info(a.message)}).fail(function(){G.msg.info("网络异常")})}function D(a,b,c,d){function e(b){E(a+":eq("+b+")").on("click",function(){f(b)})}function f(a){for(var e=0;b>e;e++)a==e?E(c+" ."+d+e).attr("disabled",!1):E(c+" ."+d+e).attr("disabled",!0)}for(var g=0;b>g;g++)new e(g),E(a+":eq("+g+")").attr("checked")&&f(g);this.hide=function(){for(var c=0;b>c;c++)E(a+":eq("+c+")").attr("checked")&&f(c)}}{var E=a("$"),F=a("dist/application/app"),G=F.config;F.method}a("jquery_ui"),a("bootstrap"),a("kindeditor");var H=a("./move"),I=H.Posmove;E(document).on("click",".js_page_edit_submit",function(){var a=E(this),b=a.closest("form"),c=E(".js_no_submit_template",b),d=E("input[type='radio']:checked",c);return d.length?void 0:(G.msg.error("请选择模版"),!1)}),E("ul.ipost-list","#parent_list").sortable({opacity:.8}),E("input.js_radio:checked").length>1?E("button.js_page_edit_submit").removeAttr("disabled"):E("button.js_page_edit_submit").attr("disabled","disabled"),E(document).on("change","input.js_radio",function(){E(this).closest("form.form-validate").find("input.js_radio:checked").length>1?E("button.js_page_edit_submit").removeAttr("disabled"):E("button.js_page_edit_submit").attr("disabled","disabled")}),E("ul.js_no_submit_template").on("change","input.js_radio",function(){E("ul.js_no_submit_template").find("li").removeClass("selected"),E(this).is(":checked")&&E(this).closest("li").addClass("selected")});var J,K,L;b("js_add_goods_subject","goods_subject_tmp"),b("js_add_clock_subject","clock_subject_tmp"),b("js_add_material_subject","material_subject_tmp"),b("js_add_picture_subject","picture_subject_tmp"),b("js_picture_subject_sign","picture_subject_sign_tmp"),b("js_picture_subject_tag","picture_subject_tag_tmp"),b("js_add_text_subject","text_subject_tmp",function(a){var b=E('[data-toggle="kindeditor"]',a);b.each(function(){var a=E(this),b=a.data("config"),c=a.data("tongji"),d=b?G.kindeditor[b]:G.kindeditor["default"];if(window.extraUploadPath&&(d=E.extend({},d,{uploadJson:window.extraUploadPath})),c){var e=a.data("tongjiTarget"),f=a.data("ruleRangelength")[1];if(e){var g=E(e),h=g.html();d=E.extend({},d,{afterChange:function(){var a="remain"==c?f-this.count():this.count();0>a||a>f?g.addClass("error"):g.removeClass("error"),g.html(h.format(a))}})}}KindEditor.create(a,d)})}),b("js_add_shop_subject","shop_subject_tmp"),b("js_add_special_subject","special_subject_tmp"),b("js_add_materials_subject","materials_subject_tmp"),b("js_add_pictures_subject","pictures_subject_tmp"),b("js_add_crazy_subject","crazy_subject_tmp"),b("js_add_fight_groups_subject","fight_groups_subject_tmp"),b("js_add_brand_subject","brand_subject_tmp"),b("js_add_materials2_subject","materials2_subject_tmp"),b("js_add_materials3_subject","materials3_subject_tmp"),b("js_add_good2s_subject","good2s_subject_tmp",void 0,function(a){var b=new D(a+" .miaosha .sp_radio",4,a+" .miaosha","wpms_");E(document).on("change",a+" .js_subject_type",function(){C(this,a)}),C(E(a+" .js_subject_type"),a,function(){b.hide();var c=E(a+" .js_subjects").attr("data-default");E(a+" .js_subjects select").val(c)})}),b("js_add_maodian_subject","maodian_subject_tmp"),b("js_add_crazy2_subject","crazy2_subject_tmp"),b("js_add_e_goods_subject","e_goods_subject_tmp"),b("js_add_c_brand_subject","c_brand_subject_tmp"),b("js_add_t_brand_subject","t_brand_subject_tmp"),c("js_add_material_tmp",window.shop_material_url,"#js_material_modal",window.shop_single_material_url,"material_table_tmp","#saveData"),c("js_add_materials_tmp",window.shop_material_url,"#js_materials_modal",window.shop_single_material_url,"material_table_tmp","#materials_saveData"),c("js_add_special_tmp",window.shop_special2_url,"#js_special_modal",window.shop_multiple_special_url,"special_table_tmp","#saveData"),c("js_add_brand_tmp",window.shop_material_url,"#js_brand_modal",window.shop_single_material_url,"material_table_tmp","#brand_saveData"),c("js_add_c_brand_tmp",window.shop_c_brand_url,"#js_materials_modal",window.shop_single_material_url,"material_table_tmp","#materials_saveData"),c("js_add_t_brand_tmp",window.shop_t_brand_url,"#js_materials_modal",window.shop_single_material_url,"material_table_tmp","#materials_saveData"),g("js_add_goods_tmp","#js_goods_modal",window.shop_goods_url,window.shop_multiple_url),j("js_add_crazy_tmp","#js_crazy_modal",window.get_special_list,window.shop_goods_url,window.shop_crazy_url,"#crazy_saveData"),j("js_add_fight_groups_tmp","#js_crazy_modal",window.get_fights_list,window.shop_fight_url,window.shop_fight_groups_url,"#crazy_saveData"),p("js_add_shop_tmp","#js_shop_modal",window.shop_shop_url,window.shop_single_shop_url),k("#js_crazy_modal","goods_table_tmp"),h(window.shop_goods_url,".change_shop_chosed",".shoping_chosed",".change_shop1",".change_shop2",".change_goods",".keyword_ss .active input"),q("#shops_id","#js_shop_modal",window.shop_goods_url),l("#js_goods_modal",window.shop_url,window.shop_special_url,window.shop_multiple_url),m("#js_special_modal","#saveData"),m("#js_crazy_modal","#crazy_saveData"),n("#js_material_modal","#saveData",!1),n("#js_materials_modal","#materials_saveData",!0),n("#js_shop_modal","#saveData",!1,"shopId"),o("#js_brand_modal","js_add_brand_tmp","#brand_saveData"),e(".materials_chosed",".materials_word","#js_material_modal .change_materials_chosed","material_table_tmp"),e(".materials_chosed",".materials_word","#js_materials_modal .change_materials_chosed","material_table_tmp"),e(".materials_chosed",".materials_word","#js_special_modal .change_materials_chosed","special_table_tmp"),E(document).on("click","a.js_del_subject",function(a){a.preventDefault();var b=E(this),c=b.data("confirm"),e=b.data("path");c="undefined"==typeof c?!0:c;var f=function(){e?E.post(e).done(function(a){G.issucceed(a)?(G.msg.suc(a.message||G.lang.removeSuccess,a.url),b.closest("div.panel").fadeOut("fast",function(){E(this).remove(),M(),I()})):(b.html(org),G.msg.error(a.message||G.lang.removeError,a.url))}).fail(function(){b.html(org),G.msg.info(G.lang.exception,d.url)}):b.closest("div.panel").fadeOut("fast",function(){E(this).remove(),M(),I()})};c&&G.msg.msgbox.confirm(b.data("msg")||G.lang.confirmRemove,function(a){a&&f()}),!c&&f()}),E(document).on("click","a.js_del",function(){E(this).closest("li").fadeOut("fast",function(){E(this).remove()})});var M=function(){E("#parent_list div.panel").each(function(a){var b=a+1,c=E(this);c.find("span.change-num").html(b),c.find("li.js_tmp").data("size",a),c.attr("id","children-box-"+a),E.each(c.find("input,select,textarea.form-control"),function(b,c){var d=E(c).attr("name");if(d=d.replace(/(\[\d{1,2}\])/,"["+a+"]"),E(c).attr("name",d),E(c).attr("id")){var e=E(c).attr("id");e=e.replace(/(\[\d{1,2}\])/,"["+a+"]"),E(c).attr("id",e)}}),c.find(".js_sign_lab").length>0&&E.each(c.find(".js_sign_lab"),function(b,c){var d=E(c).attr("data-id");d=d.replace(/(\[\d{1,2}\])/,"["+a+"]"),E(c).attr("data-id",d)})})},N=[],O="";s("#js_goods_modal"),s("#js_special_modal"),s("#js_crazy_modal"),r("#js_material_modal"),r("#js_materials_modal"),r("#js_shop_modal"),r("#js_brand_modal"),E(document).on("click",".goodsPager .js_first",function(){var a=1;x(this,a)}),E(document).on("click",".goodsPager .js_prev",function(){var a=E(this).data("page")-1;x(this,a)}),E(document).on("click",".goodsPager .js_next",function(){var a=E(this).data("page")+1;x(this,a)}),E(document).on("click",".goodsPager .js_last",function(){var a="#"+E(this).parents(".modal").attr("id"),b=E(a+" .goodsPager .js_next").data("total");x(this,b)}),E(document).ready(function(){function a(a){C(E(a+" .js_subject_type"),a,function(){e.hide();var b=E(a+" .js_subjects").attr("data-default");E(a+" .js_subjects select").val(b)})}for(var b=E(".js_subject_type"),c=0;c<b.length;c++){var d="#"+E(".js_subject_type:eq("+c+")").parents(".panel-default").attr("id"),e=new D(d+" .miaosha .sp_radio",4,d+" .miaosha","wpms_");E(document).on("change",d+" .js_subject_type",function(){C(this,d)}),new a(d)}})}),define("dist/subject/move",["$","dist/application/app"],function(a,b){"use strict";function c(){var a=e("#parent_list div.panel"),b=a.length,c=a.first(),d=a.last();a.find("a.js_up_subject").removeClass("hide"),a.find("a.js_down_subject").removeClass("hide"),b>0&&(c.find("a.js_up_subject").addClass("hide"),d.find("a.js_down_subject").addClass("hide"))}function d(a,b,c,d){function f(a,f,g){var i=e(a).parents(".move_box"),j=parseFloat(i.outerWidth()),k=parseFloat(i.outerHeight()),l=i.find(b),m=i.find(c),n=j-f,o=k-g;if(d)var p=i.find(d.phonex),q=i.find(d.phoney),r=i.find(".js_tag_lab").data("width"),s=i.find(".js_tag_lab").data("height");a.onmousedown=function(b){var c=b||event,e=c.clientX-a.offsetLeft,f=c.clientY-a.offsetTop;return h++,a.style.zIndex=h,document.onmousemove=function(b){var c=b||event,g=c.clientX-e,h=c.clientY-f;0>h&&(h=0),h>o&&(h=o),0>g&&(g=0),g>n&&(g=n);var i=g/j*100,t=h/k*100;if(a.style.left=i+"%",a.style.top=t+"%",l.val(i+"%"),m.val(t+"%"),d){var u=(g+r)/j*100,v=(h+s)/k*100;p.val(u+"%"),q.val(v+"%")}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a.releaseCapture&&a.releaseCapture()},a.setCapture&&a.setCapture(),!1}}for(var g=document.getElementsByClassName(a),h=1,i=0;i<g.length;i++){var j=parseFloat(g[i].offsetWidth),k=parseFloat(g[i].offsetHeight);f(g[i],j,k)}}{var e=a("$"),f=a("dist/application/app"),g=f.config;f.method}b.Posmove=function(){var a=e("#parent_list div.panel"),b=a.length,c=a.first(),d=a.last();a.find("a.js_up_subject").removeClass("hide"),a.find("a.js_down_subject").removeClass("hide"),b>0&&(c.find("a.js_up_subject").addClass("hide"),d.find("a.js_down_subject").addClass("hide"))};var h=function(){e("#parent_list div.panel").each(function(a){var b=a+1,c=e(this);c.find("span.change-num").html(b),c.find("li.js_tmp").data("size",a),c.attr("id","children-box-"+a),e.each(c.find("input,select,textarea.form-control"),function(b,c){var d=e(c).attr("name");if(d=d.replace(/(\[\d{1,2}\])/,"["+a+"]"),e(c).attr("name",d),e(c).attr("id")){var f=e(c).attr("id");f=f.replace(/(\[\d{1,2}\])/,"["+a+"]"),e(c).attr("id",f)}}),c.find(".js_sign_lab").length>0&&e.each(c.find(".js_sign_lab"),function(b,c){var d=e(c).attr("data-id");d=d.replace(/(\[\d{1,2}\])/,"["+a+"]"),e(c).attr("data-id",d)})})};e(document).on("click",".js_up_subject",function(){var a=e(this).parents("div.panel"),b=a.prev("div.panel");a.insertBefore(b),c(),h()}),e(document).on("click",".js_down_subject",function(){var a=e(this).parents("div.panel"),b=a.next("div.panel");a.insertAfter(b),c(),h()}),e(document).on("callback",'.js_pic_sign [data-toggle="selectimg2"]',function(a){var b=e(this),c=b.parents("div.small-img").siblings("label.control-label"),d=b.parents("div.small-img").siblings("div.js_pic_title");a&&(b.siblings("img").css({width:"100%",maxHeight:"none"}),b.addClass("hide"),c.addClass("hide"),d.removeClass("hide"))}),e(document).on("click",".js_addsign",function(){var a,b,c=e(this),f={},h=c.parents("div.js_pic_title").siblings("div.small-img").find(".js_sign"),i=c.closest("div.panel-default").attr("id"),j=parseFloat(i.substring(i.length-1)),k=e(this).parent().find("div.form-group").length;f.num=k,f.size=j,4>k?(a=template("shop_move_tmp",f),b=template("shop_sign_tmp",f),e(a).insertBefore(c),e(b).appendTo(h)):g.msg.info("最多添加4个标签"),d("js_sign_lab",".js_pos_x",".js_pos_y")}),e(document).on("click",".js_delsign",function(){var a=e(this).closest("div.form-group"),b=a.siblings("div.form-group"),c=a.find('input[type="text"]').attr("id"),f=e(this).parents("div.js_pic_title").siblings("div.small-img").find(".js_sign_lab"),g=[];f.each(function(){var a=e(this).attr("data-id");a==c?e(this).remove():g.push(e(this))}),a.remove(),b.each(function(a){var b=e(this).find('input[type="text"]'),c=b.attr("name").split("[");c.splice(2,1,a+"]");var d=c.join("[");b.attr("name",d),b.attr("id",d)}),e(g).each(function(a){var b=e(this).find('input[type="hidden"]'),c=e(this).attr("data-id").split("[");c.splice(2,1,a+"]");var d=c.join("[");e(this).attr("data-id",d),b.each(function(){var b=e(this).attr("name").split("[");b.splice(2,1,a+"]");var c=b.join("[");e(this).attr("name",c)})}),d("js_sign_lab",".js_pos_x",".js_pos_y")}),d("js_sign_lab",".js_pos_x",".js_pos_y"),e(document).on("keyup",".js_sign_text",function(){var a=e(this).val(),b=e(this).attr("id"),c=e(this).parents("div.js_pic_title").siblings("div.small-img").find(".js_sign_lab");c.each(function(){var c=e(this).attr("data-id");c==b&&e(this).find("span").html(a)})}),e(document).on("callback",'.js_pic_tag [data-toggle="selectimg2"]',function(a){var b=e(this),c=b.parents("div.small-img").siblings("label.control-label"),d=b.parents("div.small-img").siblings("div.js_tag_title");a&&(b.siblings("img").css({width:"100%",maxHeight:"none"}),b.addClass("hide"),c.addClass("hide"),d.removeClass("hide"))}),e(document).on("click",".js_addtag",function(){var a,b=e(this),c={},d=b.closest("div.panel-default").attr("id"),f=parseFloat(d.substring(d.length-1)),h=e(this).parent().find("div.form-group").length;c.num=h,c.size=f,4>h?(a=template("shop_move_tag_tmp",c),e(a).insertBefore(b)):g.msg.info("最多添加4个标签")}),e(document).on("click",".js_deltag",function(){var a=e(this).closest("div.form-group"),b=a.siblings("div.form-group");a.remove(),b.each(function(a){var b=e(this).find('input[type="text"]'),c=b.attr("name").split("[");c.splice(2,1,a+"]");var d=c.join("[");b.attr("name",d)})}),e(document).on("click",".js_tag_view",function(){function a(a,b){var c=a.find("."+b+" span"),d=[];f.each(function(){d.push(e(this).val())}),c.each(function(a){e(this).html(d[a])})}function b(){var a=i.find('.js_tag_lab input[type="hidden"]'),b=i.find(".js_tag_lab"),c=parseFloat(b.data("width")),d=parseFloat(b.data("height")),f=parseFloat(i.closest("div.move_box").outerWidth()),g=parseFloat(i.closest("div.move_box").outerHeight()),h=[0,0];h.push(c/f*100+"%"),h.push(d/g*100+"%"),a.each(function(a){e(this).val(h[a])})}var c,f=e(this).closest("div.js_tag_title").find("input.js_tag_text"),g=f.length,h=e(this).closest("div.panel-default").attr("id"),i=e(this).parents("div.js_tag_title").siblings("div.small-img").find(".js_tag"),j={},k=parseFloat(h.substring(h.length-1));if(j.size=k,i.empty(),1==g){var l=f.val();c=template("shop_tag_tmp1",j),e(c).appendTo(i),i.find(".tag_lab_style1 span").html(l),b()}else 2==g?(c=template("shop_tag_tmp2",j),e(c).appendTo(i),a(i,"tag_lab_style2"),b()):3==g?(c=template("shop_tag_tmp3",j),e(c).appendTo(i),a(i,"tag_lab_style3"),b()):4==g&&(c=template("shop_tag_tmp4",j),e(c).appendTo(i),a(i,"tag_lab_style4"),b());d("js_tag_lab",".js_tag_pc_x",".js_tag_pc_y",{phonex:".js_tag_phone_x",phoney:".js_tag_phone_y"})}),d("js_tag_lab",".js_tag_pc_x",".js_tag_pc_y",{phonex:".js_tag_phone_x",phoney:".js_tag_phone_y"}),e(document).on("click",".js_title_edit",function(){var a=e(this).closest("span.goods_icon"),b=a.siblings("span.js_goods_title").find('input[type="text"]');e('.js_goods_title input[type="text"]').removeClass("active_title").blur(),b.addClass("active_title")}),e(document).on("blur",'.js_goods_title input[type="text"]',function(){e(this).removeClass("active_title")})});