<!DOCTYPE html>
<html lang="cn" class="app fadeInUp animated">

<head>
    <meta charset="utf-8" />
    <title>微商城</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link href="/assets/stylesheets/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/stylesheets/animate.min.css" rel="stylesheet" />
    <link href="/assets/stylesheets/font-awesome.min.css" rel="stylesheet" />
    <link href="/assets/stylesheets/style.min.css" rel="stylesheet" />
    <link href="/assets/stylesheets/page/graphic.css" rel="stylesheet" />
    <!--[if lt IE 9]><script src="/assets/javascripts/ie8/inie8.min.js"></script><![endif]-->
    <script type="text/javascript">
        var _speedMark = new Date(),
            www_version = 1201405081146;
    </script>
</head>

<body>


    <section class="vbox">
        <header class="header bg-white b-b b-light">
            <p>新建图文素材</p>
            <a class="text-muted pull-right m-t pointer" data-toggle="back" title="返回"><i class="fa fa-reply"></i></a>
        </header>
        <section class="scrollable  wrapper">
            <section class="panel panel-default">
                <div class="panel-body">
                    <form class="form-horizontal form-validate" method="post" action="/api/form/ajaxform">
                        <div class="row">
                            <div class="col-md-4" id="appmsg_box">
                                
                                <a onclick="return false;" class="create_access_primary add_prize" data-temp="js_list_temp" data-parentid="#parent_box" data-max="10" title="新增" href="javascript:void(0);"><i class="fa fa-plus m-r-xs"></i> </a>

                                <div class="form-group">
                                    <div class="text-center">
                                        <button type="submit" id="bsubmit" class="btn btn-primary" data-loading-text="保存中...">保存</button>
                                        <!--<button type="submit" id="bsubmit" class="btn btn-primary" data-loading-text="保存中...">保存并群发</button>
                                        <a class="btn btn-default js_send_preview" href="javascript:;" data-toggle="ajaxModal" data-remote="async/send_preview.html">预览</a>-->
                                        <button type="button" class="btn btn-default" data-toggle="back">取消</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-7" id="parent_box">

                            </div>
                        </div>
                    </form>
                </div>
            </section>
        </section>
    </section>

    <script type="text/html" id="js_insert_good_temp">
        <div class="line line-dashed line-lg pull-in"></div>
        <div class="form-group m-b-sm js_message">
            <div class="col-sm-12">
                <img class="thumb_img" src="{{img}}" style="width:200px;height:auto;" />
                <input class="hide" data-find-name="msgtype" type="text" name="articles[{{itemIndex}}][messages][{{messageIndex}}][type]" value="1" />
                <input class="hide" data-find-name="msgmid" type="text" name="articles[{{itemIndex}}][messages][{{messageIndex}}][mid]" value="0" />
                <input class="hide js_goodid" data-find-name="msgcontent" type="text" name="articles[{{itemIndex}}][messages][{{messageIndex}}][content]" value="{{id}}" />
                <button class="btn btn-default" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods">重新选择</button>
                <button class="btn btn-default js_del_message" type="button">删除</button><br>
                <button class="btn btn-default btn-sm m-t-sm js_insert_texteditor" type="button">插入富文本</button>
                <button class="btn btn-primary btn-sm m-t-sm" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods" data-insert="true">插入商品</button>
            </div>
        </div>
    </script>

    <script type="text/html" id="js_insert_texteditor_temp">
        <div class="line line-dashed line-lg pull-in"></div>
        <div class="form-group m-b-sm js_message">
            <div class="col-sm-11">
                <input class="hide" data-find-name="msgtype" type="text" name="articles[{{itemIndex}}][messages][{{messageIndex}}][type]" value="0" />
                <input class="hide" data-find-name="msgmid" type="text" name="articles[{{itemIndex}}][messages][{{messageIndex}}][mid]" value="0" />
                <textarea rows="13" class="form-control" data-toggle="kindeditor" data-find-name="msgtextcontent" data-rule-rangelength="[1,10000]" id="articles[item.cid].content" name="articles[{{itemIndex}}][messages][{{messageIndex}}][content]"></textarea>
                <button class="btn btn-default btn-sm js_del_message" type="button" style="position:absolute;right:-36px;bottom:40px;">删除</button>
                <button class="btn btn-primary btn-sm m-t-sm" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods" data-insert="true">插入商品</button>
            </div>
        </div>
    </script>

    <script type="text/html" id="js_rules_temp">
        {{each data as item index}}
        <div class="cover_appmsg_item {{if item.index > 0}}js_appmsg_item{{/if}} {{if item.index == 0}}on{{/if}}" {{if item.index == 0}} style="border:0;" {{/if}}>

            <h4 class="appmsg_title"><a href="javascript:void(0);" onclick="return false;" target="_blank">{{if item==""}} 标题{{else}}{{item.title}}{{/if}}</a></h4>
            <div class="appmsg_thumb_wrp">
                <img class="js_appmsg_thumb appmsg_thumb" src="{{item.cover}}">
            </div>
            <div class="appmsg_edit_mask">
                <a class="icon18_common edit_gray js_move_up" data-size="{{item.index}}" data-parentid="#js_list_temp" href="javascript:;"><i class="fa fa-arrow-up fa-2x text-muted" title="上移"></i></a>
                <a class="icon18_common edit_gray js_move_down" data-size="{{item.index}}" href="javascript:;" data-parentid="#js_list_temp" href="javascript:;"><i class="fa fa-arrow-down fa-2x text-muted" title="下移"></i></a>
                <a class="icon18_common edit_gray js_edit" data-size="{{item.index}}" href="javascript:;"><i class="fa fa-pencil text-muted" title="编辑"></i></a>
                <a class="icon18_common edit_gray js_del" data-size="{{item.index}}" data-parentid="#js_list_temp" href="javascript:;"><i class="fa fa-trash-o text-muted" title="删除"></i></a>
            </div>      
        </div>
        {{/each}}
    </script>

    <script type="text/html" id="js_list_temp">
        {{each data as item index}}
            <div class="prize-list{{if item.index > 0}} hide{{/if}}" id="list{{item.index}}">
                <i class="arrow arrow_in"></i>
                <div class="form-group">
                    <label class="col-sm-2 control-label must">标题</label>
                    <div class="col-sm-10">
                        <input type="hidden" data-find-name="cid" value="{{item.cid}}" name="articles[{{item.index}}][cid]" />
                        <input type="text" data-find-name="title" class="form-control title-change" data-rule-required="true" data-rule-maxLength="30" value="{{item.title}}" name="articles[{{item.index}}][title]" id="articles[{{item.index}}].title" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">封面</label>
                    <div class="col-sm-10 small-img js_coverimg">
                        <img class="thumb_img" src="{{item.cover}}" style="max-height: 100px;" />
                        <input class="hide" data-find-name="cover" type="text" name="articles[{{item.index}}][cover]" value="{{item.cover}}" />
                        <button class="btn btn-default js_selectimg" type="button" data-toggle="selectimg2">上传图片</button>
                        <span class="help-inlne">（建议尺寸：900像素 * 500像素）</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">消息类型</label>
                    <div class="col-sm-10">
                        <label class="radio-inline">
                            <input type="radio" data-find-name="msgtype" name="articles[{{item.index}}][msg_type]" class="js_msg_type" data-msgtype="0" {{if item.msg_type == 0}} checked="checked" {{/if}} value="0">图文消息
                        </label>
                        <label class="radio-inline">
                            <input type="radio" data-find-name="msgtype" name="articles[{{item.index}}][msg_type]" class="js_msg_type" data-msgtype="1" {{if item.msg_type == 1}} checked="checked" {{/if}} value="1">商品消息
                        </label>
                    </div>
                </div>

                <div class="form-group {{if item.msg_type != 0}} hide{{/if}} js_msgtype js_msgtype0">
                    <label class="col-sm-2 control-label">消息内容</label>
                    <div class="col-sm-10">
                        {{if item.msg_type != 0}}
                            <input class="hide" data-find-name="msgtype" type="text" name="articles[{{item.index}}][messages][0][type]" value="0" disabled="disabled" />
                            <input class="hide" data-find-name="msgmid" type="text" name="articles[{{item.index}}][messages][0][mid]" value="0" disabled="disabled" />
                            <textarea rows="13" class="form-control" data-toggle="kindeditor" data-find-name="msgtextcontent" id="articles[{{item.index}}].content" name="articles[{{item.index}}][messages][0][content]" data-rule-rangelength="[1,10000]" disabled="disabled">请填写消息内容</textarea>
                            <button class="btn btn-primary btn-sm m-t-sm" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods" data-insert="true">插入商品</button>
                        {{/if}}
                        {{if item.msg_type == 0}}
                            {{each item.messages as message index1}}
                            
                                <div class="form-group m-b-sm js_message">
                                    <div class="col-sm-12">
                                        {{if message.type == 0}}
                                            <input class="hide" data-find-name="msgtype" type="text" name="articles[{{item.index}}][messages][{{message.index}}][type]" value="{{message.type}}" />
                                            <input class="hide" data-find-name="msgmid" type="text" name="articles[{{item.index}}][messages][{{message.index}}][mid]" value="{{message.mid}}" />
                                            <textarea rows="13" class="form-control" data-toggle="kindeditor" data-find-name="msgtextcontent" data-rule-rangelength="[1,10000]" id="articles[{{item.index}}].content" name="articles[{{item.index}}][messages][{{message.index}}][content]">{{message.content}}</textarea>
                                            <button class="btn btn-primary btn-sm m-t-sm" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods" data-insert="true">插入商品</button>
                                        {{/if}}
                                        {{if message.type == 1}}
                                            
                                            {{if message.isValid == "true"}}
                                                <img class="thumb_img" src="{{message.picurl}}" style="width:200px;height:auto;" />
                                            {{/if}}

                                            {{if message.isValid == "false"}}
                                                <span style="width:110px;display:block;position:absolute;left:68px;top:56px;font-weight:bold;font-size:20px;">商品已失效</span>
                                                <img class="thumb_img" src="{{message.picurl}}" style="width:200px;height:auto;opacity:0.5" />
                                            {{/if}}

                                            <input class="hide" data-find-name="msgtype" type="text" name="articles[{{item.index}}][messages][{{message.index}}][type]" value="{{message.type}}" />
                                            <input class="hide" data-find-name="msgmid" type="text" name="articles[{{item.index}}][messages][{{message.index}}][mid]" value="{{message.mid}}" />
                                            <input class="hide js_goodid" data-find-name="msgcontent" type="text" name="articles[{{item.index}}][messages][{{message.index}}][content]" value="{{message.content}}" />
                                            <button class="btn btn-default" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods" data-insert="false">重新选择</button>
                                            <button class="btn btn-default js_del_message" type="button">删除</button><br>
                                            <button class="btn btn-default btn-sm m-t-sm js_insert_texteditor" type="button">插入富文本</button>
                                            <button class="btn btn-primary btn-sm m-t-sm" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods" data-insert="true">插入商品</button>
                                        {{/if}}
                                    </div>
                                </div>
                                <div class="line line-dashed line-lg pull-in"></div>

                            {{/each}}
                        {{/if}}
                    </div>
                    
                </div>

                <div class="form-group {{if item.msg_type != 1}} hide{{/if}} js_msgtype js_msgtype1">
                    <label class="col-sm-2 control-label">商品链接</label>
                    <div class="col-sm-10 small-img">
                        {{if item.msg_type != 1}}
                        <button class="btn btn-default js_select_good" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods">选择商品</button>
                        <input class="js_input_goodid" type="text" data-rule-required="true" data-msg-required="&nbsp;" value="" style="width:0;border:0;" />
                        <div class="js_good_container hide">
                            <img class="thumb_img" src="" style="width:200px;height:auto;" />
                            <input class="hide" data-find-name="msgtype" type="text" name="articles[{{item.index}}][messages][0][type]" value="1" disabled="disabled" />
                            <input class="hide" data-find-name="msgmid" type="text" name="articles[{{item.index}}][messages][0][mid]" value="0" disabled="disabled" />
                            <input class="hide js_goodid" data-find-name="msgcontent" type="text" name="articles[{{item.index}}][messages][0][content]" data-rule-required="true" value="" disabled="disabled" />
                            <button class="btn btn-default" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods">重新选择</button>
                            <button class="btn btn-default js_change_coverimg" type="button">将商品首图设为封面</button>
                        </div>
                        {{/if}}
                        {{if item.msg_type == 1}}
                            {{each item.messages as message index2}}
                                <button class="btn btn-default js_select_good hide" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods">选择商品</button>
                                <div class="js_good_container">
                                    <img class="thumb_img" src="{{message.picurl}}" style="width:200px;height:auto;" />
                                    <input class="hide" data-find-name="msgtype" type="text" name="articles[{{item.index}}][messages][{{message.index}}][type]" value="{{message.type}}" />
                                    <input class="hide" data-find-name="msgmid" type="text" name="articles[{{item.index}}][messages][{{message.index}}][mid]" value="{{message.mid}}" />
                                    <input class="hide js_goodid" data-find-name="msgcontent" type="text" name="articles[{{item.index}}][messages][{{message.index}}][content]" value="{{message.content}}" />
                                    <button class="btn btn-default" type="button" data-toggle="commodity" data-path="/Plus/commodity.php" data-tmodal="#js_commodity_modal" data-type="goods">重新选择</button>
                                    <button class="btn btn-default js_change_coverimg" type="button">将商品首图设为封面</button>
                                </div>
                            {{/each}}
                        {{/if}}

                    </div>
                </div>

            </div>
        {{/each}}
    </script>

    <div class="modal fade in" id="js_commodity_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" style="width:800px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">选择商品</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal form-modal search-form" action="#">
                        <div class="panel panel-default m-b-none">
                            <div class="panel-body">
                                <div class="tab-content">
                                    <div class="tab-pane active" id="allGoods" style="overflow-x:hidden;">
                                        <div class="form-group mr-0">
                                            <div class="col-sm-12 text-right">
                                                <input type="text" class="input-sm form-control" name="putkey" placeholder="商品名称" style="width:220px;display: inline-block"/>    
                                                <button type="button" class="btn btn-sm btn-default" data-type="ajaxSearchs" title="搜索" style="margin-top:-2px"> <i class="fa fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <input class="js_page" name="pages" value="1" type="hidden"/>    
                                        <div class="line line-dashed line-lg pull-in"></div>
                                        <section class="panel panel-default m-b-none">
                                            <div class="table-responsive">
                                                <table class="table table-striped m-b-none">
                                                    <thead>
                                                        <tr>
                                                            <th></th>
                                                            <th>商品名称</th>
                                                            <th>商品价格</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody  id="all-list-box">
                                                        <tr>
                                                            <td colspan="3"> <i class="fa fa-spinner fa-spin"></i>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <form class="form-horizontal form-validate" method="post" action="/api/form/ajaxformurl"> 
                        <input type="hidden" name="dishesids" id="js_selected_id" />    
                        <button type="submit" class="btn btn-primary js_save_btn" data-loading-text="保存中...">确定</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/javascripts/sea-modules/seajs/seajs/2.2.0/sea.js"></script>
    <script src="/assets/javascripts/seajs_config.js"></script>
    <script type="text/javascript">
        window.graphic_add = {
            "data":[
                {
                    "title": "",
                    "cover": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                    "cid": 0,
                    "index": 1,
                    "msg_type": 0,
                    "messages": [
                        {
                            "mid": "0",
                            "index": "0",
                            "type": "0",
                            "content": ""
                        }
                    ]
                },
            ]
        }
        

        window.graphic_set = {
            "data":[
                {
                    "title": "e2ewqd",
                    "cover": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                    "cid": 111,
                    "index": 0,
                    "msg_type": 0,
                    "messages": [
                        {
                            "mid": "11111",
                            "index": "0",
                            "type": "0",
                            "content": "这里是html代码编辑器，22222多么神器的东西啊~~~"
                        },
                        {
                            "mid": "22222",
                            "index": "1",
                            "type": "1",
                            "picurl": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                            "content": "12312312312_123123",
                            "isValid": "false"
                        },
                        {
                            "mid": "33333",
                            "index": "2",
                            "type": "1",
                            "picurl": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                            "content": "1231231ddddd2312_1d23123",
                            "isValid": "true"
                        }
                    ]
                },
                {
                    "title": "e2ewqd21212",
                    "cover": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                    "cid": 222,
                    "index": 1,
                    "msg_type": 1,
                    "messages": [
                        {
                            "mid": "4444",
                            "index": "0",
                            "type": "1",
                            "picurl": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                            "content": "12312312312_123123",
                            "isValid": "true"
                        }
                    ]
                },
                {
                    "title": "e2ewqd34343",
                    "cover": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                    "cid": 333,
                    "index": 2,
                    "msg_type": 0, 
                    "messages": [
                        {
                            "mid": "11123",
                            "index": "0",
                            "type": "0",
                            "content": "这里是html代码编辑器，22222多么神器的东西啊~~~"
                        },
                        {
                            "mid": "24432",
                            "index": "1",
                            "type": "1",
                            "picurl": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                            "content": "12312312312_123123",
                            "isValid": "false"
                        },
                        {
                            "mid": "34445",
                            "index": "2",
                            "type": "1",
                            "picurl": "http://img.weimob.com/static/c3/e8/78/image/20130816/20130816220610_88488.jpg",
                            "content": "12312312312_123123",
                            "isValid": "true"
                        }
                    ]
                }
            ]
        };


        window.cxSelectAdd = [];

        seajs.use(["dist/application/app.js","dist/shopping/addMaterial/init.js", "dist/shopping/materialList/init.js"]);
    </script>

</body>

</html>
